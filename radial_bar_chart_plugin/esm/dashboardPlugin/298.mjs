(self.webpackChunkradial_bar_chart_plugin=self.webpackChunkradial_bar_chart_plugin||[]).push([[298],{29750:e=>{e.exports=function(e,t,i){return e==e&&(void 0!==i&&(e=e<=i?e:i),void 0!==t&&(e=e>=t?e:t)),e}},56029:(e,t,i)=>{var o=i(33448);e.exports=function(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(null!=a&&(void 0===l?a==a&&!o(a):i(a,l)))var l=a,u=s}return u}},87157:(e,t,i)=>{var o=i(40554),r=i(88958);e.exports=function(e,t,i,n){var s=e.length;for((i=o(i))<0&&(i=-i>s?0:s+i),(n=void 0===n||n>s?s:o(n))<0&&(n+=s),n=i>n?0:r(n);i<n;)e[i++]=t;return e}},53325:e=>{e.exports=function(e,t){return e>t}},47556:(e,t,i)=>{var o=i(88668),r=i(47443),n=i(1196),s=i(29932),a=i(7518),l=i(74757),u=Math.min;e.exports=function(e,t,i){for(var d=i?n:r,c=e[0].length,h=e.length,m=h,p=Array(h),g=1/0,f=[];m--;){var C=e[m];m&&t&&(C=s(C,a(t))),g=u(C.length,g),p[m]=!i&&(t||c>=120&&C.length>=120)?new o(m&&C):void 0}C=e[0];var b=-1,D=p[0];e:for(;++b<c&&f.length<g;){var v=C[b],w=t?t(v):v;if(v=i||0!==v?v:0,!(D?l(D,w):d(f,w,i))){for(m=h;--m;){var T=p[m];if(!(T?l(T,w):d(e[m],w,i)))continue e}D&&D.push(w),f.push(v)}}return f}},40098:e=>{var t=Math.ceil,i=Math.max;e.exports=function(e,o,r,n){for(var s=-1,a=i(t((o-e)/(r||1)),0),l=Array(a);a--;)l[n?a:++s]=e,e+=r;return l}},24387:(e,t,i)=>{var o=i(29246);e.exports=function(e){return o(e)?e:[]}},47445:(e,t,i)=>{var o=i(40098),r=i(16612),n=i(18601);e.exports=function(e){return function(t,i,s){return s&&"number"!=typeof s&&r(t,i,s)&&(i=s=void 0),t=n(t),void 0===i?(i=t,t=0):i=n(i),s=void 0===s?t<i?1:-1:n(s),o(t,i,s,e)}}},89567:(e,t,i)=>{var o=i(40554);e.exports=function(e,t){var i;if("function"!=typeof t)throw new TypeError("Expected a function");return e=o(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=void 0),i}}},8400:(e,t,i)=>{var o=i(14259),r=i(16612),n=i(40554),s=Math.ceil,a=Math.max;e.exports=function(e,t,i){t=(i?r(e,t,i):void 0===t)?1:a(n(t),0);var l=null==e?0:e.length;if(!l||t<1)return[];for(var u=0,d=0,c=Array(s(l/t));u<l;)c[d++]=o(e,u,u+=t);return c}},19873:(e,t,i)=>{var o=i(87157),r=i(16612);e.exports=function(e,t,i,n){var s=null==e?0:e.length;return s?(i&&"number"!=typeof i&&r(e,t,i)&&(i=0,n=s),o(e,t,i,n)):[]}},25325:(e,t,i)=>{var o=i(29932),r=i(47556),n=i(5976),s=i(24387),a=n((function(e){var t=o(e,s);return t.length&&t[0]===e[0]?r(t):[]}));e.exports=a},6162:(e,t,i)=>{var o=i(56029),r=i(53325),n=i(6557);e.exports=function(e){return e&&e.length?o(e,n,r):void 0}},51463:(e,t,i)=>{var o=i(89567);e.exports=function(e){return o(2,e)}},96026:(e,t,i)=>{var o=i(47445)();e.exports=o},88958:(e,t,i)=>{var o=i(29750),r=i(40554);e.exports=function(e){return e?o(r(e),0,4294967295):0}},44908:(e,t,i)=>{var o=i(45652);e.exports=function(e){return e&&e.length?o(e):[]}},40690:(e,t,i)=>{var o=i(34963),r=i(29932),n=i(40371),s=i(22545),a=i(29246),l=Math.max;e.exports=function(e){if(!e||!e.length)return[];var t=0;return e=o(e,(function(e){if(a(e))return t=l(e.length,t),!0})),s(t,(function(t){return r(e,n(t))}))}},4788:(e,t,i)=>{var o=i(5976)(i(40690));e.exports=o},80298:(e,t,i)=>{i.r(t),i.d(t,{CorePivotTable:()=>Do,PivotTable:()=>yo,getPivotTableDimensions:()=>Mo,isAbsoluteColumnWidth:()=>oe,isAllMeasureColumnWidthItem:()=>le,isAttributeColumnLocator:()=>te,isAttributeColumnWidthItem:()=>re,isMeasureColumnLocator:()=>ee,isMeasureColumnWidthItem:()=>ne,isMixedValuesColumnWidthItem:()=>ae,isSliceMeasureColumnWidthItem:()=>se,isTotalColumnLocator:()=>ie,isWeakMeasureColumnWidthItem:()=>ue,newAttributeColumnLocator:()=>Ce,newTotalColumnLocator:()=>ce,newWidthForAllColumnsForMeasure:()=>pe,newWidthForAllMeasureColumns:()=>me,newWidthForAttributeColumn:()=>he,newWidthForSelectedColumns:()=>ge,pivotTableMenuForCapabilities:()=>Ro,setNewWidthForSelectedColumns:()=>fe});var o=i(59882),r=i(51256),n=i(44586),s=i(50975),a=function(){return a=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},a.apply(this,arguments)};function l(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(i[o[r]]=e[o[r]])}return i}function u(e,t,i){if(i||2===arguments.length)for(var o,r=0,n=t.length;r<n;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var d=i(8679),c=i.n(d),h=i(93237),m=i(95957);function p(e){!function(e,t,i){if(void 0===i&&(i=Error),!e)throw new i("[React Intl] Could not find required `intl` object. <IntlProvider> needs to exist in the component ancestry.")}(e)}(0,m.H)((function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new((e=Intl.NumberFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:m.A.variadic}),(0,m.H)((function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new((e=Intl.DateTimeFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:m.A.variadic}),(0,m.H)((function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new((e=Intl.PluralRules).bind.apply(e,u([void 0],t,!1)))}),{strategy:m.A.variadic}),(0,m.H)((function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new((e=Intl.Locale).bind.apply(e,u([void 0],t,!1)))}),{strategy:m.A.variadic}),(0,m.H)((function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new((e=Intl.ListFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:m.A.variadic}),a(a({},{formats:{},messages:{},timeZone:void 0,defaultLocale:"en",defaultFormats:{},fallbackOnEmptyString:!0,onError:function(e){},onWarn:function(e){}}),{textComponent:h.Fragment});var g="undefined"==typeof window||window.__REACT_INTL_BYPASS_GLOBAL_CONTEXT__?h.createContext(null):window.__REACT_INTL_CONTEXT__||(window.__REACT_INTL_CONTEXT__=h.createContext(null)),f=g.Consumer,C=(g.Provider,g),b=i(94184),D=i(2525),v=i(25972),w=i(53244);const T="ROW_ATTRIBUTE_COLUMN",I="COLUMN_ATTRIBUTE_COLUMN",y="MEASURE_COLUMN",R="ROW_MEASURE_COLUMN",M="MIXED_HEADERS_COLUMN",x="MIXED_VALUES_COLUMN",S="rowTotal",A="rowSubtotal",E="COLUMN_TOTAL",k="COLUMN_SUBTOTAL",H=" â€º ",z=["sum","max","min","avg","med","nat"],W=1e3,G="s-value",F="s-header-cell-label",P='700 12px / 26px gdcustomfont, avenir, "Helvetica Neue", arial, sans-serif',L='700 12px / 26px gdcustomfont, avenir, "Helvetica Neue", arial, sans-serif';var N=i(30998),O=i(25325),B=i(18446),U=i(89734),_=i(44908);function V(e,t){const{type:i,measureIdentifiers:o,attributeIdentifier:r,include:n}=t,s=o.map((e=>({type:i,measureIdentifier:e,attributeIdentifier:r}))),a=n?function(e,t){const i=t.filter((t=>!e.some((e=>B(e,t)))));return[...e,...i]}(e,s):function(e,t){return e.filter((e=>!t.find((t=>B(t,e)))))}(e,s);return U(a,(e=>N(z,(t=>t===e.type))))}function $(e){return e?e.map(w.attributeDescriptorLocalId):[]}const K=function(e,t,i=!1){return z.reduce(((o,r)=>{const n=function(e,t){const i=e.filter((e=>e.type===t));return _(i.map((e=>e.measureIdentifier)))}(e,r);if(i||O(n,s=t).length===s.length){const t=function(e,t,i){const o=i.map((i=>{const o=function(e,t,i){return e.filter((e=>e.measureIdentifier===i&&e.type===t))}(e,t,i);return o.map((e=>e.attributeIdentifier))}));return O(...o)}(e,r,n);t.length&&o.push({type:r,attributes:t})}var s;return o}),[])},j=function(e,t){return e.reduce(((e,i)=>{if(i.measureIdentifier===t){const t=e.find((e=>e.type===i.type));void 0===t?e.push({type:i.type,attributes:[i.attributeIdentifier]}):t.attributes.push(i.attributeIdentifier)}return e}),[])},Z=function(e,t,i,o,r){const n=o.some((t=>{const o=t.attributes.some((t=>e.includes(t)));return t.type===i&&o})),s=r.some((e=>{const o=e.attributes.some((e=>t.includes(e)));return e.type===i&&o}));return n||s},X=function(e,t,i){return i.some((i=>i.type===t&&i.attributes.includes(e)))};var q,Y,J=i(51463),Q=i(41609);function ee(e){return!Q(e)&&void 0!==e.measureLocatorItem}function te(e){return!Q(e)&&void 0!==e.attributeLocatorItem}function ie(e){return!Q(e)&&void 0!==e.totalLocatorItem}function oe(e){return Number(e.value)===e.value}function re(e){return!Q(e)&&void 0!==e.attributeColumnWidthItem}function ne(e){return!Q(e)&&void 0!==e.measureColumnWidthItem&&void 0!==e.measureColumnWidthItem.locators}function se(e){return!Q(e)&&void 0!==e.sliceMeasureColumnWidthItem&&void 0!==e.sliceMeasureColumnWidthItem.locators}function ae(e){return!Q(e)&&void 0!==e.mixedValuesColumnWidthItem&&void 0!==e.mixedValuesColumnWidthItem.locators}function le(e){return!Q(e)&&void 0!==e.measureColumnWidthItem&&void 0===e.measureColumnWidthItem.locators&&void 0===e.measureColumnWidthItem.locator}function ue(e){return!Q(e)&&void 0!==e.measureColumnWidthItem&&void 0!==e.measureColumnWidthItem.locator}function de(e){return{measureLocatorItem:{measureIdentifier:(0,w.measureLocalId)(e)}}}function ce(e,t){return{totalLocatorItem:{attributeIdentifier:(0,w.attributeLocalId)(e),totalFunction:t}}}function he(e,t,i){const o=void 0!==i?{allowGrowToFit:i}:{};return{attributeColumnWidthItem:{attributeIdentifier:(0,w.attributeLocalId)(e),width:{value:t,...o}}}}function me(e,t){return{measureColumnWidthItem:{width:{value:e,...void 0!==t?{allowGrowToFit:t}:{}}}}}function pe(e,t,i){return{measureColumnWidthItem:{width:{value:t,...void 0!==i?{allowGrowToFit:i}:{}},locator:de(e)}}}function ge(e,t,i,o){return fe(e,t,i,o)}function fe(e,t,i,o){let r=[];return Array.isArray(e)?r=e.map(de):e&&r.push(de(e)),{measureColumnWidthItem:{width:{value:i,...void 0!==o&&"auto"!==i?{allowGrowToFit:o}:{}},locators:[...t,...r]}}}function Ce(e,t){return{attributeLocatorItem:{attributeIdentifier:(0,w.attributeLocalId)(e),element:t}}}!function(e){e.AUTOSIZE_COLUMNS="autosizeColumns",e.FIT_GROW="growToFit",e.UI_RESIZED="uiColumnResized"}(q||(q={})),function(e){e[e.CLICK=1]="CLICK",e[e.DOUBLE_CLICK=2]="DOUBLE_CLICK"}(Y||(Y={}));const be=J((function(){const e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);const t=e.offsetWidth;e.style.overflow="scroll";const i=document.createElement("div");i.style.width="100%",e.appendChild(i);const o=i.offsetWidth;return e.parentNode?.removeChild(e),t-o}));async function De(e){return new Promise((t=>{setTimeout(t,e)}))}function ve(e,t,i){const{buckets:o,sortBy:r}=e,n=(0,w.bucketsFind)(o,D.BucketNames.ATTRIBUTE);return n?(0,w.sanitizeBucketTotals)(n,t??r,i??(0,w.bucketTotals)(n)):[]}function we(e){const{buckets:t}=e,i=(0,w.bucketsFind)(t,D.BucketNames.COLUMNS);return i?(0,w.bucketTotals)(i):[]}const Te=e=>e.length>0,Ie=e=>e.length>0,ye=e=>{const t=re(e)||ne(e),i=se(e)||ae(e);return t||i},Re=e=>e.data().series().toArray().map((e=>e.descriptor)).filter(((e,t,i)=>i.findIndex((t=>t.measureDescriptor===e.measureDescriptor))===t));var Me=i(50308),xe=i(23279),Se=i(47591);const Ae="root";function Ee(e){return"sliceCol"===e?.type}function ke(e){return"sliceMeasureCol"===e?.type}function He(e){return"mixedHeadersCol"===e?.type}function ze(e){return"mixedValuesCol"===e?.type}function We(e){return"seriesCol"==e?.type}function Ge(e){return"scopeCol"===e?.type}function Fe(e){return Ge(e)&&0===e.children.length}function Pe(e){return"rootCol"===e?.type}function Le(e){return"string"==typeof e?e:(t=e,void 0!==t?.colId?e.colId:function(e){return void 0!==e?.getColDef}(e)?Le(e.getColDef()):e.groupId);var t}function Ne(e,t){return Math.floor(e/t)}function Oe(e){return!!e.getColDef}function Be(e){return Oe(e)?e.getColDef().type===y:e.type===y}function Ue(e){const t=e.getColDef().type;return t===y||t===E||t===k}function _e(e){return e.map(Le)}function Ve(e){const t=[];return e.seriesDescriptor.attributeDescriptors&&e.seriesDescriptor.attributeDescriptors.forEach(((i,o)=>{const r=e.seriesDescriptor.attributeHeaders[o];t.push(r),t.push(i)})),t.push(e.seriesDescriptor.measureDescriptor),t}function $e(e,t,i){const o=t?function(e){const t=[];return e.descriptorsToHere.forEach(((i,o)=>{t.push(e.headersToHere[o]),t.push(i)})),t.push(e.header),t.push(e.attributeDescriptor),t}(e):[];return i?.measureDescriptor&&o.push(i.measureDescriptor),o}function Ke(e,t){const i=[];if(t.measureDescriptor&&i.push(t.measureDescriptor),t.columnAttributeDescriptor){const o=t.headerItemMap[e.id];i.push(o),i.push(t.columnAttributeDescriptor)}return i}function je(e,t){const i=[];if(!t.headerItemMap)return[];const o=t.headerItemMap[e.id];return o?((0,Se.kG)((0,w.isResultAttributeHeader)(o),`bad header for row data ${e.id}`),i.push(o),i.push(e.attributeDescriptor),i):[]}function Ze(e,t,i,o,r,n){if(0===o.length||"mixedHeadersCol"===e.type)return!1;const s=function(e,t,i,o){if(We(e))return Ve(e);if(Ge(e))return $e(e,"top"===i&&!o,t);if(Ee(e))return(0,Se.kG)(t),je(e,t);if(ze(e))return(0,Se.kG)(t),Ke(e,t);throw new Se.ej(`unable to obtain drill headers for column of type ${e.type}`)}(e,t,r,n);return s.some((e=>(0,D.isSomeHeaderPredicateMatched)(o,e,i)))}var Xe=i(10928),qe=i(18608);function Ye(e,t,i){const o=qe.X.convertValue(e);return qe.X.formatValue(o,t,i)}function Je(e,t,i){const{formattedValue:o}=Ye(e,t,i);return""===o?"â€“":o}function Qe(e,t,i,o){const{formattedValue:r,colors:n}=Ye(e,t,i),s=n.color,a=n.backgroundColor,l={textAlign:"right"};return""===r?{...l,color:"var(--gd-table-nullValueColor, var(--gd-palette-complementary-6, #94a1ad))",fontWeight:"bold"}:o?{...l,...s&&{color:s},...a&&{backgroundColor:a}}:{...l}}function et(e,t,i){return o=>{const{rowIndex:r,data:n}=o,s=n,a=!o.value,l="top"===o.node.rowPinned;if(Q(s))return b(i,l&&a?"gd-hidden-sticky-column":null);const u=e.getDrillDataContext(),d=o.colDef,c=e.tableDescriptor.getCol(d);(0,Se.kG)(!Pe(c));const h=t.config?.columnHeadersPosition??"top",m=e.tableDescriptor.isTransposed(),p=(0,D.convertDrillableItemsToPredicates)(t.drillableItems),g=s.type===S,f=s.type===A,{isColumnTotal:C,isColumnSubtotal:v}=function(e,t,i,o,r){return"left"===r&&o?Object.keys(i.headerItemMap).length>0?{isColumnTotal:ze(t)&&(0,w.isResultTotalHeader)(i.headerItemMap[t.id])&&!0===t.isTotal,isColumnSubtotal:ze(t)&&(0,w.isResultTotalHeader)(i.headerItemMap[t.id])&&!0===t.isSubtotal}:{isColumnTotal:ze(t)&&!0===t.isTotal,isColumnSubtotal:ze(t)&&!0===t.isSubtotal}:o?{isColumnTotal:Ge(t)&&!0===t.isTotal,isColumnSubtotal:Ge(t)&&!0===t.isSubtotal}:{isColumnTotal:e.type===E,isColumnSubtotal:e.type===k}}(d,c,s,m,h),T=d.type===R;let I=!1;const M=!a||d.type===y;!(g||f||C||v)&&!T&&M&&(I=Ze(c,s,u,p,h,m));const x=e.tableDescriptor.getAbsoluteLeafColIndex(c),H=We(c)?Xe(c.fullIndexPathToHere):void 0,z=!o.node.isRowPinned()&&e.getGroupingProvider().isRepeatedValue(c.id,r),W=!z&&e.getGroupingProvider().isGroupBoundary(r),G=s?.subtotalStyle,F=!!s?.measureDescriptor,P=G&&v,L=g&&v,N=g&&C,O=f&&C,B=!f||z||Q(o.value)?null:o.value?.toLowerCase?.();return b(i,void 0!==H?`gd-column-measure-${H}`:null,function(e,t,i){return b({"gd-cell-drillable":i},"gd-cell",`s-cell-${e}-${t}`,"s-table-cell")}(r,x,I),`gd-column-index-${x}`,g?"gd-row-total":null,C?"gd-column-total":null,v?"gd-column-subtotal":null,B?`gd-table-row-subtotal-${B}`:null,G?`gd-table-row-subtotal gd-table-row-subtotal-${G}`:null,z?"gd-cell-hide s-gd-cell-hide":null,W?"gd-table-row-separator s-gd-table-row-separator":null,l&&a?"gd-hidden-sticky-column":null,P?"gd-table-row-subtotal-column-subtotal s-table-row-subtotal-column-subtotal":null,L?"gd-table-row-total-column-subtotal s-table-row-total-column-subtotal":null,N?"gd-table-row-total-column-total s-table-row-total-column-total":null,O?"gd-table-row-subtotal-column-total s-table-row-subtotal-column-total":null,F?"gd-table-row-metric-cell":null,m?"gd-transpose":null)}}var tt=i(65165);const it=e=>`s-aggregation-item-${e.replace(/\./g,"-")}`,ot=({attributeDescriptors:e,measureLocalIdentifiers:t,intl:i,totalType:r,totals:n,isColumn:s,icon:a,headerText:l,onAggregationSelect:u})=>{const d=e.map(((a,l)=>{const d=(0,w.attributeDescriptorLocalId)(e[l]),c=X(d,r,n),h=((e,t,i,o)=>{if(0===i)return o?e.formatMessage({id:"visualizations.menu.aggregations.all-rows"}):e.formatMessage({id:"visualizations.menu.aggregations.all-columns"});const r=((e,t)=>(0,w.attributeDescriptorName)(e[t-1]))(t,i);return e.formatMessage({id:"visualizations.menu.aggregations.within-attribute"},{attributeName:r})})(i,e,l,s);return o.createElement(tt.Item,{checked:c,key:d},o.createElement("div",{onClick:()=>u({type:r,measureIdentifiers:t,include:!c,attributeIdentifier:d,isColumn:s}),className:b("gd-aggregation-menu-item-inner","s-menu-aggregation-inner",it(d),{"s-menu-aggregation-inner-selected":c,"s-menu-aggregation-inner-column":!s,"s-menu-aggregation-inner-row":s})},h))}));return o.createElement(o.Fragment,null,o.createElement(tt.Header,null,a,o.createElement("span",null,l)),d)},rt=()=>{const e=(0,v.Fg)();return o.createElement("div",{className:"gd-aggregation-submenu-header-icon"},o.createElement(tt.Icon.Rows,{width:12,height:11,colorPalette:{normalRow:e?.palette?.complementary?.c7,totalRow:e?.palette?.complementary?.c4}}))},nt=()=>{const e=(0,v.Fg)();return o.createElement("div",{className:"gd-aggregation-submenu-header-icon"},o.createElement(tt.Icon.Columns,{width:12,height:11,colorPalette:{normalColumn:e?.palette?.complementary?.c7,totalColumn:e?.palette?.complementary?.c4}}))};class st extends o.Component{static defaultProps={isMenuOpened:!1};render(){const{toggler:e,isMenuOpened:t,rowAttributeDescriptors:i,columnAttributeDescriptors:r,intl:n,measureLocalIdentifiers:s,totalType:a,columnTotals:l,rowTotals:u,showColumnsSubMenu:d,onAggregationSelect:c}=this.props,h=t?{opened:!0}:{},m=Te(i)&&Ie(r)&&d;return o.createElement(tt.SubMenu,{toggler:e,offset:-36,...h},o.createElement(tt.ItemsWrapper,null,o.createElement("div",{className:"gd-aggregation-submenu s-table-header-submenu-content"},Te(i)?o.createElement(ot,{intl:n,attributeDescriptors:i,measureLocalIdentifiers:s,totalType:a,totals:l,isColumn:!0,icon:o.createElement(rt,null),headerText:n.formatMessage({id:"visualizations.menu.aggregations.rows"}),onAggregationSelect:c}):null,o.createElement("div",{className:b("s-table-header-submenu-rows-separator",{"gd-aggregation-submenu-rows-separator":m})}),Ie(r)&&d?o.createElement(ot,{intl:n,attributeDescriptors:r,measureLocalIdentifiers:s,totalType:a,totals:u,isColumn:!1,icon:o.createElement(nt,null),headerText:n.formatMessage({id:"visualizations.menu.aggregations.columns"}),onAggregationSelect:c}):null)))}}function at(){var e=h.useContext(C);return p(e),e}var lt,ut;!function(e){e.formatDate="FormattedDate",e.formatTime="FormattedTime",e.formatNumber="FormattedNumber",e.formatList="FormattedList",e.formatDisplayName="FormattedDisplayName"}(lt||(lt={})),function(e){e.formatDate="FormattedDateParts",e.formatTime="FormattedTimeParts",e.formatNumber="FormattedNumberParts",e.formatList="FormattedListParts"}(ut||(ut={}));var dt=function(e){var t=at(),i=e.value,o=e.children,r=l(e,["value","children"]);return o(t.formatNumberToParts(i,r))};function ct(e){var t=function(t){var i=at(),o=t.value,r=t.children,n=l(t,["value","children"]),s="string"==typeof o?new Date(o||0):o;return r("formatDate"===e?i.formatDateToParts(s,n):i.formatTimeToParts(s,n))};return t.displayName=ut[e],t}function ht(e){var t=function(t){var i=at(),o=t.value,r=t.children,n=l(t,["value","children"]),s=i[e](o,n);if("function"==typeof r)return r(s);var a=i.textComponent||h.Fragment;return h.createElement(a,null,s)};return t.displayName=lt[e],t}dt.displayName="FormattedNumberParts",dt.displayName="FormattedNumberParts",ht("formatDate"),ht("formatTime"),ht("formatNumber"),ht("formatList"),ht("formatDisplayName"),ct("formatDate"),ct("formatTime");const mt={sum:{id:"visualizations.totals.dropdown.title.sum"},avg:{id:"visualizations.totals.dropdown.title.avg"},min:{id:"visualizations.totals.dropdown.title.min"},max:{id:"visualizations.totals.dropdown.title.max"},nat:{id:"visualizations.totals.dropdown.title.nat"},med:{id:"visualizations.totals.dropdown.title.med"},"disabled.mvf":{id:"visualizations.totals.dropdown.tooltip.nat.disabled.mvf"},"disabled.ranking":{id:"visualizations.totals.dropdown.tooltip.nat.disabled.ranking"}},pt=()=>{const e=(0,v.Fg)();return o.createElement("div",{className:"menu-icon"},o.createElement(tt.Icon.BurgerMenu,{color:e?.palette?.complementary?.c8}))};class gt extends o.Component{render(){const{intl:e,colId:t,getTableDescriptor:i,isMenuOpened:r,onMenuOpenedChange:n,showColumnsSubMenu:s}=this.props;if(!t)return null;const a=i(),l=a.canTableHaveColumnTotals()&&s;if(!a.canTableHaveRowTotals()&&!l)return null;const u=a.getCol(t);if(Ee(u)||Pe(u))return null;const d=(We(u)?[u.seriesDescriptor.measureDescriptor]:a.getMeasures()).map((e=>e.measureHeaderItem.localIdentifier)),c=Ge(u)||ke(u),h=this.getColumnTotals(d,c,ke(u)),m=this.getRowTotals(d,c,ke(u)),p=a.getSlicingAttributes(),g=a.getScopingAttributes();return o.createElement(tt.Menu,{toggler:o.createElement(pt,null),togglerWrapperClassName:this.getTogglerClassNames(),opened:r,onOpenedChange:n,openAction:"click",closeOnScroll:!0},o.createElement(tt.ItemsWrapper,null,o.createElement("div",{className:"s-table-header-menu-content"},o.createElement(tt.Header,null,e.formatMessage({id:"visualizations.menu.aggregations"})),this.renderMainMenuItems(h,m,d,p,g,s))))}getColumnTotals(e,t,i){const o=this.props.getColumnTotals?.()??[];return t?K(o,e,i):j(o,e[0])}getRowTotals(e,t,i){const o=this.props.getRowTotals?.()??[];return t?K(o,e,i):j(o,e[0])}getTogglerClassNames(){const{isMenuButtonVisible:e,isMenuOpened:t}=this.props;return b("s-table-header-menu","gd-pivot-table-header-menu",{"gd-pivot-table-header-menu--show":e,"gd-pivot-table-header-menu--hide":!e,"gd-pivot-table-header-menu--open":t})}renderMenuItemContent(e,t,i=!1,r,n){const{intl:s}=this.props,a=o.createElement(tt.Item,{checked:t,subMenu:i,disabled:r},o.createElement("div",{className:"gd-aggregation-menu-item-inner s-menu-aggregation-inner"},s.formatMessage(mt[e])));return r?o.createElement(tt.BubbleHoverTrigger,{showDelay:200,hideDelay:0},a,o.createElement(tt.Bubble,{className:"bubble-primary",alignPoints:[{align:"bc tc"}]},n)):a}getItemClassNames(e){return b("gd-aggregation-menu-item","s-menu-aggregation",`s-menu-aggregation-${e}`)}isTableFilteredByMeasureValue(){return this.props.getExecutionDefinition().filters.some((e=>(0,w.isMeasureValueFilter)(e)&&!!(0,w.measureValueFilterCondition)(e)))}isTableFilteredByRankingFilter(){return this.props.getExecutionDefinition().filters.some(w.isRankingFilter)}renderMainMenuItems(e,t,i,r,n,s){const{intl:a,onAggregationSelect:l,showSubmenu:u,availableTotalTypes:d}=this.props,c=this.isTableFilteredByMeasureValue(),h=this.isTableFilteredByRankingFilter(),m=$(r),p=$(n);return d.map((d=>{const g=Z(m,p,d,e,t),f=this.getItemClassNames(d),C="nat"===d&&(c||h),b=c?mt["disabled.mvf"]:mt["disabled.ranking"],D=C?a.formatMessage(b):void 0,v=!C&&u,w=this.renderMenuItemContent(d,g,v,C,D);return o.createElement("div",{className:f,key:d},v?o.createElement(st,{intl:a,totalType:d,rowAttributeDescriptors:r,columnAttributeDescriptors:n,columnTotals:e,rowTotals:t,measureLocalIdentifiers:i,onAggregationSelect:l,toggler:w,showColumnsSubMenu:s}):w)}))}}const ft="left",Ct="right";class bt extends o.Component{static defaultProps={sortDirection:null,textAlign:ft,menuPosition:ft,menu:null,enableSorting:!1,onMenuAggregationClick:()=>null,onSortClick:()=>null};resetSortDirection=()=>{this.setState({currentSortDirection:this.props.sortDirection})};state={isMenuOpen:!1,isMenuButtonVisible:!1,currentSortDirection:null};componentDidMount(){this.resetSortDirection()}componentDidUpdate(e){e.isFocused!==this.props.isFocused&&(this.props.isFocused?this.onMouseEnterHeaderCellText():this.onMouseLeaveHeaderCellText())}UNSAFE_componentWillReceiveProps(e){e.sortDirection!==this.props.sortDirection&&this.setState({currentSortDirection:this.props.sortDirection})}render(){const{menuPosition:e,className:t}=this.props;return o.createElement("div",{className:b("gd-pivot-table-header",{"gd-pivot-table-header--open":this.state.isMenuButtonVisible},t),onMouseEnter:this.onMouseEnterHeaderCell,onMouseLeave:this.onMouseLeaveHeaderCell},"left"===e&&this.renderMenu(),this.renderText(),"right"===e&&this.renderMenu())}renderMenu(){const{intl:e,colId:t,menu:i,getTableDescriptor:r,getExecutionDefinition:n,getColumnTotals:s,getRowTotals:a}=this.props,{isMenuOpen:l,isMenuButtonVisible:u}=this.state;return i?.aggregations?o.createElement(gt,{intl:e,colId:t,isMenuOpened:l,isMenuButtonVisible:u,showSubmenu:i.aggregations??!1,showColumnsSubMenu:i.aggregationsSubMenuForRows??!1,availableTotalTypes:i.aggregationTypes??z,getTableDescriptor:r,getExecutionDefinition:n,getColumnTotals:s,getRowTotals:a,onMenuOpenedChange:this.handleMenuOpenedChange,onAggregationSelect:this.menuItemClick}):null}renderText(){const{displayText:e,textAlign:t,enableSorting:i}=this.props,r=b(F,"gd-pivot-table-header-label",{"gd-pivot-table-header-label--right":"right"===t,"gd-pivot-table-header-label--center":"center"===t,"gd-pivot-table-header-label--clickable":i});return o.createElement("div",{className:r,onClick:this.onTextClick,onMouseEnter:this.onMouseEnterHeaderCellText,onMouseLeave:this.onMouseLeaveHeaderCellText},o.createElement("span",null,e||""),this.renderSorting())}renderSorting(){const{enableSorting:e}=this.props,{currentSortDirection:t}=this.state,i=b("s-sort-direction-arrow",`s-sorted-${t}`,{"gd-pivot-table-header-arrow-up":"asc"===t,"gd-pivot-table-header-arrow-down":"desc"===t});return t&&e&&o.createElement("span",{className:"gd-pivot-table-header-next-sort"},o.createElement("span",{className:i}))}onMouseEnterHeaderCell=()=>{this.showMenuButton()};onMouseLeaveHeaderCell=()=>{this.hideMenuButton()};onMouseEnterHeaderCellText=()=>{if(this.props.enableSorting){const{sortDirection:e}=this.props;let t=null;t=null===e?this.props.defaultSortDirection??null:"asc"===e?"desc":"desc"===e?"asc":null,this.setState({currentSortDirection:t})}};onMouseLeaveHeaderCellText=()=>{this.resetSortDirection()};onTextClick=()=>{const{onSortClick:e,enableSorting:t}=this.props;t&&e()};showMenuButton=()=>{this.state.isMenuOpen||this.setState({isMenuButtonVisible:!0})};hideMenuButton=()=>{this.state.isMenuOpen||this.setState({isMenuButtonVisible:!1})};hideAndCloseMenu=()=>{this.setState({isMenuButtonVisible:!1,isMenuOpen:!1})};menuItemClick=e=>{this.hideAndCloseMenu(),this.props.onMenuAggregationClick&&this.props.onMenuAggregationClick(e)};handleMenuOpenedChange=({opened:e,source:t})=>{this.setState({isMenuOpen:e}),"OUTSIDE_CLICK"!==t&&"SCROLL"!==t||this.setState({isMenuButtonVisible:!1})}}const Dt=e=>{const{className:t,column:i,api:r,getTableDescriptor:n,displayName:s,enableSorting:a,menu:l,progressSort:u,eGridHeader:d,setLastSortedColId:c}=e,[h,m]=(0,o.useState)(i.getSort());(0,o.useEffect)((()=>{const e=e=>{const t=i.getSort();m(t)};return i.addEventListener("sortChanged",e),()=>{i.removeEventListener("sortChanged",e)}}),[i]);const p=(0,o.useCallback)((()=>{u(!1),r.refreshHeader()}),[r,u]),g=e.getTableDescriptor().getCol(e.column),f=Ee(g)||Fe(g)||ke(g)||ze(g)||He(g)?ft:Ct,C=!Fe(g)&&!ke(g)&&!ze(g)&&!He(g)&&a,D=!n().isTransposed()||ke(g)&&s||He(g),[v,w]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(!r)return;const e=e=>{const t=e.column.isColumn?e.column.getColId():e.column.getGroupId(),o=i.getColId();w(t===o)};return r.addEventListener("headerFocused",e),()=>{r.removeEventListener("headerFocused",e)}}),[r,i]),(0,o.useEffect)((()=>{if(!d)return;const e=e=>{(0,tt.isEnterKey)(e)&&C&&c&&c(i.getColId()),(0,tt.isSpaceKey)(e)&&(e.preventDefault(),C&&c&&(c(i.getColId()),p()))},t=()=>{w(!1)};return d.addEventListener("keydown",e),D||d.addEventListener("blur",t),()=>{d.removeEventListener("keydown",e),D||d.removeEventListener("blur",t)}}),[d,i,C,c,D,p]),o.createElement(bt,{className:b("s-pivot-table-column-header",t),textAlign:f,displayText:s,enableSorting:C,sortDirection:h,defaultSortDirection:i.getColDef().sortingOrder?.[0]??void 0,onSortClick:p,onMenuAggregationClick:e.onMenuAggregationClick,menu:D?l?.():void 0,colId:i.getColDef().field,getTableDescriptor:n,getExecutionDefinition:e.getExecutionDefinition,getColumnTotals:e.getColumnTotals,getRowTotals:e.getRowTotals,intl:e.intl,isFocused:v})};var vt=i(57557),wt=i(14176),Tt=i(8400),It=i(4788);function yt(e,t){return(0,Se.kG)(e&&t),{attributeLocatorItem:{attributeIdentifier:e.attributeHeader.localIdentifier,element:t.attributeHeaderItem.uri}}}function Rt(e,t){return(0,Se.kG)(e&&t),{totalLocatorItem:{attributeIdentifier:e.attributeHeader.localIdentifier,totalFunction:t.totalHeaderItem.name}}}function Mt(e){return{measureLocatorItem:{measureIdentifier:e.measureHeaderItem.localIdentifier}}}function xt(e){if(Ge(e)){const t=[],{descriptorsToHere:i,headersToHere:o,measureDescriptors:r}=e,n=It(i,o);return n.push([e.attributeDescriptor,e.header]),n.forEach((([e,i])=>(0,w.isResultTotalHeader)(i)?t.push(Rt(e,i)):t.push(yt(e,i)))),r&&r.forEach((e=>t.push(Mt(e)))),t}{const t=[];return e.seriesDescriptor.attributeDescriptors&&e.seriesDescriptor.attributeHeaders&&It(e.seriesDescriptor.attributeDescriptors,e.seriesDescriptor.attributeHeaders).forEach((([e,i])=>{(0,w.isResultTotalHeader)(i)?t.push(Rt(e,i)):t.push(yt(e,i))})),t.push(Mt(e.seriesDescriptor.measureDescriptor)),t}}function St(e){const t=[];return e.seriesDescriptor&&e.seriesDescriptor.filter(((e,t,i)=>i.findIndex((t=>t.measureDescriptor===e.measureDescriptor))===t)).forEach((e=>{t.push(Mt(e.measureDescriptor))})),t}function At(e){const t=ke(e)||ze(e)?e.seriesDescriptor[0].measureDescriptor.measureHeaderItem.localIdentifier:void 0;return We(e)?e.seriesDescriptor.measureDescriptor.measureHeaderItem.localIdentifier:t}function Et(e){return e===S||e===A}function kt(e){const{type:t}=e;return t===E}function Ht(e){const{type:t}=e;return t===k}const zt=60,Wt=2e3,Gt=500,Ft=12;function Pt(e){return"auto"===e.value}class Lt{tableDescriptor;manuallyResizedColumns;allMeasureColumnWidth;weakMeasuresColumnWidths;constructor(e,t={},i=null,o={}){this.tableDescriptor=e,this.manuallyResizedColumns=t,this.allMeasureColumnWidth=i,this.weakMeasuresColumnWidths=o}getManuallyResizedColumn2=e=>{if(this.manuallyResizedColumns[e.id])return this.convertItem(this.manuallyResizedColumns[e.id]);const t=this.getMatchedWeakMeasuresColumnWidth(e);return t?this.getWeakMeasureColumMapItem(t):We(e)&&this.isAllMeasureColumWidthUsed()?this.getAllMeasureColumMapItem():void 0};getManuallyResizedColumn=e=>{const t=Le(e),i=this.tableDescriptor.getCol(t);return this.getManuallyResizedColumn2(i)};isColumnManuallyResized=e=>!!this.getManuallyResizedColumn(e);addToManuallyResizedColumn=(e,t=!1)=>{this.manuallyResizedColumns[Le(e)]={width:{value:e.getActualWidth(),...Bt(t)}},e.getColDef().suppressSizeToFit=!t};addAllMeasureColumn=(e,t)=>{this.allMeasureColumnWidth=e,t.forEach((e=>{if(Be(e)){const t=Le(e);this.manuallyResizedColumns[t]&&(this.manuallyResizedColumns=vt(this.manuallyResizedColumns,t)),e.getColDef().suppressSizeToFit=!0}})),this.weakMeasuresColumnWidths={}};addWeekMeasureColumn=e=>{const t=e.getActualWidth(),i=At(this.tableDescriptor.getCol(e));if(i){this.weakMeasuresColumnWidths[i]={measureColumnWidthItem:{width:{value:t},locator:{measureLocatorItem:{measureIdentifier:i}}}};const e=e=>e.measureIdentifier===i;this.manuallyResizedColumns=wt(this.manuallyResizedColumns,e)}};removeAllMeasureColumns=()=>{this.allMeasureColumnWidth=null,this.manuallyResizedColumns=wt(this.manuallyResizedColumns,(e=>Pt(e.width))),this.weakMeasuresColumnWidths={}};removeWeakMeasureColumn=e=>{const t=this.tableDescriptor.getCol(Le(e)),i=this.getMatchedWeakMeasuresColumnWidth(t);if(i){this.weakMeasuresColumnWidths=vt(this.weakMeasuresColumnWidths,i.measureColumnWidthItem.locator.measureLocatorItem.measureIdentifier);const e=e=>Pt(e.width)&&this.isMatchingWeakWidth(e,i)&&!this.isAllMeasureColumWidthUsed();this.manuallyResizedColumns=wt(this.manuallyResizedColumns,e)}};removeFromManuallyResizedColumn=e=>{const t=this.tableDescriptor.getCol(Le(e));this.manuallyResizedColumns[t.id]&&(this.manuallyResizedColumns=vt(this.manuallyResizedColumns,t.id),this.isAllMeasureColumWidthUsed()&&Be(e)||(e.getColDef().suppressSizeToFit=!1)),We(t)&&(this.isAllMeasureColumWidthUsed()||this.getMatchedWeakMeasuresColumnWidth(t))&&(this.manuallyResizedColumns[t.id]=this.getAutoSizeItem(e),e.getColDef().suppressSizeToFit=!1)};getColumnWidthsFromMap=()=>{const e=(t=this.manuallyResizedColumns,i=this.tableDescriptor,Object.keys(t).map((e=>{const{width:o}=t[e],r=function(e,t){if(Ee(e)){const i=e.attributeDescriptor.attributeHeader.localIdentifier;if(oe(t))return{attributeColumnWidthItem:{width:t,attributeIdentifier:i}};throw new Se.ej(`width value for attributeColumnWidthItem has to be number ${e.id}`)}if(Ge(e)||We(e))return{measureColumnWidthItem:{width:t,locators:xt(e)}};if(ke(e))return{sliceMeasureColumnWidthItem:{width:t,locators:St(e)}};if(ze(e))return{mixedValuesColumnWidthItem:{width:t,locators:St(e)}};throw new Se.ej(`could not find header matching ${e.id}`)}(i.getCol(e),o);return(0,Se.kG)(r,`unable to find size item by filed ${e}`),r})));var t,i;this.isAllMeasureColumWidthUsed()&&e.push(this.getAllMeasureColumnWidth());const o=function(e){return Object.keys(e).map((t=>e[t]))}(this.weakMeasuresColumnWidths);return e.concat(o)};updateColumnWidths=e=>{const t=this.filterAllMeasureColumnWidthItem(e);if(t&&le(t)){const e=Nt(t.measureColumnWidthItem.width);this.allMeasureColumnWidth=oe(e)?e.value:null}else this.allMeasureColumnWidth=null;this.weakMeasuresColumnWidths=this.filterWeakColumnWidthItems(e);const i=this.filterStrongColumnWidthItems(e),o=function(e,t,i=Nt){if(!t)return{};const o={};return t.forEach((t=>{if(re(t)){const[r,n]=function(e,t){const i=e.matchAttributeWidthItem(t);return(0,Se.kG)(i,`Could not find column descriptor for width item for attribute "${t.attributeColumnWidthItem.attributeIdentifier}"`),[i.id,t.attributeColumnWidthItem.width]}(e,t);o[r]={width:i(n)}}if(ne(t)){const r=function(e,t){const i=e.matchMeasureWidthItem(t);if(i)return[i,t.measureColumnWidthItem.width]}(e,t);if(!r)return;const[n,s]=r;o[n.id]={width:i(s),measureIdentifier:At(n)}}if(se(t)||ae(t)){const r=function(e,t){const i=se(t)?e.matchSliceMeasureWidthItem(t):e.matchMixedValuesWidthItem(t);if(!i)return;return[i,se(t)?t.sliceMeasureColumnWidthItem.width:t.mixedValuesColumnWidthItem.width]}(e,t);if(!r)return;const[n,s]=r;o[n.id]={width:i(s),measureIdentifier:At(n)}}})),o}(this.tableDescriptor,i);this.manuallyResizedColumns=o};getMatchingColumnsByMeasure=(e,t)=>{const i=At(this.tableDescriptor.getCol(e));return i?t.filter((e=>{const t=At(this.tableDescriptor.getCol(e));return i===t})):[]};getMatchedWeakMeasuresColumnWidth=e=>{if(!We(e))return;const t=e.seriesDescriptor.measureDescriptor.measureHeaderItem.localIdentifier;return t?this.weakMeasuresColumnWidths[t]:void 0};filterAllMeasureColumnWidthItem(e){if(e)return e.filter(le)[0]}filterStrongColumnWidthItems(e){return e?e.filter(ye):[]}filterWeakColumnWidthItems=e=>e?e.filter(ue).reduce(((e,t)=>{const i=Nt(t.measureColumnWidthItem.width);return oe(i)&&(e[t.measureColumnWidthItem.locator.measureLocatorItem.measureIdentifier]={measureColumnWidthItem:{...t.measureColumnWidthItem,width:{...t.measureColumnWidthItem.width,value:i.value}}}),e}),{}):{};convertItem(e){if(oe(e.width)){const{width:t}=e;return{width:t.value,...Bt(t.allowGrowToFit)}}}getWeakMeasureColumMapItem(e){return{width:e.measureColumnWidthItem.width.value}}isAllMeasureColumWidthUsed=()=>null!==this.allMeasureColumnWidth;getAutoSizeItem=e=>{const t=At(this.tableDescriptor.getCol(e)),i={width:{value:"auto"}};return t&&(i.measureIdentifier=t),i};getAllMeasureColumMapItem=()=>({width:this.allMeasureColumnWidth});getAllMeasureColumnWidth=()=>({measureColumnWidthItem:{width:{value:this.allMeasureColumnWidth}}});isMatchingWeakWidth(e,t){return e.measureIdentifier===t.measureColumnWidthItem.locator.measureLocatorItem.measureIdentifier}}function Nt(e){return oe(e)?{...e,value:Math.min(Math.max(e.value,zt),Wt)}:e}function Ot(e,t){return Boolean(t&&e[t])}function Bt(e){return e?{allowGrowToFit:e}:{}}function Ut(e,t,i,o,r){if(!t)return;e.font=r;const n=i?e.measureText(t).width+Ft:e.measureText(t).width;return void 0===o||n>o?n:void 0}const _t=(e,t)=>{const i=t.tableDescriptor.isTransposed();return We(e)||i&&Ge(e)||ze(e)};function Vt(e,t,i,o,r,n){const{context:s,gridApi:a}=e,l=e.tableDescriptor.getCol(i),u=i.getColDef();if(l&&s){const d=t[l.id];let c;const h=u.valueFormatter;h&&_t(l,e)&&"function"==typeof h&&(c=h({data:t,value:d,column:i,colDef:u,api:a,node:null,context:void 0}));const m=c||d,p=l.id?o.get(l.id):void 0;let g;if(e.cache){const t=e.groupingProvider?.isRepeatedValue(l.id,n);t||(g=function(e,t,i,o,r){const n=r?`${r}:${t}`:t,s=o.get(n);let a;return void 0===s?(e.font=r,a=e.measureText(t).width,o.set(n,a)):a=s,void 0===i||a>i?a:void 0}(s,m,p,e.cache,r))}else g=Ut(s,m,!1,p,r);g&&o.set(l.id,g)}}function $t(e,t){const i=e?Math.ceil(e+t):0;return Math.min(Math.max(zt,i),Gt)}const Kt=(e,t)=>"viewport"===e.columnAutoresizeOption&&e.clientWidth&&t>e.clientWidth;function jt(e,t,i){const o=e.getElementsByClassName(t)[0];if(!o)return i;const{font:r,fontWeight:n,fontSize:s,fontFamily:a}=window.getComputedStyle(o);return Q(r)?`${n} ${s} ${a}`:r}function Zt(e,t){return kt(e)?t.totalColumnFont:Ht(e)?t.subtotalColumnFont:t.headerFont}function Xt(e,t,i,o){const r=Ge(o)||ze(o);return kt(e)||r&&o.isTotal?i.totalColumnFont:Ht(e)||r&&o.isSubtotal?i.subtotalColumnFont:Et(t.type)?i.subtotalFont:i.rowFont}function qt(e,t,i,o,r,n,s,a){const{containerRef:l,columnAutoresizeOption:u,clientWidth:d}=r;if(e&&t&&i&&o&&l){const o=(i.getAllGridColumns()??[]).filter((e=>e.isPrimary())),{headerFont:r,rowFont:c,subtotalFont:h,totalFont:m,subtotalColumnFont:p,totalColumnFont:g}=function(e){return{headerFont:jt(e,F,'12px / 28px gdcustomfont, avenir, "Helvetica Neue", arial, sans-serif'),rowFont:jt(e,G,'12px / 26px gdcustomfont, avenir, "Helvetica Neue", arial, sans-serif'),subtotalFont:jt(e,"gd-table-row-subtotal",P),totalFont:jt(e,"gd-row-total",L),subtotalColumnFont:jt(e,"gd-column-subtotal",P),totalColumnFont:jt(e,"gd-column-total",L)}}(l),f=document.createElement("canvas").getContext("2d"),C=function(e){const t=e.getDisplayedRowCount(),i=[];for(let o=0;o<t;o++){const t=e.getDisplayedRowAtIndex(o)?.data;t&&i.push(t)}return i}(t),b=function(e){const t=e.getPinnedBottomRowCount(),i=[];for(let o=0;o<t;o++){const t=e?.getPinnedBottomRow(o)?.data;t&&i.push(t)}return i}(t),D={};return function(e,t){const{context:i,tableDescriptor:o}=e,r=new Map;if(i){let n=0;for(let s=0;s<e.columns.length;s++){const a=e.columns[s],l=a.getColDef(),u=Le(l),d=o.getCol(u),c=u?r.get(u):void 0;if(Kt(e,n))break;if(e.measureHeaders){const t=Zt(l,e),o=Ut(i,l.headerName,!!l.sort,c,t);u&&o&&r.set(u,o)}if(e.rowData.forEach(((t,i)=>{const o=Xt(l,t,e,d);Vt(e,t,a,r,o,i)})),e.totalData.forEach(((t,i)=>{Vt(e,t,a,r,e.totalFont,i)})),"viewport"===e.columnAutoresizeOption){const i=u?r.get(u):void 0,o=t.getManuallyResizedColumn(a);n+=o?o.width:$t(i,e.padding)}}}return function(e,t,i){return e.reduce(((e,o)=>{const r=o.getColDef(),n=Le(r);if(n){const o=t.get(n);o&&e.push({...r,width:$t(o,i)})}return e}),[])}(e.columns,r,e.padding)}({tableDescriptor:e,context:f,columns:o,rowData:C,totalData:b,measureHeaders:s.measureHeaders,headerFont:r,subtotalFont:h,totalFont:m,subtotalColumnFont:p,totalColumnFont:g,rowFont:c,padding:s.padding,separators:s.separators,cache:new Map,columnAutoresizeOption:u,clientWidth:d,groupingProvider:a,gridApi:t,columnApi:i},n).forEach((e=>{Le(e)&&void 0!==e.width&&(D[Le(e)]={width:e.width})})),D}return{}}const Yt=e=>"viewport"===e||"autoresizeAll"===e;function Jt(e,t,i){return t=>{const{tableDescriptor:o}=e,r=t.colDef,n=Le(r);if(!n)return b(i);if(n===Ae){const e=!o.sliceColCount()&&!o.sliceMeasureColCount()&&!o.hasHeadersOnLeft();return b(i,"gd-column-group-header","s-table-column-group-header-descriptor",e?"gd-column-group-header--first":null)}{const e=o.getCol(n),t=e.fullIndexPathToHere,s=t?t[t.length-1]:void 0,a=o.isFirstCol(n)||!o.hasScopingCols(),l=function(e,t){return t.isTransposed()?Ge(e)&&(0,w.isResultTotalHeader)(e.header)&&0===e.headersToHere.length&&e.children?.length>0:Ge(e)&&(0,w.isResultTotalHeader)(e.header)}(e,o)||function(e,t){return He(t)&&""===e.children?.[0]?.headerName}(r,e),u=Ge(e)&&(0,w.isResultTotalHeader)(e.header)&&0===e.headersToHere.length,d=function(e,t,i){return i.isTransposed()?Ge(t)&&!0===t.isTotal:e.type===E}(r,e,o),c=function(e,t,i){return i.isTransposed()?Ge(t)&&!0===t.isSubtotal:e.type===k}(r,e,o),h=We(e)?o.getAbsoluteLeafColIndex(e):void 0,m=Ge(e)&&o.isTransposed()&&r.type===I,p=ke(e);return b(i,"gd-column-group-header",void 0!==s?`gd-column-group-header-${s}`:null,void 0!==s?`s-table-measure-column-header-group-cell-${s}`:null,void 0===s||Ee(e)?null:`s-table-measure-column-header-cell-${s}`,void 0!==h?`s-table-measure-column-header-index-${h}`:null,a?"gd-column-group-header--first":null,l?"gd-column-group-header--subtotal":null,u?"gd-column-group-header-total--first s-column-group-header-total--first":null,r.headerName||l||o.isTransposed()?null:"gd-column-group-header--empty",d?"gd-column-total":null,c?"gd-column-subtotal":null,m?"gd-transpose-header":null,p?"gd-row-slice-measure-header":null)}}}class Qt extends o.Component{render(){const{menu:e,intl:t,getTableDescriptor:i}=this.props,r=this.props.columnGroup.getColGroupDef(),n=Le(r),s=this.props.columnGroup.getParent(),a=i().isTransposed(),l=!!s&&!!r.headerName&&!a;return o.createElement(bt,{className:"s-pivot-table-column-group-header",displayText:this.props.displayName,enableSorting:!1,menuPosition:ft,textAlign:ft,menu:l?e?.():void 0,onMenuAggregationClick:this.props.onMenuAggregationClick,colId:n,getTableDescriptor:i,getExecutionDefinition:this.props.getExecutionDefinition,getColumnTotals:this.props.getColumnTotals,getRowTotals:this.props.getRowTotals,intl:t})}}function ei(e,t){const i=[];return t.headers.sliceCols.forEach((t=>{const o=e.headerItemMap[t.id];(0,Se.kG)(o);const r=(0,D.getMappingHeaderUri)(o)??null,n=function(e){return e?.startsWith("/gdc")?function(e){const[,t,,i=null]=e.match(/obj\/([^/]*)(\/elements\?id=)?(.*)$/);return[t,i]}(e)[1]:e}(r);switch(n){case"":i.push(ti("","",""));break;case null:i.push(ti(null,null,null));break;default:(0,D.hasMappingHeaderFormattedName)(o)?i.push(ti(n,r,(0,D.getMappingHeaderName)(o)||e[t.id])):i.push(ti(n,r,e[t.id]))}})),t.headers.leafDataCols.forEach((t=>{i.push(e[t.id])})),i}function ti(e,t,i){return{id:e,uri:t,name:i}}function ii(e,t,i){const o=[],r=t.getCol(e.colDef),n=e.data;return(0,Se.kG)(Ee(r)||We(r)||t.isTransposed()&&Ge(r)||t.isTransposed()&&ze(r)),We(r)&&o.push(...Ve(r)),t.isTransposed()&&(Ge(r)?o.push(...$e(r,!0,n)):ze(r)&&(o.push(...Ke(r,n)),n.measureDescriptor?i.forEach((e=>o.push(...Ke(r,e)))):i.forEach((e=>o.unshift(...Ke(r,e)))))),t.getSliceColsUpToIncludingCol(r).forEach((e=>o.push(...je(e,n)))),(0,D.getDrillIntersection)(o)}function oi(e,t){return i=>{(0,Se.kG)(e.tableDescriptor);const o=i.data;if((0,Se.kG)(o),Et(o.type))return!1;const{colDef:r,data:n,rowIndex:s}=i,a=e.tableDescriptor.getCol(r);if(ke(a)||He(a))return!1;(0,Se.kG)(Ee(a)||We(a)||e.tableDescriptor.isTransposed()&&Ge(a)||e.tableDescriptor.isTransposed()&&ze(a));const{onDrill:l}=t,u=e.getDrillDataContext(),d=(0,D.convertDrillableItemsToPredicates)(t.drillableItems),c=e.tableDescriptor.isTransposed(),h=t.config?.columnHeadersPosition??"top",m=e.getRowNodes().slice(0,s);if(!Ze(a,i.data,u,d,h,c))return!1;const p={type:D.VisualizationTypes.TABLE,element:"cell",columnIndex:e.tableDescriptor.getAbsoluteLeafColIndex(a),rowIndex:s,row:ei(n,e.tableDescriptor),intersection:ii(i,e.tableDescriptor,m)},g={dataView:u.dataView,drillContext:p};if(l?.(g)){const e=new CustomEvent("drill",{detail:g,bubbles:!0});return i.event?.target?.dispatchEvent(e),!0}return!1}}function ri(e,t){return i=>{if(!(i.event&&i.event instanceof KeyboardEvent))return;if(!(0,tt.isEnterKey)(i.event)&&!(0,tt.isSpaceKey)(i.event))return;if((0,Se.kG)(e.tableDescriptor),!i.data)return;const{colDef:o,data:r,rowIndex:n}=i,s=e.tableDescriptor.getCol(o);if(!s)return;if(ke(s)||He(s))return;(0,Se.kG)(Ee(s)||We(s)||e.tableDescriptor.isTransposed()&&Ge(s)||e.tableDescriptor.isTransposed()&&ze(s));const a=e.getDrillDataContext(),l=(0,D.convertDrillableItemsToPredicates)(t.drillableItems??[]),u=e.tableDescriptor.isTransposed();if(!Ze(s,r,a,l,t.config?.columnHeadersPosition??"top",u))return;const{onDrill:d}=t,c=e.getRowNodes().slice(0,n),h={type:D.VisualizationTypes.TABLE,element:"cell",columnIndex:e.tableDescriptor.getAbsoluteLeafColIndex(s),rowIndex:n,row:ei(r,e.tableDescriptor),intersection:ii(i,e.tableDescriptor,c)},m={dataView:a.dataView,drillContext:h};"function"==typeof d&&d(m)}}function ni(e){return t=>{const i=void 0!==t.node.id||"bottom"===t.node.rowPinned,r=(0,v.Fg)(),n=t.colDef&&e?.getCol(t.colDef),s=n&&!Pe(n)&&0===e.getAbsoluteLeafColIndex(n);if(!i&&s){const e=r?.table?.loadingIconColor??r?.palette?.complementary?.c6??void 0;return o.createElement(D.LoadingComponent,{color:e,width:36,imageHeight:8,height:26,speed:2})}const a=Et(t.data?.type),l=a&&function(e){const t=e.data;if(!t?.calculatedForColumns||!e.colDef)return!1;const i=Le(e.colDef);return t.calculatedForColumns.some((e=>e===i))}(t),u=!a||l||t.value?t.formatValue(t.value):"";if(function(e){return(e.colDef?.type===R||e.colDef?.type===M)&&e.data?.measureDescriptor}(t)){const e=t.colDef?.headerComponent,r=t.data?.measureDescriptor?.measureHeaderItem,n=(d=t.colDef?.headerComponentParams,(c=r)?{...d,onMenuAggregationClick:e=>d.onMenuAggregationClick({...e,measureIdentifiers:[c.localIdentifier]})}:d),s=a?{menu:null}:{},l=()=>n.getRowTotals().filter((e=>e.measureIdentifier===r?.localIdentifier)),h=()=>n.getColumnTotals().filter((e=>e.measureIdentifier===r?.localIdentifier)),m=b("gd-row-measure-name",{"s-loading-done":i});return o.createElement(e,{...n,className:m,column:t.column,displayName:u,getRowTotals:l,getColumnTotals:h,...s})}var d,c;const h=b("top"===t.node.rowPinned?"gd-sticky-header-value":G,{"s-loading-done":i});return o.createElement("span",{className:h,title:u||""},u||"")}}class si extends o.Component{render(){const{displayName:e,column:t}=this.props,i=this.getColDescriptor(),r=Ee(i)||Fe(i)?ft:Ct;return o.createElement(bt,{className:"gd-pivot-table-column-total-header s-pivot-table-column-total-header",textAlign:r,displayText:e,enableSorting:!1,colId:t.getColDef().field,getTableDescriptor:this.props.getTableDescriptor,getExecutionDefinition:this.props.getExecutionDefinition,getColumnTotals:this.props.getColumnTotals,getRowTotals:this.props.getRowTotals,intl:this.props.intl})}getColDescriptor(){return this.props.getTableDescriptor().getCol(this.props.column)}}const ai=si;class li extends o.Component{render(){return o.createElement("div",{className:b("gd-pivot-table-header s-pivot-table-column-header s-pivot-table-mixed-values-column-header")},o.createElement("div",{className:b(F,"gd-pivot-table-header-label")}))}}function ui(e,t){const i=ni(e.tableDescriptor);return{suppressSpanHeaderHeight:!0,cellClass:et(e,t,"gd-row-attribute-column"),headerClass:Jt(e,0,"gd-row-attribute-column-header"),colSpan:e=>e.data?.colSpan&&z.find((t=>t===e.data[e.data.colSpan.headerKey]))?e.data.colSpan.count:1,valueFormatter:e=>void 0===e.value?null:e.value,cellRenderer:i}}function di(e,t){const i=ni(e.tableDescriptor);return{suppressSpanHeaderHeight:!0,cellClass:et(e,t,"gd-row-measure-column"),headerClass:Jt(e,0,"gd-row-measure-header"),colSpan:e=>1,valueFormatter:e=>void 0===e.value?null:e.value,cellRenderer:i,sortable:!1}}function ci(e,t){if(e.data?.measureDescriptor){const i=e.data?.measureDescriptor;return void 0!==e.value?Je(e.value,i.measureHeaderItem.format,t):null}return void 0===e.value?null:e.value}function hi(e,t){const i=t.config?.separators,o=ni(e.tableDescriptor);return{suppressSpanHeaderHeight:!0,cellClass:et(e,t,"gd-column-attribute-column"),headerClass:Jt(e,0,"gd-column-attribute-column-header"),valueFormatter:e=>ci(e,i),cellStyle:e=>{if(e.data?.measureDescriptor){const t=e.data?.measureDescriptor;return void 0!==e.value?Qe(e.value,t.measureHeaderItem.format,i,!0):null}return null},cellRenderer:o}}function mi(e,t){const i=ni(e.tableDescriptor);return{suppressSpanHeaderHeight:!0,cellClass:et(e,t,"gd-mixed-headers-column"),headerClass:Jt(e,0,"gd-mixed-headers-column-header"),colSpan:e=>e.data?.colSpan&&z.find((t=>t===e.data[e.data.colSpan.headerKey]))?e.data.colSpan.count:1,valueFormatter:e=>void 0===e.value?null:e.value,cellRenderer:i}}const pi="ag-numeric-cell";function gi(e,t){const i=ni(e.tableDescriptor),o=t.config?.separators;return{suppressSpanHeaderHeight:!0,cellClass:et(e,t,b(pi,"gd-measure-column")),headerClass:Jt(e,0,b("ag-numeric-header","gd-measure-column-header")),valueFormatter:t=>{const i=e.tableDescriptor.getCol(t.colDef);return(0,Se.kG)(We(i)),void 0!==t.value?Je(t.value,i.seriesDescriptor.measureFormat(),o):null},cellStyle:t=>{const i=e.tableDescriptor.getCol(t.colDef);return(0,Se.kG)(We(i)),void 0!==t.value?Qe(t.value,i.seriesDescriptor.measureFormat(),o,!0):null},cellRenderer:i}}function fi(e,t){const i=ni(e.tableDescriptor),o=t.config?.separators;return{headerComponent:ai,suppressSpanHeaderHeight:!0,cellClass:et(e,t,b(pi,"gd-total-column")),headerClass:Jt(e,0,"gd-total-column-header"),valueFormatter:t=>{const i=e.tableDescriptor.getCol(t.colDef);return(0,Se.kG)(We(i)),void 0!==t.value?Je(t.value,i.seriesDescriptor.measureFormat(),o):null},cellStyle:t=>{const i=e.tableDescriptor.getCol(t.colDef);return(0,Se.kG)(We(i)),void 0!==t.value?Qe(t.value,i.seriesDescriptor.measureFormat(),o,!0):null},cellRenderer:i}}function Ci(e,t){const i=ni(e.tableDescriptor),o=t.config?.separators;return{headerComponent:li,suppressSpanHeaderHeight:!0,cellClass:et(e,t,b("gd-mixed-values-column")),headerClass:Jt(e,0,"gd-mixed-values-column-header"),valueFormatter:e=>ci(e,o),cellStyle:e=>{if(e.data?.measureDescriptor){const t=e.data?.measureDescriptor;return void 0!==e.value?Qe(e.value,t.measureHeaderItem.format,o,!0):null}return{textAlign:"left"}},cellRenderer:i}}var bi=i(20434);function Di(e,t,i){const o="rows"===t&&"left"===i?1:0;return{measures:e.meta().measureDescriptors().map((t=>({measure:t,attributes:e.meta().attributeDescriptors()}))),attributes:e.meta().attributeDescriptorsForDim(o).map(((e,t,i)=>({attribute:e,intersectionAttributes:(0,D.getIntersectionAttributes)(e,i)})))}}function vi(e,t){let i;for(const o of e){if(Pe(o))i=vi(o.children,t);else if(Ge(o)){const e=o.attributeDescriptor.attributeHeader.localIdentifier,r=t.find((t=>te(t)?t.attributeLocatorItem.attributeIdentifier===e:ie(t)?t.totalLocatorItem.attributeIdentifier===e:void 0));if(Q(r))return;const n=te(r)&&r.attributeLocatorItem.element===o.header?.attributeHeaderItem?.uri,s=ie(r)&&(0,w.isResultTotalHeader)(o.header)&&r.totalLocatorItem.totalFunction===o.header?.totalHeaderItem?.name;if(n||s)if(o.measureDescriptors){const e=t.filter(ee);if(o.measureDescriptors?.length!==e.length||!ee(e[0]))return;i=o}else if(1===t.length)i=o;else{const e=t.filter((e=>e!==r));i=vi(o.children,e)}}else if(We(o)){if(t.length>1||!ee(t[0]))return;At(o)===t[0].measureLocatorItem.measureIdentifier&&(i=o)}if(i)return i}}function wi(e,t){let i;for(const o of e){if(o.seriesDescriptor?.length!==t.length||!ee(t[0]))return;if(At(o)===t[0].measureLocatorItem.measureIdentifier&&(i=o),i)return i}}var Ti=i(96026);function Ii(e,t){return(0,w.isMeasureSort)(t)&&(0,w.sortMeasureLocators)(t).every((t=>(0,w.isAttributeLocator)(t)?function(e,t){const{attributeDescriptors:i,attributeHeaders:o}=e.seriesDescriptor,{attributeIdentifier:r,element:n}=t.attributeLocatorItem;if(!i||!o)return!1;const s=N(i,(e=>e.attributeHeader.localIdentifier===r));return-1!==s&&((0,Se.kG)(o[s]),o[s]?.attributeHeaderItem?.uri===n)}(e,t):(0,w.isMeasureLocator)(t)?function(e,t){const{measureDescriptor:i}=e.seriesDescriptor,{measureIdentifier:o}=t.measureLocatorItem;return i.measureHeaderItem.localIdentifier===o}(e,t):void 0))}var yi=i(36360);const Ri="left";class Mi extends o.Component{static defaultProps={textAlign:Ri};render(){const{className:e}=this.props;return o.createElement("div",{className:b("gd-pivot-table-header",e)},this.renderText())}renderText(){const{displayText:e,textAlign:t}=this.props,i=b(F,"gd-pivot-table-header-label",{"gd-pivot-table-header-label--right":"right"===t,"gd-pivot-table-header-label--center":"center"===t});return o.createElement("div",{className:i},o.createElement("span",null,e||""))}}const xi=e=>o.createElement(Mi,{className:"gd-pivot-table-column-total-group-header s-pivot-table-column-total-group-header",textAlign:Ri,displayText:e.displayName});function Si(e,t){const i=N(e,(e=>t(e))),o=e[i];return o?{sort:(0,w.sortDirection)(o),sortIndex:i}:{}}const Ai=["desc","asc"],Ei=["asc","desc"];function ki(e,t,i){const o=Hi(e.children,t,i),r=(0,yi.U)((0,D.getMappingHeaderFormattedName)(e.header),t.emptyHeaderTitle);if(0===o.length){const o=(0,w.isResultTotalHeader)(e.header)?function(e,t,i){return e.headersToHere.some((e=>(0,w.isResultTotalHeader)(e)))?"":t?.formatMessage(mt[i])}(e,i,r):r,n={type:I,colId:e.id,field:e.id,headerName:o,headerTooltip:o};return t.allColDefs.push(n),t.leafColDefs.push(n),n}{let n;if((0,w.isResultTotalHeader)(e.header)){const t=e.isTotal,s=e.headersToHere.some((e=>(0,w.isResultTotalHeader)(e)))?"":i.formatMessage(mt[r]);n={type:t?E:k,colId:e.id,headerName:s,headerTooltip:s,children:o,headerGroupComponent:xi}}else n={groupId:e.id,headerName:r,headerTooltip:r,children:o};return t.allColDefs.push(n),n}}function Hi(e,t,i){const o=[];for(const r of e)switch(r.type){case"rootCol":{const e=r.groupingAttributes.map((e=>e.attributeHeader.formOf.name)).join(H),n={groupId:Ae,children:Hi(r.children,t,i),headerName:e,headerTooltip:e};o.push(n),t.allColDefs.push(n);break}case"scopeCol":o.push(ki(r,t,i));break;case"seriesCol":{const e=Si(t.initialSorts,(e=>Ii(r,e))),i=r.seriesDescriptor.measureTitle(),n=r.seriesDescriptor.isTotal,s=r.seriesDescriptor.isSubtotal,a={type:n?E:s?k:y,colId:r.id,field:r.id,headerName:i,headerTooltip:i,...e,sortingOrder:"asc"===e.sort?Ei:Ai};o.push(a),t.leafColDefs.push(a),t.allColDefs.push(a);break}}return o}function zi(e,t,i,o,r,n){const s={initialSorts:t,rootColDefs:[],allColDefs:[],leafColDefs:[],rowColDefs:[],emptyHeaderTitle:i};!function(e,t,i){for(const t of e){const e=Si(i.initialSorts,(e=>{return i=t,o=e,(0,w.isAttributeSort)(o)&&i.attributeDescriptor.attributeHeader.localIdentifier===o.attributeSortItem.attributeIdentifier;var i,o})),o=t.attributeDescriptor.attributeHeader.formOf.name,r={type:T,colId:t.id,field:t.id,headerName:o,headerTooltip:o,...e,sortingOrder:"desc"===e.sort?Ai:Ei};i.rowColDefs.push(r),i.allColDefs.push(r)}for(const e of t){const t={type:R,colId:e.id,field:e.id,headerName:"",headerTooltip:void 0};i.rowColDefs.push(t),i.allColDefs.push(t)}}(e.sliceCols,e.sliceMeasureCols,s),function(e,t,i){const o=Hi(e.rootDataCols,t,i);t.rootColDefs.push(...o)}(e,s,n),"left"===r?.columnHeadersPosition&&function(e,t,i){for(const o of e)if(i){const e={type:M,colId:o.id,field:o.id,headerName:"",headerTooltip:void 0};t.rowColDefs.push(e),t.allColDefs.push(e)}}(e.mixedHeadersCols,s,o),function(e,t){for(const i of e){const e={type:x,colId:i.id,field:i.id,headerName:"",headerTooltip:void 0};t.rowColDefs.push(e),t.allColDefs.push(e)}}(e.mixedValuesCols,s);const a={};return s.allColDefs.forEach((e=>a[Le(e)]=e)),{sliceColDefs:s.rowColDefs,rootDataColDefs:s.rootColDefs,leafDataColDefs:s.leafColDefs,idToColDef:a}}function Wi(e,t,i){(0,Se.kG)(t.length>0);const o=void 0!==i?i:t.length,r=function(e){return{type:"rootCol",id:"root",fullIndexPathToHere:[0],children:[],groupingAttributes:e}}(t),n=Ti(o).map((e=>({pkToGroup:{},groups:[]}))),s=[...e,r];let a=0;for(const t of e){const{attributeHeaders:e,attributeDescriptors:i}=We(l=t)?((0,Se.kG)(l.seriesDescriptor.attributeHeaders),(0,Se.kG)(l.seriesDescriptor.attributeDescriptors),{attributeHeaders:l.seriesDescriptor.attributeHeaders,attributeDescriptors:l.seriesDescriptor.attributeDescriptors}):{attributeHeaders:l.headersToHere,attributeDescriptors:l.descriptorsToHere};(0,Se.kG)(void 0!==e),(0,Se.kG)(void 0!==i);let u=r,d="";for(let t=0;t<o;t++){const o=e[t];d+=(0,w.isResultTotalHeader)(o)?o?.totalHeaderItem?.type:o?.attributeHeaderItem?.uri;const r=n[t];let l=r.pkToGroup[d];const{isTotal:c,isSubtotal:h}=(0,D.getTotalInfo)(e);if(!l){const o=u?[...u.fullIndexPathToHere,u.children.length]:[r.groups.length];l={type:"scopeCol",id:"g_"+a++,attributeDescriptor:i[t],header:e[t],descriptorsToHere:i.slice(0,t),headersToHere:e.slice(0,t),children:[],fullIndexPathToHere:o,isTotal:c,isSubtotal:h},r.pkToGroup[d]=l,r.groups.push(l),s.push(l),u&&u.children.push(l)}u=l}(0,Se.kG)(void 0!==u),t.fullIndexPathToHere=[...u.fullIndexPathToHere,u.children.length],u.children.push(t)}var l;return{groupingAttributes:t,rootColumns:[r],allColumns:s,leafColumns:e}}function Gi(e,t){const i=e.meta().attributeDescriptorsForDim(1),o=e.meta().attributeHeadersForDim(1),r=o[0]?.length??0,n=i.length;if(0===n)return{groupingAttributes:[],leafColumns:[],rootColumns:[],allColumns:[]};(0,Se.kG)(i.length===o.length);const s=[],a=Re(e);for(let e=0;e<r;e++){const r=o.map((t=>t[e])),{isTotal:l,isSubtotal:u}=(0,D.getTotalInfo)(r);s.push({type:"scopeCol",id:`cg_${e}`,children:[],fullIndexPathToHere:[e],header:o[n-1][e],headersToHere:o.slice(0,n-1).map((t=>t[e])),attributeDescriptor:i[n-1],descriptorsToHere:i.slice(0,n-1),isTotal:l,isSubtotal:u,...t?{measureDescriptors:a.map((e=>e.measureDescriptor))}:{}})}return Wi(s,i,n-1)}function Fi(e,t){return{type:"sliceCol",id:`r_${t}`,index:t,attributeDescriptor:e,fullIndexPathToHere:[t],effectiveTotals:e.attributeHeader.totalItems??[]}}function Pi(e){return e.definition.dimensions.findIndex((e=>e.itemIdentifiers.includes(w.MeasureGroupIdentifier)))}function Li(e,t,i){const o={};if("left"===i?.columnHeadersPosition&&t){const t=[{type:"mixedHeadersCol",id:"amh_0",index:0,fullIndexPathToHere:[0]}],i=function(e){return e.data().slices().toArray().map(((e,t)=>{const i=e.descriptor.headers,{isTotal:o,isSubtotal:r}=(0,D.getTotalInfo)(i);return{type:"mixedValuesCol",id:`amv_${t}`,index:t,fullIndexPathToHere:[t],isTotal:o,isSubtotal:r}}))}(e);t.forEach((e=>o[e.id]=e)),i.forEach((e=>o[e.id]=e));const r=e.data().slices().descriptors??[];return{sliceCols:[],sliceMeasureCols:[],rootDataCols:[],leafDataCols:[],mixedHeadersCols:t,mixedValuesCols:i,idToDescriptor:o,scopingAttributes:r.filter(w.isAttributeDescriptor)}}{const r=function(e){return 0===Pi(e)?e.meta().attributeDescriptorsForDim(0).map(Fi):e.data().slices().descriptors.filter(w.isAttributeDescriptor).map(Fi)}(e),n=function(e,t){if(0!==Pi(e))return[];const i=t.length;return[{type:"sliceMeasureCol",id:`r_${i}`,index:i,fullIndexPathToHere:[i],seriesDescriptor:Re(e)}]}(e,r);let s=[];"left"===i?.columnHeadersPosition&&(s=[{type:"mixedHeadersCol",id:"amh_0",index:0,fullIndexPathToHere:[0]}]);const{rootColumns:a,leafColumns:l,allColumns:u,groupingAttributes:d}=function(e,t){return 0===e.meta().measureDescriptors().length&&2===e.meta().dimensions().length?Gi(e):0===Pi(e)?Gi(e,t):function(e){const t=e.data().series().toArray().map(((e,t)=>({type:"seriesCol",id:`c_${t}`,index:t,seriesId:e.id,seriesDescriptor:e.descriptor,children:[],fullIndexPathToHere:[t]}))),i=e.data().series().scopingAttributes??[];return 0===i.length?{groupingAttributes:[],leafColumns:t,rootColumns:t,allColumns:t}:Wi(t,i)}(e)}(e,t);r.forEach((e=>o[e.id]=e)),n.forEach((e=>o[e.id]=e));const c=n.length>0&&0===d.length?function(e){return[{type:"mixedValuesCol",id:"amv_0",index:0,fullIndexPathToHere:[0],seriesDescriptor:Re(e)}]}(e):[];return c.forEach((e=>o[e.id]=e)),s.forEach((e=>o[e.id]=e)),u.forEach((e=>o[e.id]=e)),{sliceCols:r,sliceMeasureCols:n,rootDataCols:a,leafDataCols:l,mixedHeadersCols:s,mixedValuesCols:c,idToDescriptor:o,scopingAttributes:d}}}var Ni=i(24350);class Oi{dv;headers;colDefs;zippedSliceCols=[];zippedLeaves=[];_seriesColsCount;constructor(e,t,i){this.dv=e,this.headers=t,this.colDefs=i,this._initializeZippedLeaves(),this._initializeZippedSliceCols(),this._seriesColsCount=t.leafDataCols.filter(We).length}static _getMeasureGroupDimensionIndex(e){return e.definition.dimensions.findIndex((e=>e.itemIdentifiers.includes(w.MeasureGroupIdentifier)))}static for(e,t,i,o){const r=Oi.isTransposed(e),{headers:n,colDefs:s}=function(e,t,i,o,r){const n=Li(e,i,o);return{headers:n,colDefs:zi(n,e.meta().effectiveSortItems(),t,i,o,r)}}(e,t,r,i,o);return(0,Se.kG)(n.leafDataCols.length===s.leafDataColDefs.length),new Oi(e,n,s)}static isTransposed(e){return 0===Oi._getMeasureGroupDimensionIndex(e)}_initializeZippedLeaves(){this.headers.leafDataCols.forEach(((e,t)=>{this.zippedLeaves.push([e,this.colDefs.leafDataColDefs[t]])}))}_zipOneCol(e){const t=this.colDefs.sliceColDefs.find((t=>t.colId===e.id));if(void 0===t)throw Error(`No definition for column ${e.id}`);return[e,t]}_initializeZippedSliceCols(){this.headers.sliceCols.forEach((e=>{this.zippedSliceCols.push(this._zipOneCol(e))})),this.headers.sliceMeasureCols.forEach((e=>{this.zippedSliceCols.push(this._zipOneCol(e))})),this.headers.mixedValuesCols.forEach((e=>{this.zippedSliceCols.push(this._zipOneCol(e))}))}getCol(e){(0,Se.kG)(e,"id of column or Column, ColDef or ColGroupDef must be provided");const t=Le(e),i=this.headers.idToDescriptor[t];return(0,Se.kG)(i,`no column with id ${t}`),i}getColDef(e){(0,Se.kG)(e,"id of column or Column, ColDef or ColGroupDef must be provided");const t=Le(e),i=this.colDefs.idToColDef[t];return(0,Se.kG)(i,`no column with id ${t}`),i}getScopingAttributes(){return this.headers.scopingAttributes}getSlicingAttributes(){return this.headers.sliceCols.map((e=>e.attributeDescriptor))}sliceColCount(){return this.headers.sliceCols.length}sliceMeasureColCount(){return this.headers.sliceMeasureCols.length}isTransposed(){return Oi.isTransposed(this.dv)}mixedHeadersColsCount(){return this.headers.mixedHeadersCols.length}scopingColCount(){return this.headers.scopingAttributes.length}getMeasures(){return this.dv.meta().measureDescriptors()}seriesColsCount(){return this._seriesColsCount}isFirstCol(e){(0,Se.kG)(e,"id of column or Column, ColDef or ColGroupDef must be provided");const t=Le(e);return this.headers.sliceCols.length>0?this.headers.sliceCols[0].id===t:0===this.headers.sliceCols.length&&this.headers.sliceMeasureCols.length>0?this.headers.sliceMeasureCols[0].id===t:this.headers.mixedHeadersCols.length>0?this.headers.mixedHeadersCols[0].id===t:this.isFirstDataCol(t)}isFirstDataCol(e){(0,Se.kG)(e,"id of column or Column, ColDef or ColGroupDef must be provided");const t=this.getCol(e);switch(t.type){case"seriesCol":case"scopeCol":return t.fullIndexPathToHere.every((e=>0===e));case"rootCol":return!0;default:return!1}}hasScopingCols(){const e=this.headers.rootDataCols[0];return e&&(Ge(e)||Pe(e))}hasDataLeafCols(){return this.headers.leafDataCols.length>0}hasHeadersOnLeft(){return this.headers.mixedHeadersCols.length>0}getAbsoluteLeafColIndex(e){return Ee(e)||ke(e)||He(e)?e.index:Ge(e)?((0,Se.kG)(Fe(e)),this.sliceColCount()+this.sliceMeasureColCount()+N(this.headers.leafDataCols,(t=>t.id===e.id))):this.sliceColCount()+this.sliceMeasureColCount()+this.mixedHeadersColsCount()+e.index}matchAttributeWidthItem(e){const t=(i=e.attributeColumnWidthItem.attributeIdentifier,e=>i===e.attributeHeader.localIdentifier);var i;return this.headers.sliceCols.find((e=>t(e.attributeDescriptor)))}matchMeasureWidthItem(e){return vi(this.headers.rootDataCols,e.measureColumnWidthItem.locators)}matchSliceMeasureWidthItem(e){return wi(this.headers.sliceMeasureCols,e.sliceMeasureColumnWidthItem.locators)}matchMixedValuesWidthItem(e){return wi(this.headers.mixedValuesCols,e.mixedValuesColumnWidthItem.locators)}canTableHaveRowTotals(){return this.sliceColCount()>0&&(this.seriesColsCount()>0||this.sliceMeasureColCount()>0)}canTableHaveColumnTotals(){return this.scopingColCount()>0&&(this.seriesColsCount()>0||this.sliceMeasureColCount()>0||this.mixedHeadersColsCount()>0)}getGrandTotalCol(){const e=this.headers.sliceCols[0];return(0,Se.kG)(e),e}getSliceColsUpToIncludingCol(e){const t=this.headers.sliceCols;if(!Ee(e))return t;const i=N(t,(t=>t.id===e.id));return(0,Se.kG)(i>-1),t.slice(0,i+1)}createSortItems(e,t=[]){if(0===e.length)return[];const i=function(e){return Oe(e[0])?function(e){return e.filter((e=>void 0!==e.getSort()&&null!==e.getSort())).map((e=>({colId:e.getColId(),sort:e.getSort()})))}(e):e.filter((e=>void 0!==e.sort&&null!==e.sort)).map((e=>({colId:e.colId,sort:e.sort})))}(e);return i.map((e=>{const{colId:i,sort:o}=e;return function(e,t,i=[]){if(Ee(e)){const o=e.attributeDescriptor.attributeHeader.localIdentifier,r=i.find((e=>(0,w.isAttributeSort)(e)&&e.attributeSortItem.attributeIdentifier===o));return(0,w.isAttributeAreaSort)(r)?(0,w.newAttributeAreaSort)(o,t):(0,w.newAttributeSort)(o,t)}if(We(e)){const i=[];return e.seriesDescriptor.attributeDescriptors&&e.seriesDescriptor.attributeHeaders&&It(e.seriesDescriptor.attributeDescriptors,e.seriesDescriptor.attributeHeaders).forEach((([e,t])=>i.push(function(e,t){return(0,Se.kG)(e&&t),{attributeLocatorItem:{attributeIdentifier:e.attributeHeader.localIdentifier,element:t.attributeHeaderItem.uri}}}(e,t)))),i.push({measureLocatorItem:{measureIdentifier:e.seriesDescriptor.measureDescriptor.measureHeaderItem.localIdentifier}}),{measureSortItem:{direction:t,locators:i}}}throw new Se.ej(`cannot get sort item for the column type ${e.type}`)}(this.getCol(i),o,t)}))}updateEffectiveTotals(e){const t=Ni(e.meta().attributeDescriptors(),(e=>e.attributeHeader.localIdentifier));this.headers.sliceCols.forEach((e=>function(e,t){const i=e.attributeDescriptor.attributeHeader.localIdentifier,o=t[i];(0,Se.kG)(o,`attempting to refresh attribute descriptors for different table. attribute with local id ${i} not found`),e.effectiveTotals=o.attributeHeader.totalItems??[]}(e,t)))}}var Bi=i(6162);class Ui{reset(){}isGroupBoundary(e){return!1}isColumnWithGrouping(e){return!1}processPage(e,t,i){}isRepeatedValue(e,t){return!1}}class _i{itemUris={};itemRepetitions={};repetitionsCounts=[];maxRepetitions=0;constructor(){this.reset()}reset(){this.itemUris={},this.itemRepetitions={},this.repetitionsCounts=[],this.maxRepetitions=0}isRepeatedValue(e,t){return!!this.itemRepetitions[e]&&!0===this.itemRepetitions[e][t]}isGroupBoundary(e){return!!this.repetitionsCounts&&(void 0===this.repetitionsCounts[e]||this.repetitionsCounts[e]<this.maxRepetitions)}isColumnWithGrouping(e){return Object.keys(this.itemRepetitions).indexOf(e)<this.maxRepetitions}processPage(e,t,i){i.forEach((i=>{this.itemUris[i]||(this.itemUris[i]=[]),e.forEach(((e,o)=>{const r=e.headerItemMap[i];if((0,w.isResultAttributeHeader)(r)){const e=r.attributeHeaderItem.uri;this.itemUris[i][o+t]=e}}))})),this.update()}update(){this.repetitionsCounts=null,this.maxRepetitions=0;let e=null;Object.keys(this.itemUris).forEach((t=>{const i=this.itemUris[t].length;this.itemRepetitions[t]=Array(i).fill(!1),null===this.repetitionsCounts&&(this.repetitionsCounts=Array(i).fill(0)),this.updateAttributeColumn(this.itemUris[t],this.itemRepetitions[t],null!==e?this.itemRepetitions[e]:null),e=t})),this.maxRepetitions=Bi(this.repetitionsCounts)??0}updateAttributeColumn(e,t,i){let o=null;e.forEach(((e,r)=>{let n=o===e;null!==i&&(n=n&&i[r]),n&&(t[r]=!0,this.repetitionsCounts[r]+=1),o=e}))}}class Vi{static createProvider(e){return e?new _i:new Ui}}var $i=i(19873);function Ki(e,t){return N(e,(e=>(0,w.isResultTotalHeader)(e[t])))}function ji(e,t,i,o,r,n){const s=e[o][t],a={field:i.id,rowHeaderDataItem:s,isSubtotal:!1};if((0,w.isResultAttributeHeader)(s))return{...a,value:(0,yi.U)((0,D.getMappingHeaderFormattedName)(s),(0,D.emptyHeaderTitleFromIntl)(n))};if((0,w.isResultMeasureHeader)(s)){const e=r.getMeasures()[s.measureHeaderItem.order];return{...a,value:(0,yi.U)(e.measureHeaderItem.name,(0,D.emptyHeaderTitleFromIntl)(n))}}if((0,w.isResultTotalHeader)(s)){const i=s.totalHeaderItem.name,r=s.totalHeaderItem.measureIndex;if(void 0!==r){const t=function(e){return e.find((e=>(0,w.isResultMeasureHeader)(e[0])))?.filter(w.isMeasureDescriptor)}(e),i=function(e,t){return e?.find((e=>e.measureHeaderItem.order===t))?.measureHeaderItem.name??null}(t,r);return{...a,isSubtotal:!0,value:i}}return{...a,isSubtotal:!0,value:Ki(e,t)===o?n.formatMessage(mt[i]):null}}(0,Se.kG)(!1,"row header is not of type IResultAttributeHeaderItem or IResultTotalHeaderItem")}function Zi(e,t,i){const o=e.meta().allHeaders(),r=e.definition.dimensions,n=function(e){const t=e.rawData().twoDimData(),i=(e.meta().allHeaders()[0][0]||[]).length;return t.length>0?t:$i(Array(i),[null])}(e);if(t.headers.mixedHeadersCols.length>0&&t.isTransposed()){const r=e.rawData().columnTotals(),s=n,a=[];return r&&r.forEach(((e,t)=>{s[t].push(...r[t])})),o[1].forEach(((r,n)=>{const s=t.headers.mixedHeadersCols[0],l=e.data().slices().descriptors.filter(w.isAttributeDescriptor),u=l[n].attributeHeader.formOf.name,d={[s.id]:u,columnAttributeDescriptor:l[n],headerItemMap:{}};t.headers.mixedValuesCols.forEach(((e,t)=>{const s=r[t],a=(0,yi.U)((0,D.getMappingHeaderFormattedName)(s),(0,D.emptyHeaderTitleFromIntl)(i));if((0,w.isResultAttributeHeader)(s))d[e.id]=a,d.headerItemMap[e.id]=s;else if((0,w.isResultTotalHeader)(s)){let r=i?.formatMessage(mt[a]);if(n>0){const e=o[1][n-1]?.[t];(0,w.isTotalDescriptor)(e)&&(0,D.getMappingHeaderFormattedName)(e)===(0,D.getMappingHeaderFormattedName)(s)&&(r="")}d[e.id]=r,d.headerItemMap[e.id]=s}})),a.push(d)})),o[0][0].filter(w.isResultMeasureHeader).forEach(((e,i)=>{const o=t.headers.mixedHeadersCols[0],r=e.measureHeaderItem,n={[o.id]:r.name,measureDescriptor:t.getMeasures()[r.order],headerItemMap:{}};t.headers.mixedValuesCols.forEach(((e,t)=>{n[e.id]=s[i][t]})),a.push(n)})),{rowData:a,rowTotals:[]}}{const s=e.rawData().columnTotals(),a=function(e){if(!e?.totals)return[];let t=!1;return[null,...e.itemIdentifiers.slice(1).map((i=>e.totals?.some((e=>e.attributeIdentifier===i))?(t=!t,t?"even":"odd"):null))]}(r?.[0]),l=n.map(((r,n)=>{const l=e.rawData().hasColumnTotals()?[...r,...s[n]]:r;return function(e,t,i,o,r,n){const s={headerItemMap:{}};return e.headers.sliceCols.forEach(((t,a)=>{const{isSubtotal:l,field:u,value:d,rowHeaderDataItem:c}=ji(o,i,t,a,e,n);l&&(s.type=A,s.subtotalStyle||(s.subtotalStyle=r[a]??void 0)),s[u]=d,s.headerItemMap[u]=c})),e.headers.sliceMeasureCols.forEach((t=>{const{field:r,value:a,rowHeaderDataItem:l}=ji(o,i,t,t.index,e,n);if(s[r]=a,s.headerItemMap[r]=l,(0,w.isResultMeasureHeader)(l))s.measureDescriptor=e.getMeasures()[l.measureHeaderItem.order];else if((0,w.isResultTotalHeader)(l)){const t=l.totalHeaderItem.measureIndex;void 0!==t&&(s.measureDescriptor=e.getMeasures()[t])}})),e.headers.mixedValuesCols.forEach(((e,i)=>{s[e.id]=t[i]})),e.hasDataLeafCols()?(t.forEach(((t,i)=>{const o=e.headers.leafDataCols[i]?.id;s[o]=t})),s):s}(t,l,n,o[0],a,i)})),u=function(e,t,i){if(!t.rawData().hasRowTotals())return null;const o=t.rawData().rowTotals();(0,Se.kG)(o&&o.length>0);const r=o,n=t.definition.dimensions[0].totals;if(!n)return null;const s=function(e,t){const i=e.getGrandTotalCol(),o=function(e){const t=(0,w.bucketsFind)(e.buckets,D.BucketNames.ATTRIBUTE),i=t?.items?.[0];return(0,w.isAttribute)(i)?(0,w.attributeLocalId)(i):""}(t.definition),r=t.definition.dimensions[0].totals,n=r?.filter((e=>e.attributeIdentifier===o))??[];return e.isTransposed()?n.map((e=>({totalHeaderItem:{name:e.type,measureIdentifier:e.measureIdentifier}}))):i.effectiveTotals}(e,t),a=e.getGrandTotalCol(),l=a.attributeDescriptor,u=e.zippedLeaves,d=t.rawData().totalOfTotals();return r.map(((t,o)=>{const r=s[o],c=r?.totalHeaderItem.name,h={},m=[],p=n.filter((e=>c===e.type&&e.attributeIdentifier===l.attributeHeader.localIdentifier)).map((e=>e.measureIdentifier));(d?[...t,...d[0][o]]:t).forEach(((t,i)=>{const o=u[i],r=o?o[0]:e.headers.mixedValuesCols[i];h[r.id]=t,(!We(r)||p.indexOf(r.seriesDescriptor.measureDescriptor.measureHeaderItem.localIdentifier)>-1)&&m.push(r.id)}));let g={};if(e.isTransposed()){const t=e.headers.sliceMeasureCols[0],i=r?.totalHeaderItem?.measureIdentifier,o=function(e,t){return e.getMeasures().find((e=>e.measureHeaderItem.localIdentifier===t))}(e,i);g={[t.id]:o?.measureHeaderItem?.name,measureDescriptor:o}}return{colSpan:{count:e.sliceColCount()-e.sliceMeasureColCount(),headerKey:a.id},...h,[a.id]:i.formatMessage({id:`visualizations.totals.dropdown.title.${c}`}),...g,calculatedForColumns:m,type:S}}))}(t,e,i);return{rowData:l,rowTotals:u}}}class Xi{config;initialDv;gridApiProvider;intl;getCurrentAbortController;rowCount;destroyed=!1;currentResult;currentSorts;grouping;constructor(e,t,i,o,r){this.config=e,this.initialDv=t,this.gridApiProvider=i,this.intl=o,this.getCurrentAbortController=r,this.currentResult=t.result(),this.currentSorts=t.meta().effectiveSortItems();const n=function(e){const{sortBy:t}=e.definition;if(!t?.length)return!0;if(t.length>1)return!1;const i=t[0];if(!(0,w.isAttributeSort)(i))return!1;const o=e.def().bucket(D.BucketNames.ATTRIBUTE);if(!o)return!1;const r=(0,w.bucketAttribute)(o);return!!r&&i.attributeSortItem.attributeIdentifier===(0,w.attributeLocalId)(r)}(t);this.grouping=this.createGroupingProvider(n)}createGroupingProvider=e=>{const t=this.config.getGroupRows()&&e;return Vi.createProvider(t)};resetGroupingProvider=(e=[])=>{const t=(i=this.config.tableDescriptor,!(o=e).length||!(o.length>1)&&i.isFirstCol(o[0].colId));var i,o;this.grouping=this.createGroupingProvider(t)};onDestroy=()=>{};processData=(e,t)=>{if(!e)return;const{successCallback:i}=t,o=Zi(e,this.config.tableDescriptor,this.intl),{rowData:r,rowTotals:n}=o,{offset:s,count:a,totalCount:l}=e.dataView,u=this.config.tableDescriptor.headers.sliceCols.map((e=>e.id));this.grouping.processPage(r,s[0],u);const d="left"===this.config.getColumnHeadersPosition()?r.length:l[0],c=0===this.config.tableDescriptor.getMeasures().length&&0===u.length,h=0===s[0]&&0===a[0]||c?0:d;this.config.onPageLoaded(e),i(r,h),this.gridApiProvider()?.refreshCells({force:!0,suppressFlash:!0}),function(e,t){const i=t??[],o=e?.getPinnedBottomRowCount()??0;if(o!==(t?.length??0))return!0;for(let t=0;t<o;t++)if(!B(e?.getPinnedBottomRow(t)?.data,i[t]))return!0;return!1}(this.gridApiProvider(),n)&&this.gridApiProvider()?.updateGridOptions({pinnedBottomRowData:n})};transformResult=(e,t,i,o)=>{const{sortModel:r}=e,n=this.currentResult,s=n.definition;this.gridApiProvider()?.refreshHeader(),this.resetGroupingProvider(r);const a=this.getCurrentAbortController();let l=(a?n.withSignal(a.signal):n).transform().withSorting(...t??[]).withDimensions((0,w.dimensionSetTotals)(s.dimensions[0],i),(0,w.dimensionSetTotals)(s.dimensions[1],o));const u=(0,w.bucketsFind)(s.buckets,D.BucketNames.COLUMNS),d=(0,w.bucketsFind)(s.buckets,D.BucketNames.ATTRIBUTE);(o.length>0||o&&void 0!==u?.totals)&&(l=d?l.withBuckets(s.buckets[0],(0,w.bucketSetTotals)(s.buckets[1],i),(0,w.bucketSetTotals)(s.buckets[2],o)):l.withBuckets(s.buckets[0],(0,w.bucketSetTotals)(s.buckets[1],o))),this.config.onExecutionTransformed(l),this.driveExecutionAndUpdateDatasource(l,e)};driveExecutionAndUpdateDatasource=(e,t)=>{const{startRow:i,endRow:o,failCallback:r}=t;let n=e;const s=this.getCurrentAbortController();s&&(n=e.withSignal(s.signal)),n.execute().then((e=>{this.currentResult=e,e.readWindow([i,0],[o-i,W]).then((e=>{const i=this.config.dataViewTransform(e),o=D.DataViewFacade.for(i);this.gridApiProvider()?.setRowCount(i.totalCount[0]),this.currentSorts=o.meta().effectiveSortItems();const r=(0,D.emptyHeaderTitleFromIntl)(this.intl);this.config.tableDescriptor=Oi.for(o,r,{columnHeadersPosition:this.config.tableDescriptor.hasHeadersOnLeft()?"left":"top"},this.intl),this.processData(o,t)})).catch((e=>{this.config.onTransformedExecutionFailed(),console.error("Error while doing execution to obtain data view",e),r()}))})).catch((e=>{this.config.onTransformedExecutionFailed(),console.error("Error while doing execution to obtain transformed results",e),r()}))};destroy=()=>{this.destroyed||(this.destroyed=!0,this.onDestroy())};getRows=e=>{const{startRow:t,endRow:i,failCallback:o,sortModel:r}=e;if(function(e,t){const i=t?function(e){return e.getDisplayedRowCount()-1}(t):null;return null!==i&&e>i}(t,this.gridApiProvider()))return void o();const n=this.currentResult,s=n.definition,a=this.config.tableDescriptor.createSortItems(r??[],n.definition.sortBy),l=(0,w.defTotals)(s,0),u=this.config.getColumnTotals(),d=(0,w.defTotals)(s,1),c=this.config.getRowTotals();B(this.currentSorts,a)&&B(l,u)&&B(d,c)?t||n.definition!==this.initialDv.definition?n.readWindow([t,0],[i-t,W]).then((t=>{const i=this.config.dataViewTransform(t);this.processData(D.DataViewFacade.for(i),e)})).catch((e=>{console.error("Error while doing execution to obtain data view",e),o()})):this.processData(this.initialDv,e):setTimeout((()=>{this.transformResult(e,a,u,c)}),100)};getGroupingProvider=()=>this.grouping}function qi(e,t,i){Yi(e,t,i,(()=>!0))}function Yi(e,t,i,o){t.forEach((t=>{const r=e.getColumn(t);r&&o(r)&&(r.maxWidth=i,r.getColDef().maxWidth=i)}))}var Ji=i(6557);function Qi(e,t,i){const o=e.getDisplayedRowAtIndex?.(i)?.beans?.rowRenderer;if(!o)return null;const r=o.getAllCellCtrls().filter((e=>e.rowNode.rowIndex===i)),n=r?.find((e=>e.column.colId===t));return n?.eGui??null}function eo(e){const t=e.getPinnedTopRow(0);if(!t)return null;const i=t.beans?.ctrlsSvc?.getGridBodyCtrl?.()?.eGridBody,o=i?.querySelector(`[row-id=${t.id}]`);return o?.parentElement?.parentElement?.parentElement??null}const to={getHeaderHeight:function(e){const t=e.getDisplayedRowAtIndex?.(0)?.beans?.ctrlsSvc?.get("gridHeaderCtrl");return t?t?.eGui?.clientHeight??0:e.getSizesForCurrentTheme().headerHeight},getCellElement:Qi,addCellClass:function(e,t,i,o){const r=Qi(e,t,i);null!==r&&r.classList.add(o)},removeCellClass:function(e,t,i,o){const r=Qi(e,t,i);null!==r&&r.classList.remove(o)},getPinnedTopRowElement:eo,addPinnedTopRowClass:function(e,t){const i=eo(e);i&&i.classList.add(t)},removePinnedTopRowClass:function(e,t){const i=eo(e);i&&i.classList.remove(t)},setPinnedTopRowStyles:function(e,t){const i=eo(e);if(i)for(const[e,o]of Object.entries(t))i.style[e]=o}};class io{getCurrentAbortController;intl;tableDescriptor;resizedColumnsStore;originalExecution;config;transformedExecution;currentResult;visibleData;currentFingerprint;autoResizedColumns;growToFittedColumns;resizing;numberOfColumnResizedCalls;agGridDataSource;gridApi;columnApi;destroyed=!1;onPageLoadedCallback;onExecutionTransformedCallback;constructor(e,t,i,o,r){this.getCurrentAbortController=r,this.intl=o.intl,this.currentResult=e,this.visibleData=D.DataViewFacade.for(t),this.currentFingerprint=(0,w.defFingerprint)(this.currentResult.definition),this.tableDescriptor=Oi.for(this.visibleData,(0,D.emptyHeaderTitleFromIntl)(o.intl),o.config,o.intl),this.autoResizedColumns={},this.growToFittedColumns={},this.resizing=!1,this.resizedColumnsStore=new Lt(this.tableDescriptor),this.numberOfColumnResizedCalls=0,this.agGridDataSource=this.createDataSource(i),this.onExecutionTransformedCallback=i.onExecutionTransformed,this.updateColumnWidths(i.getResizingConfig()),this.originalExecution=o.execution,this.config=o.config}finishInitialization=(e,t)=>{(0,Se.kG)(void 0===this.gridApi),(0,Se.kG)(this.agGridDataSource),this.gridApi=e,this.columnApi=t,this.gridApi.updateGridOptions({datasource:this.agGridDataSource})};refreshData=()=>{const e=this.gridApiGuard();e&&e.updateGridOptions({datasource:this.agGridDataSource})};destroy=()=>{this.gridApi=void 0,this.columnApi=void 0,this.destroyed=!0};isFullyInitialized=()=>void 0!==this.gridApi;isTransforming=()=>void 0!==this.transformedExecution;clearFittedColumns=()=>{this.growToFittedColumns={}};gridApiGuard=()=>{if(!this.destroyed)return this.gridApi;console.debug("Attempting to obtain gridApi for a destructed table.")};updateColumnWidths=e=>{this.resizedColumnsStore.updateColumnWidths(e.widths),function(e,t,i,o,r,n={}){const s=e.zippedSliceCols,a=e.zippedLeaves,l=[];l.push(...s),l.push(...a),l.forEach((([e,s])=>{const a=e.id,l=t.getManuallyResizedColumn2(e),u=i[a];if(s.maxWidth=Wt,l)s.width=l.width,s.suppressSizeToFit=!l.allowGrowToFit;else if(s.suppressSizeToFit=!1,s.width=u?u.width:o,r){const e=n[a];e&&(s.width=e.width,e.width>Wt&&(s.maxWidth=void 0))}}))}(this.tableDescriptor,this.resizedColumnsStore,this.autoResizedColumns,e.defaultWidth,e.growToFit,this.growToFittedColumns)};createDataSource=e=>{return this.onPageLoadedCallback=e.onPageLoaded,t={tableDescriptor:this.tableDescriptor,getGroupRows:e.getGroupRows,getColumnTotals:e.getColumnTotals,getRowTotals:e.getRowTotals,getColumnHeadersPosition:e.getColumnHeadersPosition,onPageLoaded:this.onPageLoaded,onExecutionTransformed:this.onExecutionTransformed,onTransformedExecutionFailed:this.onTransformedExecutionFailed,dataViewTransform:Ji},i=this.visibleData,o=this.gridApiGuard,r=this.intl,n=this.getCurrentAbortController,new Xi(t,i,o,r,n);var t,i,o,r,n};onExecutionTransformed=e=>{console.debug("onExecutionTransformed",e.definition),this.transformedExecution=e,this.onExecutionTransformedCallback?.(e)};onTransformedExecutionFailed=()=>{this.transformedExecution=void 0};onPageLoaded=e=>{const t=this.currentResult;this.transformedExecution=void 0,this.currentResult=e.result(),this.visibleData=e,this.currentFingerprint=(0,w.defFingerprint)(this.currentResult.definition),this.onPageLoadedCallback?.(e,!t?.equals(this.currentResult))};createExportFunction=e=>(0,D.createExportFunction)(this.currentResult,e);getAvailableDrillTargets=()=>Di(this.visibleData,this.config?.measureGroupDimension,this.config?.columnHeadersPosition);refreshHeader=()=>{const e=this.gridApiGuard();e&&e.refreshHeader()};growToFit=e=>{if(!this.gridApiGuard())return;(0,Se.kG)(this.columnApi);const t=this.columnApi.getAllGridColumns();if((0,Se.kG)(t),this.resetColumnsWidthToDefault(e,t),this.clearFittedColumns(),t.map((e=>e.getActualWidth())).reduce(((e,t)=>e+t),0)<e.clientWidth){const i=_e(t);qi(this.columnApi,i,void 0),this.sizeColumnsToFitWithoutColumnReset(e),Yi(this.columnApi,i,Wt,(e=>e.getActualWidth()<=Wt)),this.setFittedColumns()}};setFittedColumns=()=>{(0,Se.kG)(this.columnApi);const e=this.columnApi.getAllGridColumns();(0,Se.kG)(e),e.forEach((e=>{const t=Le(e);this.growToFittedColumns[t]={width:e.getActualWidth()}}))};resetColumnsWidthToDefault=(e,t)=>{(0,Se.kG)(this.columnApi),function(e,t,i,o,r){const n=t.reduce(((e,t)=>{const n=Le(t);if(i.isColumnManuallyResized(t)){const o=i.getManuallyResizedColumn(t);o&&e.push({key:t,newWidth:o.width})}else Ot(o,n)?e.push({key:t,newWidth:o[n].width}):e.push({key:t,newWidth:r});return e}),[]);e.setColumnWidths(n)}(this.columnApi,t,this.resizedColumnsStore,this.autoResizedColumns,e.defaultWidth)};applyColumnSizes=e=>{if((0,Se.kG)(this.columnApi),this.resizedColumnsStore.updateColumnWidths(e.widths),function(e,t){if(!t)return;const i=t.getAllGridColumns();i?.forEach((t=>{const i=e.getManuallyResizedColumn(t);t.getColDef().suppressSizeToFit=!!i&&!i.allowGrowToFit}))}(this.resizedColumnsStore,this.columnApi),e.growToFit)this.growToFit(e);else{const t=this.columnApi.getAllGridColumns();(0,Se.kG)(t),this.resetColumnsWidthToDefault(e,t)}};autoresizeColumns=async(e,t=!1)=>{if(!this.gridApiGuard())return!1;if((0,Se.kG)(this.columnApi),this.resizing&&!t)return!1;const i=()=>this.resizing;if(this.isPivotTableReady()&&(!i()||i()&&t)){if(this.resizing=!0,await this.autoresizeAllColumns(e),e.growToFit)this.growToFit(e);else if(Yt(e.columnAutoresizeOption)&&this.shouldPerformAutoresize()){const t=this.columnApi.getAllGridColumns();(0,Se.kG)(t),this.resetColumnsWidthToDefault(e,t)}return this.resizing=!1,!0}return!1};autoresizeAllColumns=async e=>{if(this.gridApiGuard()){if((0,Se.kG)(this.columnApi),!this.shouldPerformAutoresize()||!Yt(e.columnAutoresizeOption))return Promise.resolve();await De(300),this.updateAutoResizedColumns(e),await async function(e,t){if(e){const i=e.getAllGridColumns().filter((e=>e.isPrimary())),o=Tt(i,50);for(const i of o)await new Promise((o=>{setTimeout((()=>{const r=i.reduce(((e,i)=>{const o=Le(i.getColDef()),r=t[o];return o&&r&&r.width&&e.push({key:o,newWidth:r.width}),e}),[]);e.setColumnWidths(r),o()}))}))}}(this.columnApi,this.autoResizedColumns)}};updateAutoResizedColumns=e=>{const t=this.gridApiGuard();t&&((0,Se.kG)(this.columnApi),(0,Se.kG)(e.containerRef),this.autoResizedColumns=qt(this.tableDescriptor,t,this.columnApi,this.currentResult,e,this.resizedColumnsStore,{measureHeaders:!0,padding:25,separators:e.separators},this.getGroupingProvider()))};getRowNodes=()=>{const e=this.gridApiGuard();if(!e)return[];const t=[];return e.forEachNode((e=>t.push(e.data))),t};isPivotTableReady=()=>{if(!this.gridApi||this.destroyed)return!1;const e=this.gridApi;return(()=>{const t=e.getCacheBlockState();return t&&Object.keys(t).every((e=>"loaded"===t[e].pageStatus||"failed"===t[e].pageStatus))})()&&((()=>Boolean(this.visibleData.rawData().isEmpty()&&this.visibleData.meta().hasNoHeadersInDim(0)))()||e.getRenderedNodes().length>0)};shouldPerformAutoresize=()=>{const e=this.gridApiGuard();if(!e)return!1;const t=e.getHorizontalPixelRange(),i=e.getVerticalPixelRange();return 0===t.left&&0===i.top};isColumnAutoResized=e=>Ot(this.autoResizedColumns,e);resetResizedColumn=async e=>{if(!this.tableDescriptor)return;const t=Le(e);this.resizedColumnsStore.isColumnManuallyResized(e)&&this.resizedColumnsStore.removeFromManuallyResizedColumn(e),e.getColDef().suppressSizeToFit=!1,this.isColumnAutoResized(t)?this.columnApi?.setColumnWidths([{key:e,newWidth:this.autoResizedColumns[t].width}]):(this.autoresizeColumnsByColumnId(this.columnApi,_e([e])),this.resizedColumnsStore.addToManuallyResizedColumn(e,!0))};autoresizeColumnsByColumnId=(e,t)=>{qi(e,t,Gt),e.autoSizeColumns(t),qi(e,t,Wt)};onColumnsManualReset=async(e,t)=>{if(!this.gridApiGuard())return;(0,Se.kG)(this.columnApi);let i=t;this.isAllMeasureOrAnyColumnTotalResizeOperation(e,t)&&(this.resizedColumnsStore.removeAllMeasureColumns(),i=this.getAllMeasureOrAnyTotalColumns()),this.isWeakMeasureResizeOperation(e,t)&&(i=this.resizedColumnsStore.getMatchingColumnsByMeasure(t[0],this.getAllMeasureColumns()),this.resizedColumnsStore.removeWeakMeasureColumn(t[0]));for(const e of i)await this.resetResizedColumn(e);this.afterOnResizeColumns(e)};getAllMeasureOrAnyTotalColumns=()=>{(0,Se.kG)(this.columnApi);const e=this.columnApi.getAllGridColumns();return(0,Se.kG)(e),e.filter((e=>Ue(e)))};getAllMeasureColumns=()=>{(0,Se.kG)(this.columnApi);const e=this.columnApi.getAllGridColumns();return(0,Se.kG)(e),e.filter((e=>Be(e)))};isAllMeasureOrAnyColumnTotalResizeOperation(e,t){return e.isMetaOrCtrlKeyPressed&&1===t.length&&Ue(t[0])}isWeakMeasureResizeOperation(e,t){return e.isAltKeyPressed&&1===t.length&&Be(t[0])}sizeColumnsToFitWithoutColumnReset(e){(0,Se.kG)(this.columnApi);const t=this.columnApi,i=e.clientWidth,o=this.columnApi?.getAllDisplayedColumns();if(i<=0||!o.length)return;let r=[];const n=[];o.forEach((function(e){!0===e.getColDef().suppressSizeToFit?n.push(e):r.push(e)}));let s=!1;function a(e){r=r.filter((t=>t!=e)),n.push(e)}const l=[];for(;!s;){s=!0;const e=i-this.getWidthOfColsInList(n);if(e<=0)r.forEach((function(e){const t=e.getMinWidth();l.push({key:e,newWidth:t})}));else{const t=e/this.getWidthOfColsInList(r);let i=e;for(let e=r.length-1;e>=0;e--){const o=r[e],n=Math.round(o.getActualWidth()*t);if(n<o.getMinWidth()){const e=o.getMinWidth();l.push({key:o,newWidth:e}),a(o),s=!1}else o.isGreaterThanMax(n)?(l.push({key:o,newWidth:o.getMaxWidth()}),a(o),s=!1):0===e?l.push({key:o,newWidth:i}):l.push({key:o,newWidth:n});i-=n}}}setTimeout((()=>{t.setColumnWidths(l,!0,"sizeColumnsToFit"),t.refreshCells()}))}getWidthOfColsInList(e){return e.reduce(((e,t)=>e+t.getActualWidth()),0)}onColumnsManualResized=(e,t)=>{this.isAllMeasureOrAnyColumnTotalResizeOperation(e,t)?function(e,t,i){const o=i.getActualWidth(),r=e.getAllGridColumns(),n=r?.filter(Ue).map((e=>({key:e,newWidth:o})));n?.length&&e.setColumnWidths(n),t.addAllMeasureColumn(o,r??[])}(this.columnApi,this.resizedColumnsStore,t[0]):this.isWeakMeasureResizeOperation(e,t)?function(e,t,i,o){const r=t.getAllGridColumns();i.addWeekMeasureColumn(o);const n=[];r?.forEach((t=>{const o=e.getCol(t),r=i.getMatchedWeakMeasuresColumnWidth(o);Be(t)&&r&&(n.push({key:t.getColId(),newWidth:r.measureColumnWidthItem.width.value}),t.getColDef().suppressSizeToFit=!0)})),t.setColumnWidths(n)}(this.tableDescriptor,this.columnApi,this.resizedColumnsStore,t[0]):t.forEach((e=>{this.resizedColumnsStore.addToManuallyResizedColumn(e)})),this.afterOnResizeColumns(e)};onManualColumnResize=async(e,t)=>{this.numberOfColumnResizedCalls++,await De(300),this.numberOfColumnResizedCalls===Y.DOUBLE_CLICK?(this.numberOfColumnResizedCalls=0,await this.onColumnsManualReset(e,t)):this.numberOfColumnResizedCalls===Y.CLICK&&(this.numberOfColumnResizedCalls=0,this.onColumnsManualResized(e,t))};afterOnResizeColumns=e=>{e.growToFit&&this.growToFit(e);const t=this.resizedColumnsStore.getColumnWidthsFromMap();e.onColumnResized?.(t)};getGroupingProvider=()=>((0,Se.kG)(this.agGridDataSource),this.agGridDataSource.getGroupingProvider());createSortItems=e=>this.tableDescriptor.createSortItems(e,this.currentResult.definition.sortBy);getSortItems=()=>this.currentResult.definition.sortBy;isMatchingExecution(e){if(this.originalExecution.fingerprint()===e.fingerprint())return!0;if(console.debug("Original execution fingerprint does not match."),this.transformedExecution){const t=this.transformedExecution.fingerprint()===e.fingerprint();return t||console.debug("transformed execution does not match",this.transformedExecution.definition,e.definition),t}const t=this.currentFingerprint===e.fingerprint();return t||console.debug("current result does not match",this.currentResult.definition,e.definition),t}getTotalBodyHeight=()=>{const e=this.gridApiGuard();if(!e)return 0;const t=this.visibleData,i=t.rawData().firstDimSize();let o=0;"left"===this.config?.columnHeadersPosition&&this.tableDescriptor.isTransposed()&&(o=t.meta().attributeHeadersForDim(1).length);const r=t.rawData().rowTotals()?.length??0;return to.getHeaderHeight(e)+(28*(i+o)+2)+28*r};updateStickyRowContent=e=>{const t=this.gridApiGuard();t&&function(e,t,i,o,r,n){if(!o||!function(e,t,i){const o=0===e.top,r=Ne(e.top,i)!==Ne(t.top,i),n=i,s=Ne(e.left,n),a=Ne(t.left,n);return o||r||s!==a}(e,t,i))return;const s=Ne(e.top,i),a=o.getDisplayedRowAtIndex(s),l=a?.data??null;if(null===l)return void n.removePinnedTopRowClass(o,"gd-visible-sticky-row");n.addPinnedTopRowClass(o,"gd-visible-sticky-row");const u=Ne(t.top,i),d=Object.keys(l).filter((e=>{const t=o.getColumnDef(e);return t?.type===T})),c={},h={};d.forEach((t=>{if(n.removeCellClass(o,t,u,"gd-cell-show-hidden"),r.isRepeatedValue(t,s+1))c[t]=l[t],h[t]=l.headerItemMap[t];else if(r.isColumnWithGrouping(t)){const r=Ne(e.top,i);n.addCellClass(o,t,r,"gd-cell-show-hidden")}}));const m=o.getPinnedTopRow(0)?.data,{headerItemMap:p,type:g,subtotalStyle:f,...C}=m;if(function(e,t){return Object.keys(e).length!==Object.keys(t).length||Object.keys(e).some((i=>e[i]!==t[i]))}(C,c)){const e=Q(h)?{}:{headerItemMap:h};o.updateGridOptions({pinnedTopRowData:[{...c,...e}]})}}(e.scrollPosition,e.lastScrollPosition,28,t,this.getGroupingProvider(),to)};updateStickyRowPosition=()=>{const e=this.gridApiGuard();e&&function(e,t=to){if(!e)return;const i=t.getHeaderHeight(e);t.setPinnedTopRowStyles(e,{top:`${i}px`,"padding-right":`${be()}px`})}(e)};initializeStickyRow=()=>{const e=this.gridApiGuard();e&&function(e){e.updateGridOptions({pinnedTopRowData:[]})}(e)};clearStickyRow=()=>{this.initializeStickyRow()};stickyRowExists=()=>{const e=this.gridApiGuard();return!!e&&function(e,t=to){return!!t.getPinnedTopRowElement(e)}(e)};getRowCount=()=>"left"===this.config?.columnHeadersPosition&&this.tableDescriptor.isTransposed()?this.visibleData.rawData().firstDimSize()+this.visibleData.meta().attributeHeadersForDim(1).length:this.visibleData.rawData().firstDimSize();isEmpty=()=>this.visibleData.rawData().isEmpty();getDrillDataContext=()=>this.visibleData;isResizing=()=>this.resizing;setTooltipFields=()=>{(0,Se.kG)(this.columnApi);const e=this.columnApi.getAllGridColumns();(0,Se.kG)(e),e.forEach((e=>{const t=e.getColDef();t.tooltipField=t.field}))}}class oo{execution;tableMethods;props;getCurrentAbortController;abandoned=!1;constructor(e,t,i,o){this.execution=e,this.tableMethods=t,this.props=i,this.getCurrentAbortController=o}abandon=()=>{(0,Se.kG)(!this.abandoned),this.abandoned=!0};isSameExecution(e){return this.execution.fingerprint()===e.fingerprint()}initialize=()=>{const{execution:e,tableMethods:t}=this;t.onLoadingChanged({isLoading:!0});let i=e;const o=this.getCurrentAbortController();return o&&(i=e.withSignal(o.signal)),i.execute().then((e=>e.readWindow([0,0],[this.props.pageSize,W]).then((i=>{if(this.abandoned)return;const o=this.createTableFacade(e,i);t.onLoadingChanged({isLoading:!1}),t.onExportReady(o.createExportFunction(this.props.exportTitle));const r=o.getAvailableDrillTargets();return t.pushData({dataView:i,availableDrillTargets:r}),{initializer:this,table:o}})).catch((i=>{if(!this.abandoned){if((0,bi.isUnexpectedResponseError)(i)){const i=Di(D.DataViewFacade.forResult(e),t.getMeasureGroupDimension(),t.getColumnHeadersPosition());this.props.pushData({availableDrillTargets:i})}if((0,bi.isNoDataError)(i)&&i.dataView){const e=Di(D.DataViewFacade.for(i.dataView),t.getMeasureGroupDimension(),t.getColumnHeadersPosition());t.pushData({availableDrillTargets:e}),t.onLoadingChanged({isLoading:!1})}t.onLoadingChanged({isLoading:!1}),t.onError((0,D.convertError)(i),this.execution)}})))).catch((e=>{this.abandoned||(t.onLoadingChanged({isLoading:!1}),t.onError((0,D.convertError)(e),this.execution))}))};createTableFacade=(e,t)=>new io(e,t,this.tableMethods,this.props,this.getCurrentAbortController)}class ro{initializer;table;gridOptions;firstDataRendered=!1;lastScrollPosition={top:0,left:0};isMetaOrCtrlKeyPressed=!1;isAltKeyPressed=!1;lastResizedWidth=0;lastResizedHeight=0;lastSortedColId=null;watchingIntervalId;destroy=()=>{this.abandonInitialization(),this.stopWatching(),this.table?.destroy()};abandonInitialization=()=>{this.initializer&&this.initializer.abandon(),this.initializer=void 0};stopWatching=()=>{this.watchingIntervalId&&(clearInterval(this.watchingIntervalId),this.watchingIntervalId=void 0)};startWatching=(e,t)=>{this.watchingIntervalId||(this.watchingIntervalId=window.setInterval(e,t))};checkAndUpdateLastSize=(e,t)=>(this.lastResizedWidth!==e||this.lastResizedHeight!==t)&&(this.lastResizedWidth=e,this.lastResizedHeight=t,!0)}var no=i(50361);r.O3h.registerModules([r.ea9]),(0,r.hbW)({theme:"legacy"});class so extends o.Component{static defaultProps={locale:"en-US",drillableItems:[],afterRender:Me,pushData:Me,onExportReady:Me,onLoadingChanged:Me,onError:Me,onDataView:Me,onDrill:()=>!0,ErrorComponent:D.ErrorComponent,LoadingComponent:D.LoadingComponent,pageSize:100,config:{},onColumnResized:Me};errorMap;containerRef;pivotTableId;internal;boundAgGridCallbacks;constructor(e){super(e);const{execution:t,config:i}=e;this.state={readyToRender:!1,columnTotals:no(ve(t.definition)),rowTotals:we(t.definition),desiredHeight:i.maxHeight,resized:!1,tempExecution:t,isLoading:!1},this.errorMap=(0,D.newErrorMapping)(e.intl),this.internal=new ro,this.boundAgGridCallbacks=this.createBoundAgGridCallbacks(),this.pivotTableId=(0,n.Z)().replace(/-/g,""),this.onLoadingChanged=this.onLoadingChanged.bind(this),this.props.config?.enableExecutionCancelling&&(this.abortController=new AbortController)}abortController;refreshAbortController=()=>{this.props.config?.enableExecutionCancelling&&(!this.state.isLoading&&this.state.readyToRender||this.abortController?.abort(),this.abortController=new AbortController)};getCurrentAbortController=()=>this.props.config?.enableExecutionCancelling?this.abortController:void 0;initialize=e=>{this.internal.abandonInitialization(),this.refreshAbortController();const t=new oo(e,this.getTableMethods(),this.props,this.getCurrentAbortController);return t.initialize().then((e=>{e&&this.internal.initializer===e.initializer&&(this.internal.initializer=void 0,this.internal.table=e.table,this.setState({readyToRender:!0}))})),t};reinitialize=e=>{this.setState({readyToRender:!1,columnTotals:no(ve(e.definition)),rowTotals:we(e.definition),error:void 0,desiredHeight:this.props.config.maxHeight,resized:!1},(()=>{this.internal.destroy(),this.internal=new ro,this.boundAgGridCallbacks=this.createBoundAgGridCallbacks(),this.internal.initializer=this.initialize(e)}))};componentDidMount(){this.internal.initializer=this.initialize(this.props.execution)}componentWillUnmount(){this.refreshAbortController(),this.containerRef&&this.containerRef.removeEventListener("mousedown",this.onContainerMouseDown),this.internal.destroy()}componentDidUpdate(e){if(this.state.readyToRender||!this.state.isLoading||this.props.config?.enableExecutionCancelling)if(this.isReinitNeeded(e))console.debug("triggering reinit",this.props.execution.definition,e.execution.definition),this.reinitialize(this.props.execution);else{this.shouldRefreshHeader(this.props,e)&&this.internal.table?.refreshHeader(),this.isGrowToFitEnabled()&&!this.isGrowToFitEnabled(e)&&this.growToFit();const t=this.getColumnWidths(e),i=this.getColumnWidths(this.props);B(t,i)||this.internal.table?.applyColumnSizes(this.getResizingConfig()),this.props.config?.maxHeight&&!B(this.props.config?.maxHeight,e.config?.maxHeight)&&this.updateDesiredHeight()}}isReinitNeeded(e){const t=B(e.drillableItems,this.props.drillableItems),i=B(e.config?.columnHeadersPosition,this.props.config?.columnHeadersPosition);if(!t)return console.debug("drilling is different",e.drillableItems,this.props.drillableItems),!0;if(!i)return!0;if(!this.internal.table){if(this.internal.initializer){const t=this.internal.initializer.isSameExecution(this.props.execution);return t||console.debug("initializer for different execution",this.props.execution,e.execution),!t}{const t=this.props.execution.fingerprint()===e.execution.fingerprint();return t||console.debug("have to reinit table",this.props.execution,e.execution),!t}}return this.props.config?.enableExecutionCancelling?e.execution.fingerprint()!==this.props.execution.fingerprint():!this.internal.table.isMatchingExecution(this.props.execution)}shouldRefreshHeader(e,t){return[e=>e?.config?.menu].some((i=>!B(i(e),i(t))))}stopEventWhenResizeHeader(e){e.target?.className?.includes?.("ag-header-cell-resize")&&(e.preventDefault(),e.stopPropagation())}setContainerRef=e=>{this.containerRef=e,this.containerRef&&this.containerRef.addEventListener("mousedown",this.onContainerMouseDown)};renderLoading(){const{LoadingComponent:e,theme:t}=this.props,i=t?.table?.loadingIconColor??t?.palette?.complementary?.c6??void 0;return o.createElement("div",{className:"s-loading gd-table-loading"},e?o.createElement(e,{color:i}):null)}render(){const{ErrorComponent:e}=this.props,{desiredHeight:t,error:i}=this.state;if(i){const t=this.errorMap[Object.prototype.hasOwnProperty.call(this.errorMap,i)?i:D.ErrorCodes.UNKNOWN_ERROR];return e?o.createElement(e,{code:i,...t}):null}const n={height:t||"100%",position:"relative",overflow:"hidden"};if(!this.state.readyToRender)return o.createElement("div",{className:"gd-table-component",style:n,id:this.pivotTableId},this.renderLoading());(0,Se.kG)(this.internal.table),this.internal.gridOptions||(this.internal.gridOptions=function(e,t,i){const{colDefs:o}=e.tableDescriptor,{pageSize:r}=i,n=e.getRowCount(),s=o.sliceColDefs.concat(o.rootDataColDefs),a=i.config?.menu?10:0,l=Math.min(r,n+a),u={onMenuAggregationClick:t.onMenuAggregationClick,getTableDescriptor:()=>e.tableDescriptor,getExecutionDefinition:t.getExecutionDefinition,getColumnTotals:t.getColumnTotals,getRowTotals:t.getRowTotals,intl:i.intl,setLastSortedColId:t.setLastSortedColId},d="left"===t.getColumnHeadersPosition()&&e.tableDescriptor.isTransposed();return{columnDefs:s,defaultColDef:{cellClass:et(e,i),headerComponent:Dt,headerComponentParams:{menu:t.getMenuConfig,enableSorting:!0,...u},minWidth:zt,sortable:!0,resizable:!0},defaultColGroupDef:{headerClass:Jt(e),children:[],headerGroupComponent:Qt,headerGroupComponentParams:{menu:t.getMenuConfig,...u}},onCellClicked:oi(e,i),onCellKeyDown:ri(e,i),onSortChanged:t.onSortChanged,onColumnResized:t.onGridColumnResized,onGridColumnsChanged:t.onGridColumnsChanged,onModelUpdated:t.onModelUpdated,onPinnedRowDataChanged:t.onPinnedRowDataChanged,focusGridInnerElement:i=>{const o="left"===t.getColumnHeadersPosition()&&e.tableDescriptor.isTransposed(),r=i.api.getAllDisplayedColumns()[0];return o?i.api.setFocusedCell(0,r.getId()):i.api.setFocusedHeader(r.getId()),!0},tabToNextHeader:()=>!1,tabToNextCell:()=>!1,suppressMovableColumns:!0,suppressCellFocus:!1,suppressHeaderFocus:!1,suppressAutoSize:t.hasColumnWidths,rowModelType:"infinite",paginationPageSize:l,cacheOverflowSize:l,cacheBlockSize:l,maxConcurrentDatasourceRequests:1,infiniteInitialRowCount:l,maxBlocksInCache:10,onGridReady:t.onGridReady,onFirstDataRendered:t.onFirstDataRendered,onBodyScroll:t.onBodyScroll,onGridSizeChanged:t.onGridSizeChanged,columnTypes:{[T]:ui(e,i),[I]:hi(e,i),[y]:gi(e,i),[R]:di(e,i),[x]:Ci(e,i),[M]:mi(e,i),[E]:fi(e,i),[k]:fi(e,i)},rowClass:"gd-table-row",rowHeight:28,autoSizePadding:12,enableBrowserTooltips:!0,headerHeight:d?0:void 0}}(this.internal.table,this.getTableMethods(),this.props));const a=(this.isColumnAutoresizeEnabled()||this.isGrowToFitEnabled())&&!this.state.resized,l=b("gd-table-component",{"gd-table-header-hide":"left"===this.props.config?.columnHeadersPosition&&this.internal.table.tableDescriptor.isTransposed()});return o.createElement("div",{className:l,style:n,id:this.pivotTableId,onMouseDown:this.stopEventWhenResizeHeader,onDragStart:this.stopEventWhenResizeHeader},o.createElement("div",{className:"gd-table ag-theme-balham s-pivot-table",style:n,ref:this.setContainerRef},o.createElement(s.s,{...this.internal.gridOptions,modules:[r.ea9]}),a?this.renderLoading():null))}onGridReady=e=>{(0,Se.kG)(this.internal.table),this.internal.table.finishInitialization(e.api,e.api),this.updateDesiredHeight(),this.getGroupRows()&&this.internal.table.initializeStickyRow(),this.internal.table.setTooltipFields(),this.internal.table.isEmpty()&&this.onFirstDataRendered()};onFirstDataRendered=async e=>{(0,Se.kG)(this.internal.table),this.internal.firstDataRendered&&console.error("onFirstDataRendered called multiple times"),this.internal.firstDataRendered=!0,this.internal.startWatching(this.startWatchingTableRendered,500),this.isColumnAutoresizeEnabled()?await this.autoresizeColumns():this.isGrowToFitEnabled()&&this.growToFit(),this.updateStickyRow()};onModelUpdated=e=>{if(this.updateStickyRow(),this.internal.table?.isPivotTableReady()){const t=this.getLastSortedColId();t&&e.api&&(e.api.setFocusedHeader(t),this.setLastSortedColId(null))}};onGridColumnsChanged=()=>{this.updateStickyRow()};onGridSizeChanged=e=>{this.internal.firstDataRendered&&this.internal.table&&(this.internal.table.isResizing()||this.internal.checkAndUpdateLastSize(e.clientWidth,e.clientHeight)&&this.autoresizeColumns(!0))};onGridColumnResized=async e=>{(0,Se.kG)(this.internal.table),e.finished&&(this.updateDesiredHeight(),function(e){return e?.source===q.UI_RESIZED&&!!e.columns}(e)&&this.internal.table.onManualColumnResize(this.getResizingConfig(),e.columns))};onSortChanged=e=>{if(!this.internal.table)return void console.warn("changing sorts without prior execution cannot work");const t=this.internal.table.createSortItems(e.api.getAllGridColumns()),i=ve(this.getExecutionDefinition(),t);console.debug("onSortChanged",t),this.pushDataGuard({properties:{sortItems:t,totals:i,bucketType:D.BucketNames.ATTRIBUTE}}),this.setState({columnTotals:i},(()=>{this.internal.table?.refreshData()}))};onPinnedRowDataChanged=async e=>{e?.api.getPinnedBottomRowCount()>0&&await this.autoresizeColumns(!0)};onBodyScroll=e=>{const t={top:Math.max(e.top,0),left:e.left};this.updateStickyRowContent(t)};onContainerMouseDown=e=>{this.internal.isMetaOrCtrlKeyPressed=e.metaKey||e.ctrlKey,this.internal.isAltKeyPressed=e.altKey};onPageLoaded=(e,t)=>{this.props.onDataView?.(e),this.internal.table&&(t&&this.props.onExportReady?.(this.internal.table.createExportFunction(this.props.exportTitle)),this.updateStickyRow(),this.updateDesiredHeight())};onExecutionTransformed=e=>{this.internal.table&&(this.internal.table.clearStickyRow(),B(this.state.tempExecution.definition.buckets[2],e.definition.buckets[2])||(this.setState({tempExecution:e}),this.reinitialize(e)))};onMenuAggregationClick=e=>{const t=this.internal.table?.getSortItems(),{isColumn:i}=e;if(i){const i=ve(this.getExecutionDefinition(),t,V(this.getColumnTotals(),e));this.pushDataGuard({properties:{totals:i,bucketType:D.BucketNames.ATTRIBUTE}}),this.setState({columnTotals:i},(()=>{this.internal.table?.refreshData()}))}else{const t=V(this.getRowTotals(),e);this.setState({rowTotals:t},(()=>{this.internal.table?.refreshData()})),this.pushDataGuard({properties:{totals:t,bucketType:D.BucketNames.COLUMNS}})}};onLoadingChanged=e=>{const{onLoadingChanged:t}=this.props;t&&(t(e),this.setState({isLoading:e.isLoading}))};onError=(e,t=this.props.execution)=>{const{onExportReady:i}=this.props;this.props.execution.fingerprint()===t.fingerprint()&&(this.setState({error:e.getMessage(),readyToRender:!0}),this.onLoadingChanged({isLoading:!1}),i((0,D.createExportErrorFunction)(e)),this.props.onError?.(e))};growToFit=()=>{(0,Se.kG)(this.internal.table),this.isGrowToFitEnabled()&&(this.internal.table.growToFit(this.getResizingConfig()),this.state.resized||this.internal.table.isResizing()||this.setState({resized:!0}))};autoresizeColumns=async(e=!1)=>{if(this.state.resized&&!e)return;const t=await(this.internal.table?.autoresizeColumns(this.getResizingConfig(),e));t&&this.updateDesiredHeight(),t&&!this.state.resized&&this.setState({resized:!0})};shouldAutoResizeColumns=()=>{const e=this.isColumnAutoresizeEnabled(),t=this.isGrowToFitEnabled();return e||t};startWatchingTableRendered=()=>{if(!this.internal.table)return;const e=!this.containerRef,t=this.shouldAutoResizeColumns()?this.state.resized:this.internal.table.isPivotTableReady(),i=this.internal.table.isPivotTableReady()&&!this.state.resized&&!this.internal.table.isResizing();this.shouldAutoResizeColumns()&&i&&this.autoresizeColumns(),(e||t)&&this.stopWatchingTableRendered()};stopWatchingTableRendered=()=>{this.internal.stopWatching(),this.props.afterRender()};isStickyRowAvailable=()=>((0,Se.kG)(this.internal.table),Boolean(this.getGroupRows()&&this.internal.table.stickyRowExists()));updateStickyRow=()=>{if(this.internal.table&&this.isStickyRowAvailable()){const e={...this.internal.lastScrollPosition};this.internal.lastScrollPosition={top:0,left:0},this.updateStickyRowContent(e)}};updateStickyRowContent=e=>{(0,Se.kG)(this.internal.table),this.isStickyRowAvailable()&&(this.internal.table.updateStickyRowPosition(),this.internal.table.updateStickyRowContent({scrollPosition:e,lastScrollPosition:this.internal.lastScrollPosition})),this.internal.lastScrollPosition={...e}};getScrollBarPadding=()=>this.internal.table?.isFullyInitialized()&&this.containerRef&&function(e){const{scrollWidth:t,clientWidth:i}=e.getElementsByClassName("ag-body-horizontal-scroll-viewport")[0];return t>i}(this.containerRef)?be():0;calculateDesiredHeight=()=>{const{maxHeight:e}=this.props.config;if(!e)return;const t=(this.internal.table?.getTotalBodyHeight()??0)+this.getScrollBarPadding();return Math.min(t,e)};updateDesiredHeight=()=>{if(!this.internal.table)return;const e=this.calculateDesiredHeight();(void 0===this.state.desiredHeight||void 0!==e&&Math.abs(this.state.desiredHeight-e)>2)&&this.setState({desiredHeight:e})};getLastSortedColId=()=>this.internal.lastSortedColId;setLastSortedColId=e=>{this.internal.lastSortedColId=e};getColumnTotals=()=>this.state.columnTotals;getRowTotals=()=>this.state.rowTotals;getExecutionDefinition=()=>this.props.execution.definition;getGroupRows=()=>this.props.config?.groupRows??!0;getMeasureGroupDimension=()=>this.props.config?.measureGroupDimension??"columns";getColumnHeadersPosition=()=>this.props.config?.columnHeadersPosition??"top";getMenuConfig=()=>this.props.config?.menu??{};getDefaultWidth=()=>200;isColumnAutoresizeEnabled=()=>{const e=this.getDefaultWidthFromProps(this.props);return Yt(e)};isGrowToFitEnabled=(e=this.props)=>!0===e.config?.columnSizing?.growToFit;getColumnWidths=e=>e.config.columnSizing?.columnWidths;hasColumnWidths=()=>!!this.getColumnWidths(this.props);getDefaultWidthFromProps=e=>e.config?.columnSizing?.defaultWidth??"unset";pushDataGuard=e=>{this.props.pushData?.(e)};stateBoundCallback=e=>{const t=this.internal;return(...i)=>{if(this.internal===t)return e(...i)}};createBoundAgGridCallbacks=()=>{const e=xe(this.stateBoundCallback(this.onGridSizeChanged),300);return{onGridReady:this.stateBoundCallback(this.onGridReady),onFirstDataRendered:this.stateBoundCallback(this.onFirstDataRendered),onBodyScroll:this.stateBoundCallback(this.onBodyScroll),onModelUpdated:this.stateBoundCallback(this.onModelUpdated),onGridColumnsChanged:this.stateBoundCallback(this.onGridColumnsChanged),onGridColumnResized:this.stateBoundCallback(this.onGridColumnResized),onSortChanged:this.stateBoundCallback(this.onSortChanged),onGridSizeChanged:e,onPinnedRowDataChanged:this.stateBoundCallback(this.onPinnedRowDataChanged)}};getTableMethods=()=>({hasColumnWidths:this.hasColumnWidths(),getExecutionDefinition:this.getExecutionDefinition,getMenuConfig:this.getMenuConfig,getGroupRows:this.getGroupRows,getColumnTotals:this.getColumnTotals,getRowTotals:this.getRowTotals,getColumnHeadersPosition:this.getColumnHeadersPosition,getMeasureGroupDimension:this.getMeasureGroupDimension,getResizingConfig:this.getResizingConfig,onLoadingChanged:this.onLoadingChanged,onError:this.onError,onExportReady:this.props.onExportReady??Me,pushData:this.pushDataGuard,onPageLoaded:this.onPageLoaded,onExecutionTransformed:this.onExecutionTransformed,onMenuAggregationClick:this.onMenuAggregationClick,setLastSortedColId:this.setLastSortedColId,...this.boundAgGridCallbacks});getResizingConfig=()=>({defaultWidth:this.getDefaultWidth(),growToFit:this.isGrowToFitEnabled(),columnAutoresizeOption:this.getDefaultWidthFromProps(this.props),widths:this.getColumnWidths(this.props),isAltKeyPressed:this.internal.isAltKeyPressed,isMetaOrCtrlKeyPressed:this.internal.isMetaOrCtrlKeyPressed,clientWidth:this.containerRef?.getElementsByClassName("ag-body-viewport")[0]?.clientWidth??0,containerRef:this.containerRef,separators:this.props?.config?.separators,onColumnResized:this.props.onColumnResized})}const ao=(lo=(0,v.Zz)(so),ho=(co={}).intlPropName,mo=void 0===ho?"intl":ho,go=void 0!==(po=co.forwardRef)&&po,Co=void 0===(fo=co.enforceContext)||fo,bo=function(e){return h.createElement(f,null,(function(t){var i;Co&&p(t);var o=((i={})[mo]=t,i);return h.createElement(lo,a({},e,o,{ref:go?e.forwardedRef:null}))}))},bo.displayName="injectIntl(".concat((uo=lo).displayName||uo.name||"Component",")"),bo.WrappedComponent=lo,go?c()(h.forwardRef((function(e,t){return h.createElement(bo,a({},e,{forwardedRef:t}))})),lo):c()(bo,lo));var lo,uo,co,ho,mo,po,go,fo,Co,bo;const Do=e=>o.createElement(v.ze,{theme:e.theme||{},themeIsLoading:!1},o.createElement(D.IntlWrapper,{locale:e.locale},o.createElement(ao,{...e})));function vo(e){return"rows"===(e.measureGroupDimension??"columns")}const wo=e=>{const{rows:t,columns:i,config:o={}}=e;if("left"===o.columnHeadersPosition){const e=i&&i.length>0;return!t&&e&&"rows"===o.measureGroupDimension?o:(console.warn("Invalid table configuration. `columnHeadersPosition: left` requires metrics in rows, no row attributes and at least one column attribute defined."),{...o,columnHeadersPosition:"top"})}return o};class To extends o.Component{render(){const{exportTitle:e,backend:t,workspace:i,config:r={}}=this.props;(0,Se.kG)(t,"Backend was not provided for PivotTable. Either pass it as a prop or use BackendContext."),(0,Se.kG)(i,"Workspace was not provided for PivotTable. Either pass it as a prop or use WorkspaceContext.");const n=vt(this.props,["measures","rows","columns","totals","filters","sortBy"]),s={...wo(this.props),menu:Ro(t.capabilities,r?.menu)},a=vt(n,["backend","workspace"]),l=function(e){const{backend:t,workspace:i,filters:o,sortBy:r=[],execConfig:n={},config:s={}}=e,a=function(e,t){return t?e.filter((e=>!(0,w.isMeasureSort)(e))):e}(r,vo(s));return t.withTelemetry("PivotTable",e).workspace(i).execution().forBuckets(function(e){const{measures:t=[],rows:i=[],columns:o=[],totals:r=[]}=e,n=r.filter((e=>i.find((t=>t.attribute.localIdentifier===e.attributeIdentifier)))),s=r.filter((e=>o.find((t=>t.attribute.localIdentifier===e.attributeIdentifier))));return[(0,w.newBucket)(D.BucketNames.MEASURES,...t),(0,w.newBucket)(D.BucketNames.ATTRIBUTE,...i,...n),(0,w.newBucket)(D.BucketNames.COLUMNS,...o,...s)]}(e),o).withDimensions((e=>Mo(e.buckets,vo(s)))).withSorting(...a).withExecConfig(n)}(this.props);return o.createElement(D.IntlWrapper,{locale:this.props.locale},o.createElement(D.IntlTranslationsProvider,null,(t=>o.createElement(so,{...a,config:s,intl:t.intl,execution:l,exportTitle:e||"PivotTable"}))))}}const Io=(0,D.withContexts)(To),yo=e=>{const[t,i,r,n,s,a]=(0,D.useResolveValuesWithPlaceholders)([e.measures,e.columns,e.rows,e.totals,e.filters,e.sortBy],e.placeholdersResolutionContext);return o.createElement(Io,{...e,measures:t,columns:i,rows:r,totals:n,filters:s,sortBy:a})};function Ro(e,t={}){const i={...t};return e.canCalculateGrandTotals?(e.canCalculateNativeTotals||(i.aggregationTypes=(i.aggregationTypes??z).filter((e=>"nat"!==e))),0===i.aggregationTypes?.length?{aggregations:!1}:i):{aggregations:!1}}function Mo(e,t){const i=(0,w.bucketsFind)(e,D.BucketNames.ATTRIBUTE),o=(0,w.bucketsFind)(e,D.BucketNames.COLUMNS),r=(0,w.bucketsFind)(e,D.BucketNames.MEASURES),n=i?(0,w.bucketAttributes)(i):[],s=o?(0,w.bucketAttributes)(o):[],a=r&&!(0,w.bucketIsEmpty)(r)?[w.MeasureGroupIdentifier]:[],l=i?(0,w.bucketTotals)(i):[],u=o?(0,w.bucketTotals)(o):[],d=t?a:[],c=t?[]:a;return(0,w.newTwoDimensional)([...n,...d,...l],[...s,...u,...c])}},36360:(e,t,i)=>{function o(e,t){return e||t}i.d(t,{U:()=>o})}}]);