(self.webpackChunkradial_bar_chart_plugin=self.webpackChunkradial_bar_chart_plugin||[]).push([[1186],{4270:(e,t,n)=>{n.d(t,{$t:()=>m,Cu:()=>u,Gq:()=>z,I7:()=>a,J5:()=>x,KZ:()=>T,Mc:()=>M,N6:()=>p,Pm:()=>s,RW:()=>S,Ul:()=>i,VL:()=>D,X9:()=>g,eH:()=>l,gN:()=>d,gc:()=>h,hm:()=>O,jc:()=>R,lS:()=>f,m6:()=>v,me:()=>w,nJ:()=>c,ri:()=>P,ry:()=>k,sV:()=>B,ti:()=>b,vB:()=>E,vR:()=>j,wu:()=>C,yJ:()=>L,yv:()=>N,z2:()=>y});var o=n(53244),r=n(2525);const i={northEast:{lat:-84,lng:-180},southWest:{lat:84,lng:180}},s={continent_af:[{lat:-36,lng:-20},{lat:38,lng:54}],continent_as:[{lat:-8,lng:26},{lat:64,lng:146}],continent_au:[{lat:-50,lng:107},{lat:0,lng:180}],continent_eu:[{lat:36,lng:-24},{lat:72,lng:43}],continent_na:[{lat:11,lng:-170},{lat:72,lng:-52}],continent_sa:[{lat:-56,lng:-90},{lat:14,lng:-31}],world:[i.northEast,i.southWest]},a=["has","point_count"],l={id:"gdcClusterLabels",type:"symbol",layout:{"text-allow-overlap":!0,"text-field":"{point_count_abbreviated}","text-font":["Lato Bold"],"text-size":14},paint:{"text-color":"#fff"}},c="gdcClusters",u=14,d={"circle-stroke-color":["step",["get","point_count"],"#00D398",10,"#F38700",100,"#E84C3C"],"circle-stroke-opacity":.2,"circle-stroke-width":8},m=["step",["get","point_count"],"#00D398",10,"#F38700",100,"#E84C3C"],g=["step",["get","point_count"],15,100,25],p={min:{default:8,"0.5x":4,"0.75x":6,normal:8,"1.25x":10,"1.5x":12},max:{default:60,"0.5x":30,"0.75x":45,normal:60,"1.25x":75,"1.5x":90}},f=50,h=25e3,x="gdcPushpinsData",b="gdcPushpins",C=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],I=(0,o.colorPaletteToColors)(r.DefaultColorPalette),v=2,k={lat:34,lng:5},y="rgb(233,237,241)",N=.7,L=6,w=I[0],T={"circle-stroke-width":1},B={attributionControl:!1,dragRotate:!1,fitBoundsOptions:{padding:45,maxDuration:1},maxBounds:s.world,maxZoom:14,pitchWithRotate:!1,renderWorldCopies:!1,touchZoomRotate:!1,style:"mapbox://styles/gooddata/ck88ltry127yx1iql358df6xn"},S={closeButton:!1,closeOnClick:!1,offset:10},z="circle",D="circle-color",O="circle-radius",j="circle-stroke-color",R="empty-segment-filter",P="-label",E="-",M=100},3746:(e,t,n)=>{n.d(t,{fC:()=>f,yQ:()=>p});var o=n(79697),r=n(96446),i=n(53244),s=n(4270);function a(e,t,n,o=1){return 1===o?`rgb(${e},${t},${n})`:`rgba(${e},${t},${n},${o})`}function l(e){const t=e.split(",");return{R:parseInt(t[0].slice(4),10),G:parseInt(t[1],10),B:parseInt(t[2],10)}}function c(e,t,n){return Math.trunc(e+t*n)}function u(e,t=1){const{r:n,g:o,b:i}=function(e){if("string"==typeof e){const{R:t,G:n,B:o}=l(e);return{r:t,g:n,b:o}}return e}(e),s=[n,o,i],u=s.map((e=>(255-e)/6)),d=function(e,t,n,o=1){return(0,r.Z)(1,e).map((e=>a(c(t[0],e,n[0]),c(t[1],e,n[1]),c(t[2],e,n[2]),o)))}(6,s,u,t);return[...d.reverse(),a(n,o,i,t)]}var d=n(50038);const m="default_segment_item",g=s.yJ-1;function p(e,t=[],n){const o=function(e,t=1){const{R:n,G:o,B:r}=l(e);return a(n,o,r,t)}(n.getColorByIndex(0),s.yv);if(!e.length&&!t.length)return[{border:s.z2,background:o}];const r=[...t],c=function(e){return e.getColorAssignment().reduce(((t,n,o)=>{const r=u(e.getColorByIndex(o),s.yv);return(0,i.isAttributeDescriptor)(n.headerItem)?{[m]:r}:(t[((0,i.isResultAttributeHeader)(n.headerItem)?n.headerItem.attributeHeaderItem.name:m)??m]=r,t)}),{})}(n);if(!e.length)return r.map((e=>{const t=c[e];return{border:s.z2,background:t[g]}}));const p=e.filter((e=>null!==e&&Number.isFinite(e))),{min:f,max:h}=(0,d.X9)(p);return f!==h||t.length?e.map(((e,t)=>{const n=function(e,t,n){if(null===e||!Number.isFinite(e)||t===n||e===t)return 0;if(e===n)return g;const o=(n-t)/s.yJ;for(let n=0,r=t;n<s.yJ;n++,r+=o)if(r>=e)return n;return g}(null!==e&&Number.isFinite(e)?e:f,f,h),o=r[t]||m,i=c[o];return{border:i[g],background:i[n]}})):[{border:s.z2,background:o}]}function f(e,t){if((0,o.Z)(e))return[];const n=u(t,s.yv),i=Math.min(...e),a=Math.max(...e),l=(a-i)/s.yJ;return i===a?[]:(0,r.Z)(0,s.yJ).map((e=>{const t=i+l*e;return{range:{from:t,to:e===s.yJ-1?a:t+l},color:n[e]}}))}},50038:(e,t,n)=>{n.d(t,{B8:()=>u,Ur:()=>l,V5:()=>m,Wl:()=>h,X9:()=>f,aL:()=>b,cT:()=>p,eC:()=>x,iP:()=>g,j3:()=>d,xm:()=>a});var o=n(50576),r=n(53244),i=n(2525),s=n(91964);function a(e,t){const{color:n,size:o}=t,r=void 0!==n||void 0!==o?1:0;return e.meta().allHeaders()[r]}function l(e,t,n){const{location:o}=t,r=a(e,t);return(void 0===o?[]:r[o.index]).length<=n}const c=e=>void 0!==e&&!(0,r.bucketIsEmpty)(e);function u(e){const t=(0,r.bucketsFind)(e,i.BucketNames.LOCATION),n=(0,r.bucketsFind)(e,i.BucketNames.LATITUDE),o=(0,r.bucketsFind)(e,i.BucketNames.LONGITUDE);return c(t)||c(n)&&c(o)}function d(e=[]){return e.length?e.reduce(((e,t)=>e+t),0)/e.length:0}function m(e,t){return e.meta().measureDescriptors()[t].measureHeaderItem.format}function g(e,t=!0){const{color:n,location:o,segment:r,size:i}=e;return Boolean(t&&o&&!(n||r||i))}function p(e,t){return!(0,o.Z)(e,t)}function f(e){return e.reduce(((e,t)=>isFinite(t)?{min:e.min&&isFinite(e.min)?Math.min(t,e.min):t,max:e.max&&isFinite(e.max)?Math.max(t,e.max):t}:e),{min:void 0,max:void 0})}function h(e){if(null===e)return NaN;const t="string"==typeof e?parseFloat(e):e;return isNaN(t)&&console.warn(`SDK: utils - stringToFloat: ${e} is not a number`),t}function x(e,t){return!0===(0,s.o2)(e)&&t}function b(e,t){return!(0,o.Z)(e,t)}},34910:(e,t,n)=>{n.d(t,{Bz:()=>p,Dc:()=>f,T6:()=>m,uR:()=>l});var o=n(53244),r=n(2525),i=n(50038);function s(e){if(!e)return null;const[t,n]=e.split(";").map(i.Wl);return isNaN(t)||isNaN(n)?(console.warn("UI-SDK: geoChartDataSource - getLocation: invalid location",e),null):{lat:t,lng:n}}function a(e){if(!e)return null;const t=(0,i.Wl)(e);return isNaN(t)?(console.warn("UI-SDK: geoChartDataSource - getLocation: invalid latitude/longitude coordinate",t),null):t}function l(e,t,n){const l=function(e){const t=e.def().buckets(),n=e.meta().measureDescriptors(),i=e.meta().attributeDescriptors(),s=t.reduce(((e,t)=>(e[t.localIdentifier]=function(e){if(!e)return null;if((0,o.isAttribute)(e))return{localIdentifier:(0,o.attributeLocalId)(e),...d((0,o.attributeDisplayFormRef)(e))};const t=(0,o.measureLocalId)(e),n=(0,o.measureItem)(e);return n?{localIdentifier:t,...d(n)}:{localIdentifier:t}}(t.items[0]),e)),{}),a={};return[r.BucketNames.LOCATION,r.BucketNames.LATITUDE,r.BucketNames.LONGITUDE,r.BucketNames.SEGMENT,r.BucketNames.TOOLTIP_TEXT].forEach((e=>{const t=s[e];if(!t)return;const n=i.findIndex((e=>e.attributeHeader.localIdentifier===t.localIdentifier&&(e.attributeHeader.uri===t.uri||e.attributeHeader.identifier===t.identifier)));if(-1!==n){const{formOf:{name:t}}=i[n].attributeHeader;a[e]={index:n,name:t}}})),[r.BucketNames.SIZE,r.BucketNames.COLOR].forEach((e=>{const t=s[e];if(!t)return;const o=n.findIndex((e=>e.measureHeaderItem.localIdentifier===t.localIdentifier&&(e.measureHeaderItem.uri===t.uri||e.measureHeaderItem.identifier===t.identifier)));-1!==o&&(a[e]={index:o,name:n[o].measureHeaderItem.name})})),a}(e),m=(0,i.xm)(e,l),g=l.location?.index,p=l.latitude?.index,f=l.longitude?.index,h=l?.segment?.index,x=l?.tooltipText?.index,b=l?.size?.index,C=l?.color?.index;if(void 0!==g){const e=u(m,g,t,n);l[r.BucketNames.LOCATION].data=e.map(s)}if(void 0!==p&&null!=f){const e=u(m,p,t,n),o=u(m,f,t,n);l[r.BucketNames.LOCATION]={...l[r.BucketNames.LATITUDE],data:e.map(((e,t)=>({lat:a(e),lng:a(o[t])})))}}if(void 0!==h){const{data:e,uris:t}=function(e,t,n){return e[t].reduce(((e,t)=>{if(t&&(0,o.isResultAttributeHeader)(t)){const{uri:o,name:r}=t.attributeHeaderItem;return{uris:[...e.uris,o],data:[...e.data,r??n]}}return e}),{uris:[],data:[]})}(m,h,n);l[r.BucketNames.SEGMENT].data=e,l[r.BucketNames.SEGMENT].uris=t}return void 0!==x&&(l[r.BucketNames.TOOLTIP_TEXT].data=u(m,x,t,n)),void 0!==b&&(l[r.BucketNames.SIZE].data=c(e,b),l[r.BucketNames.SIZE].format=(0,i.V5)(e,b)),void 0!==C&&(l[r.BucketNames.COLOR].data=c(e,C),l[r.BucketNames.COLOR].format=(0,i.V5)(e,C)),l}function c(e,t){return e.rawData().twoDimData()[t].map(i.Wl)}function u(e,t,n,r){return e[t].map((e=>{const t=(0,o.resultHeaderName)(e);return t||(""===t?n:r)}))}function d(e){return(0,o.isIdentifierRef)(e)?{identifier:e.identifier}:{uri:e.uri}}function m(e,t){const{color:{data:n=[]}={},size:{data:o=[]}={}}=t,{min:r,max:s}=(0,i.X9)(n),{min:a,max:l}=(0,i.X9)(o),c=Boolean(e?.length);return{hasCategoryLegend:c,hasColorLegend:Boolean(n.length)&&r!==s&&!c,hasSizeLegend:Boolean(o.length)&&a!==l}}function g(e){try{return JSON.parse(e)}catch{return{}}}function p(e){const{locationName:t="{}",color:n="{}",size:o="{}",segment:r="{}"}=e||{};return{locationName:g(t),size:g(o),color:g(n),segment:g(r)}}function f(e,t){const{color:n,location:o,segment:r,size:i,tooltipText:s}=t,a=o?.index??0,l=e.meta().allHeaders(),c=i||n?1:0,u=e.meta().attributeDescriptors(),d=l[c];return{locationAttribute:{...u[a].attributeHeader,items:d[a]},segmentByAttribute:r?.data.length?{...u[r.index].attributeHeader,items:d[r.index]}:void 0,tooltipTextAttribute:s?.data.length?{...u[s.index].attributeHeader,items:d[s.index]}:void 0}}},91964:(e,t,n)=>{n.d(t,{AW:()=>d,C1:()=>g,M3:()=>f,fO:()=>u,i1:()=>p,iD:()=>h,o2:()=>c,yd:()=>m});const o=260,r=330,i=410,s=410;function a(e){return!e||e>=o}function l(e){return!e||e>=r}function c(e){return u(e)?e:Boolean(e)}function u(e){return"autoPositionWithPopup"===e}function d(e,t,n){const o=u(n)&&!function(e){return!e||e>=s}(e);let r="large";return o&&(r="small"),t&&(r="medium"),r}function m(e,t,n){return u(n)&&e&&a(t)?e:void 0}function g(e,t,n){return!t&&u(n)&&!l(e)}function p(e,t,n){return!n&&a(t)?e:void 0}function f(e,t){return!l(e)&&Boolean(t)}function h(e,t){return t||l(e)&&(!e||e>=i)}},90226:(e,t,n)=>{n.r(t),n.d(t,{CoreGeoChart:()=>me,GeoPushpinChart:()=>be,MapboxTokenProvider:()=>se,enrichMapboxToken:()=>le,getColorMappingPredicate:()=>d.NK,getGeoChartDimensions:()=>pe,useMapboxToken:()=>ue,useMapboxTokenStrict:()=>ce,withMapboxToken:()=>ae});var o=n(55348),r=n(29732),i=n(8297),s=n(53244),a=n(2525),l=n(25972),c=n(86122),u=n(47591),d=n(16576),m=n(35967),g=n(80961),p=n(34910);class f extends m.eH{createColorAssignment(e,t,n,o,r){return o?{fullColorAssignment:this.getColorStrategyForSegmentBy(e,t,o,r)}:{fullColorAssignment:[this.getColorStrategyForLocation(e,t,n,r)]}}getColorStrategyForSegmentBy(e,t,n,o){return new g.l(e,t,null,n,o).getColorAssignment()}getColorStrategyForLocation(e,t,n,o){const r=(0,d.gG)(n,t,o);return{headerItem:n,color:void 0!==r&&(0,m.HY)(r,e)?r:{type:"guid",value:e[0].guid}}}}var h=n(4270),x=n(94184),b=n(25356),C=n(111),I=n(88699),v=n(65846),k=n(40207),y=n(17096),N=n(90297),L=n(85932),w=n(33805),T=n(3746),B=n(91964),S=n(75131),z=n(72666),D=n(19679);const O=161;function j(e){const{contentRect:t,hasSizeLegend:n,isFluidLegend:r,renderPopUp:i,isSizeLegendVisible:s=!0}=e;return i?(0,o.jsx)(E,{...e,isSizeLegendVisible:s}):(0,o.jsx)("div",{className:"s-geo-category-legend",children:r?R(e,t):P(e,t,n)})}function R(e,t){const{categoryItems:n,onItemClick:r,chartFill:i}=e,s={series:n??[],onItemClick:r,chartFill:i},{client:a}=t,l=a?.width?Math.floor(a.width):0;return(0,o.jsx)(S.a,{...s,containerWidth:l})}function P(e,t,n){const{categoryItems:r=[],position:i="top",height:s,format:a,locale:l,onItemClick:c,responsive:u,chartFill:d}=e,m={format:a,locale:l,position:i,responsive:u,series:r,shouldFillAvailableSpace:"left"!==i&&"right"!==i,onItemClick:c,chartFill:d},{client:g}=t,p=n&&(i===y.tV.LEFT||i===y.tV.RIGHT),f=g?.height?Math.floor(g.height):0,h=(s||f)-(p?O:0);return(0,o.jsx)(z.M,{...m,containerHeight:h})}function E(e){const{containerId:t,categoryItems:n=[],onItemClick:r=(e=>{}),name:i,maxRows:s,customComponent:a,customComponentName:l,hasSizeLegend:c,isSizeLegendVisible:u,chartFill:d}=e;return(0,o.jsx)(D.a,{series:n,onLegendItemClick:r,maxRows:c&&u&&s?s-1:s,name:i,containerId:t,customComponent:a,customComponentName:l,chartFill:d})}var M=n(50038);function F(e){const{sizes:t=[],format:n,numericSymbols:r=[],measureName:i,isSmall:s,showMiddleCircle:a}=e,l=V(t);if(!l.length)return null;const c=Z(l),u=G(l);if(c===u)return null;const d=u-c,m=x("pushpin-size-legend s-pushpin-size-legend",{"is-small-container":s}),g=x("pushpin-size-legend-circle-list",{"is-small-circles":s});return(0,o.jsxs)("div",{className:m,children:[i?(0,o.jsxs)("div",{className:"metric-name",title:i,children:[i,":"]}):null,(0,o.jsxs)("div",{className:g,children:[(0,o.jsxs)("div",{className:"pushpin-size-legend-circle circle-min-value",children:[(0,o.jsx)("span",{className:"circle-min-icon"}),(0,o.jsx)("span",{className:"circle-value",children:(0,k.N5)(c,n,d,r)})]}),a?A(e):null,i?null:(0,o.jsx)("div",{className:"circle-separator"}),(0,o.jsxs)("div",{className:"pushpin-size-legend-circle circle-max-value",children:[(0,o.jsx)("span",{className:"circle-max-icon"}),(0,o.jsx)("span",{className:"circle-value",children:(0,k.N5)(u,n,d,r)})]})]})]})}function A(e){const{sizes:t=[],format:n,numericSymbols:r=[],measureName:i}=e,s=V(t),a=G(s)-Z(s);return(0,o.jsxs)(c.Fragment,{children:[!i&&(0,o.jsx)("div",{className:"circle-separator"}),(0,o.jsxs)("div",{className:"pushpin-size-legend-circle circle-average-value",children:[(0,o.jsx)("span",{className:"circle-average-icon"}),(0,o.jsx)("span",{className:"circle-value",children:(0,k.N5)((0,M.j3)(s),n,a,r)})]})]})}function V(e){return e.filter((e=>null!==e&&isFinite(e)&&!isNaN(e)))}function Z(e){return Math.min(...e)}function G(e){return Math.max(...e)}const W=210,H=(0,b.b)(I.Z);function _(e,t){const{position:n,isFluidLegend:o}=e,{hasSizeLegend:r}=t,i=o||"bottom"===n;return x("geo-legend","s-geo-legend","viz-legend",{"viz-fluid-legend-wrap":o,"viz-static-legend-wrap":!o,static:!o,"has-size-legend":r,[`position-${n}`]:!i,"position-bottom":i})}function $(e){const{categoryItems:t=[],geoData:n={},height:r,numericSymbols:i=[]}=e,s=e.position??"top",a=(0,p.T6)(t,n),{hasCategoryLegend:l,hasColorLegend:c,hasSizeLegend:u}=a;return l||c||u?l?function(e,t){const{contentRect:n,renderPopUp:r}=e,{hasSizeLegend:i}=t,s=x(_(e,t));return(0,o.jsx)(H,{client:!0,children:({measureRef:t,contentRect:a})=>(0,B.M3)(n?.client?.width,r)?(0,o.jsx)("div",{className:s,ref:t,children:q(e,a,i)}):(0,o.jsxs)("div",{className:s,ref:t,children:[K(e,a,i),X(e,i)]})})}(e,a):c&&u&&function(e,t){return void 0!==e&&("left"===t||"right"===t)&&e<W+O}(r,s)?(0,o.jsx)(U,{...e,numericSymbols:i,availableLegends:a}):function(e,t){const{hasColorLegend:n,hasSizeLegend:r}=t,i=_(e,t);return(0,o.jsxs)("div",{className:i,children:[J(e,n),X(e,r)]})}(e,a):null}function U(e){const[t,n]=(0,c.useState)(1),{availableLegends:r}=e,i=_(e,r);return(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:"geo-legend-paging",children:[J(e,1===t),X(e,2===t)]}),(0,o.jsx)(L.P,{page:t,pagesCount:2,showNextPage:()=>n(2),showPrevPage:()=>n(1)})]})}function J(e,t){if(!t)return null;const{geoData:n,position:r="top",responsive:i,isFluidLegend:s,colorLegendValue:a,numericSymbols:l=[],contentRect:c}=e,u=n.color.data,d=n.color.format,m=u.filter(isFinite),g=(0,T.fC)(m,a),p=c?.client?.width,f=(0,B.AW)(p,s,i),h=(0,B.yd)(n?.color?.name,p,i);return(0,o.jsx)(w.n6,{data:g,format:d,size:f,numericSymbols:l,position:r,title:h})}function K(e,t,n){const{containerId:r}=e;return r?(0,o.jsx)(j,{...e,contentRect:t,hasSizeLegend:n,containerId:r}):null}function X(e,t,n=!1,r=!1){if(!t)return null;const{geoData:i,numericSymbols:s=[],responsive:a,contentRect:l}=e;if(!i?.size)return null;const{size:{data:c,format:u,name:d}}=i,m=l?.client?.width,g=(0,B.C1)(m,r,a),p=(0,B.i1)(d,m,n),f=(0,B.iD)(m,r);return(0,o.jsx)(F,{format:u,measureName:p,numericSymbols:s,sizes:c,isSmall:g,showMiddleCircle:f})}function q(e,t,n){const{containerId:r}=e;return r?(0,o.jsx)(j,{...e,contentRect:t,hasSizeLegend:n,isSizeLegendVisible:!1,containerId:r,customComponent:X(e,n,!0,!0),customComponentName:e.geoData?.size?.name}):null}const Y=(0,c.lazy)((()=>Promise.all([n.e(1948),n.e(9338)]).then(n.bind(n,1339)))),Q=(0,b.b)(I.Z);function ee(e){return(0,o.jsx)(c.Suspense,{fallback:null,children:(0,o.jsx)(Y,{...e})})}function te(e){return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(a.IntlTranslationsProvider,{children:t=>(0,o.jsx)($,{...e,numericSymbols:t.numericSymbols})})})}const ne={mapboxToken:""};class oe extends c.PureComponent{static getDerivedStateFromProps(e,t){const{geoChartOptions:n}=e;if(!n)return null;const{categoryItems:o,colorStrategy:r}=n,i=r.getColorAssignment();return(0,M.aL)(t.colorAssignmentItem,i)?{enabledLegendItems:new Array(o.length).fill(!0),colorAssignmentItem:i}:null}throttledOnWindowResize;containerId=`geo-${(0,v.Z)()}`;constructor(e){super(e);const{documentObj:t=document}=this.props;this.state={enabledLegendItems:[],showFluidLegend:(0,k.nf)(t),colorAssignmentItem:[]},this.throttledOnWindowResize=(0,C.Z)(this.onWindowResize,100)}componentDidMount(){this.updateConfigurationPanel(this.props.geoChartOptions),window.addEventListener("resize",this.throttledOnWindowResize)}componentDidUpdate(){this.updateConfigurationPanel(this.props.geoChartOptions)}componentWillUnmount(){this.throttledOnWindowResize.cancel(),window.removeEventListener("resize",this.throttledOnWindowResize)}render(){const{height:e,config:t}=this.props;return void 0===e||(0,B.fO)(t?.legend?.responsive)?(0,o.jsx)(Q,{client:!0,children:({measureRef:e,contentRect:t})=>{const{client:n}=t;return this.renderVisualizationContent(e,n?.height??0,t)}}):this.renderVisualizationContent(void 0,e)}renderVisualizationContent(e,t,n){const{geoChartOptions:r}=this.props,i=this.syncWithLegendItemStates(r),s=this.getLegendDetails(this.getLegendPosition(),n),a=s?s.position:y.tV.TOP,l=this.getContainerClassName(a),c=a===y.tV.TOP||a===y.tV.LEFT&&(!this.state.showFluidLegend||!!this.props.config?.respectLegendPosition),u=this.renderLegend(t,a,i,n);return(0,o.jsxs)("div",{className:l,ref:e,children:[c?u:null,this.renderChart(i),c?null:u]})}syncWithLegendItemStates(e){(0,u.kG)(e,"illegal state - trying to sync legend with no geo options");const{categoryItems:t}=e,{enabledLegendItems:n}=this.state,o=t.map(((e,t)=>({...e,isVisible:n[t]})));return{...e,categoryItems:o}}getContainerClassName(e){const t=!0===(0,B.o2)(this.props?.config?.legend?.responsive),n=this.getFlexDirection(e);return x("viz-line-family-chart-wrap","gd-geo-component","s-gd-geo-component",{"responsive-legend":t,"non-responsive-legend":!t,[`flex-direction-${n}`]:!0,"legend-position-bottom":e===y.tV.BOTTOM},this.containerId)}getFlexDirection(e){const t=this.isFluidLegend();return e===y.tV.TOP||e===y.tV.BOTTOM||t?"column":"row"}isFluidLegend(){const{showFluidLegend:e}=this.state,t=(0,B.o2)(this.props?.config?.legend?.responsive);return!(0,B.fO)(t)&&(0,M.eC)(t,e)}onLegendItemClick=e=>{const t=this.state.enabledLegendItems.map(((t,n)=>n===e.legendIndex?!t:t));this.setState({enabledLegendItems:t})};getLegendPosition(){const e=this.props.config?.legend?.position??y.tV.TOP;return y.nB.indexOf(e)>-1?e:y.tV.TOP}getLegendDetails(e,t){const{geoChartOptions:n,config:o}=this.props,r=this.syncWithLegendItemStates(n),{geoData:i}=r,s=i?.segment?.name,a={showFluidLegend:this.isFluidLegend(),contentRect:t,legendLabel:s};return(0,N.$)(e,(0,B.o2)(o?.legend?.responsive),a,o?.respectLegendPosition)}getLegendProps(e,t,n,o){const r=this.props.config?.legend?.responsive,{locale:i}=this.props,{enabledLegendItems:s}=this.state,a=this.isFluidLegend(),{geoData:l,colorStrategy:c,categoryItems:u}=n,{segment:d}=l,m=l.color?.format,g=l.size?.format,p={format:m||g,geoData:l},f=c.getColorByIndex(0),h=this.getLegendDetails(t,o);let x={height:e,locale:i,position:t,responsive:r,isFluidLegend:a,onItemClick:this.onLegendItemClick,contentRect:o,containerId:this.containerId};return h&&(x={...x,maxRows:h.maxRows,name:h.name,renderPopUp:h.renderPopUp}),d&&s.length?{...x,...p,categoryItems:u,colorLegendValue:f}:{...x,...p,colorLegendValue:f}}getChartProps(e){const{config:t=ne,dataView:n,drillableItems:o=[],afterRender:r=(()=>{}),onCenterPositionChanged:i=(()=>{}),onDrill:s=(()=>{}),onZoomChanged:l=(()=>{}),intl:c,onError:d}=this.props;(0,u.kG)(n,"invalid state - trying to render geo chart but there is no data to visualize");const{geoData:m,colorStrategy:g,categoryItems:p}=e,f=e.geoData.segment?.index,h={colorStrategy:g,config:t,dataView:n,drillableItems:(0,a.convertDrillableItemsToPredicates)(o),drillConfig:{dataView:n,onDrill:s},afterRender:r,geoData:m,onCenterPositionChanged:i,onZoomChanged:l,intl:c,...d?{onError:d}:{}};if(void 0!==f){const e=p.filter((e=>e.isVisible)).map((e=>e.uri));return{...h,config:{...t,selectedSegmentItems:e}}}return h}renderChart=e=>{const{chartRenderer:t=ee}=this.props;return t(this.getChartProps(e))};renderLegend=(e,t,n,o)=>{const r=this.props.config?.legend?.enabled??!0,{legendRenderer:i=te}=this.props;return r?i(this.getLegendProps(e,t,n,o)):null};onWindowResize=()=>{const{documentObj:e=document}=this.props;this.setState({showFluidLegend:(0,k.nf)(e)})};updateConfigurationPanel(e){(0,u.kG)(e,"illegal state - updating config with no geo options");const{pushData:t}=this.props,{categoryItems:n,geoData:o,colorStrategy:r,colorPalette:i}=e,{hasCategoryLegend:s,hasColorLegend:a,hasSizeLegend:l}=(0,p.T6)(n,o),c=s||a||l;t?.({propertiesMeta:{legend_enabled:c},colors:{colorAssignments:r.getColorAssignment(),colorPalette:i}})}}var re=n(50576);const ie=(0,c.createContext)({mapboxToken:void 0});function se({token:e,children:t}){return(0,o.jsx)(ie.Provider,{value:{mapboxToken:e},children:t})}function ae(e){return function(t){const{mapboxToken:n}=(0,c.useContext)(ie);return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(e,{...t,config:le(t.config,n)})})}}function le(e,t){return t?{...e||{},mapboxToken:e?.mapboxToken||t}:e}function ce(e){const t=(0,c.useContext)(ie),n=e??t.mapboxToken;return(0,u.kG)(n,"Mapbox token was not provided. Use <MapboxTokenProvider /> to provide token."),n}function ue(e){const t=(0,c.useContext)(ie);return e??t.mapboxToken}const de=(0,l.Zz)(ae(function(e){const t=(0,c.memo)((function(t){const[n,r]=(0,c.useState)(!1),i=(0,c.useRef)((0,a.newErrorMapping)(t.intl)),s=(0,c.useRef)(t.config?.mapboxToken),l=t.config?.mapboxToken??"",{execution:u}=t,d=!(0,M.B8)(u.definition.buckets),m=!l,g=(0,c.useCallback)((()=>{const{onError:e}=t;d&&e?.(new a.GeoLocationMissingSdkError),(n||m)&&e?.(new a.GeoTokenMissingSdkError)}),[d,n,m,t]),p=(0,c.useCallback)((()=>{r(!0)}),[]),f=(0,c.useCallback)((e=>{(0,a.isGeoTokenMissing)(e)?p():t.onError?.(e)}),[p,t]),h=(0,c.useCallback)((e=>{const n=t.ErrorComponent??a.ErrorComponent,r=i.current[e]||i.current[a.ErrorCodes.UNKNOWN_ERROR];return(0,o.jsx)(n,{code:e,...r})}),[t.ErrorComponent]);return(0,c.useEffect)((()=>{s.current!==t.config?.mapboxToken&&(r(!1),s.current=t.config?.mapboxToken),g()}),[g,t.config?.mapboxToken]),n||m?h(a.ErrorCodes.GEO_MAPBOX_TOKEN_MISSING):d?h(a.ErrorCodes.GEO_LOCATION_MISSING):(0,o.jsx)(e,{...t,onError:f})}),((e,t)=>{const{config:n,execution:o,drillableItems:r}=e,{config:i,execution:s,drillableItems:a}=t,l=((e,t)=>{const n=(e?.colorMapping||[]).map((e=>e.color)),o=(t?.colorMapping||[]).map((e=>e.color)),r={...e,colorMapping:n},i={...t,colorMapping:o};return(0,re.Z)(r,i)})(n,i),c=((e,t)=>e&&t?e.equals(t):e===t)(o,s),u=(0,re.Z)(r,a);return l&&c&&u}));return function(e){return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(t,{...e})})}}((0,a.withEntireDataView)((function(e){const t=(0,c.useMemo)((()=>e.intl.formatMessage({id:"visualization.emptyValue"})),[e.intl]),n=(0,c.useMemo)((()=>e.intl.formatMessage({id:"visualization.emptyValue"})),[e.intl]),r=(0,c.useMemo)((()=>(0,a.newErrorMapping)(e.intl)),[e.intl]),l=(0,c.useCallback)(((e,t)=>{if(!t.dataView)return;const{dataView:n}=t,o=t.config?.limit??h.gc,r=a.DataViewFacade.for(n);return{isDataTooLarge:!(0,M.Ur)(r,e,o)}}),[]),m=(0,c.useCallback)((e=>function(e,t,n){return e.getColorAssignment().map(((o,r)=>{const{name:i,uri:l}=(0,s.isResultAttributeHeader)(o.headerItem)?o.headerItem.attributeHeaderItem:{name:t,uri:t},c=e.getColorByIndex(r);return{type:a.VisualizationTypes.PUSHPIN,uri:l??n,name:i??n,color:c,legendIndex:r,isVisible:!0}}))}(e,t,n)),[t,n]),g=(0,c.useCallback)(((e,t)=>{const{segment:n}=e,{config:{colors:o=[],colorPalette:r=[],colorMapping:s=[]}={},dataView:l}=t,c=a.DataViewFacade.for(l),u=(0,d.CW)(o,r),g=function(e,t,n,o){const{locationAttribute:r,segmentByAttribute:s}=(0,p.Dc)(o,n),a={attributeHeader:(0,i.Z)(r,"items")};return new f(e,t,a,s,o)}(u,s,e,c);return{geoData:e,categoryItems:n?m(g):[],colorStrategy:g,colorPalette:u}}),[m]),x=(0,c.useCallback)((()=>{const{dataView:r,onDataTooLarge:i}=e,s=a.DataViewFacade.for(r),c=(0,p.uR)(s,t,n),d=l(c,e);if(d?.isDataTooLarge){(0,u.kG)(i,"GeoChart's onDataTooLarge callback is missing.");const{location:t}=c,n=(0,M.xm)(s,c),o=void 0===t?[]:n[t.index];return i(void 0,`LocationData limit: ${e.config?.limit??h.gc} actual: ${o.length}`),null}const m=g(c,e);return(0,o.jsx)(oe,{...e,geoChartOptions:m})}),[g,t,n,e,l]),{dataView:b,error:C,isLoading:I}=e,v=null===e.ErrorComponent?null:e.ErrorComponent??a.ErrorComponent,k=null===e.LoadingComponent?null:e.LoadingComponent??a.LoadingComponent;if(C){const e=r[Object.prototype.hasOwnProperty.call(r,C)?C:a.ErrorCodes.UNKNOWN_ERROR];return v?(0,o.jsx)(v,{code:C,...e}):null}return I||!b?k?(0,o.jsx)(k,{}):null:x()})))));function me(e){return(0,o.jsx)(l.ze,{theme:e.theme||{},themeIsLoading:!1,children:(0,o.jsx)(de,{...e})})}function ge(e){return void 0!==e.location}function pe(e){const t=e.buckets,n=(0,s.bucketsMeasures)(t),o=(0,s.bucketsAttributes)(t);return(0,r.Z)([n.length>0&&(0,s.newDimension)([s.MeasureGroupIdentifier]),(0,s.newDimension)(o)])}const fe=(0,l.Zz)((0,a.withContexts)((function(e){const{backend:t,workspace:n,sortBy:r,filters:l,exportTitle:c,execConfig:u={}}=e,d=(e=>{const{color:t,segmentBy:n,size:o,config:r}=e,i=[(0,s.newBucket)(a.BucketNames.SIZE,...o?[(0,s.disableComputeRatio)(o)]:[]),(0,s.newBucket)(a.BucketNames.COLOR,...t?[(0,s.disableComputeRatio)(t)]:[])];if(ge(e)){const{location:t}=e;i.push((0,s.newBucket)(a.BucketNames.LOCATION,...t?[t]:[]))}else{const{latitude:t,longitude:n}=e;i.push((0,s.newBucket)(a.BucketNames.LATITUDE,...t?[t]:[])),i.push((0,s.newBucket)(a.BucketNames.LONGITUDE,...n?[n]:[]))}i.push((0,s.newBucket)(a.BucketNames.SEGMENT,...n?[n]:[]));const l=r?.[a.BucketNames.TOOLTIP_TEXT];return l&&i.push((0,s.newBucket)(a.BucketNames.TOOLTIP_TEXT,l)),i})(e),m=(0,i.Z)(e,(e=>{const t=["backend","workspace","segmentBy","filters","sortBy","color","size"];return ge(e)?[...t,"location"]:[...t,"longitude","latitude"]})(e)),g=t.withTelemetry("GeoPushpinChart",e).workspace(n).execution().forBuckets(d,l).withSorting(...r||[]).withDimensions(pe).withExecConfig(u);return(0,o.jsx)(a.IntlWrapper,{locale:e.locale,children:(0,o.jsx)(a.IntlTranslationsProvider,{children:t=>(0,o.jsx)(me,{intl:t.intl,execution:g,exportTitle:c||"GeoPushpinChart",enableExecutionCancelling:e.config?.enableExecutionCancelling??!1,...m})})})})));function he(e){const[t,n,r,i,s,l]=(0,a.useResolveValuesWithPlaceholders)([e.location,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return(0,o.jsx)(fe,{...e,location:t,size:n,color:r,segmentBy:i,filters:s,sortBy:l})}function xe(e){const[t,n,r,i,s,l,c]=(0,a.useResolveValuesWithPlaceholders)([e.longitude,e.latitude,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return(0,o.jsx)(fe,{...e,longitude:t,latitude:n,size:r,color:i,segmentBy:s,filters:l,sortBy:c})}function be(e){return ge(e)?(0,o.jsx)(he,{...e}):(0,o.jsx)(xe,{...e})}},79120:(e,t,n)=>{n.d(t,{e:()=>i});var o=n(55348),r=n(65165);function i({patternFill:e}){const t=(0,r.useIdPrefixed)("palette-item-pattern"),{path:n,opacity:i,width:s,height:a}=e,l="number"==typeof n.strokeWidth&&n.strokeWidth>0;return(0,o.jsxs)("svg",{"aria-hidden":"true",focusable:"false",width:"100%",height:"100%",preserveAspectRatio:"none",style:{display:"block",position:"absolute",inset:0},children:[(0,o.jsx)("defs",{children:(0,o.jsx)("pattern",{id:t,patternUnits:"userSpaceOnUse",width:s,height:a,children:(0,o.jsx)("path",{d:n.d,stroke:l?"currentColor":"none",fill:l?"none":"currentColor",opacity:i,strokeWidth:n.strokeWidth})})}),(0,o.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${t})`})]})}},16576:(e,t,n)=>{n.d(t,{CW:()=>T,D4:()=>m,EK:()=>h,Hf:()=>l,Mn:()=>g,NK:()=>w,Yt:()=>b,c0:()=>p,gG:()=>C,i5:()=>B,ju:()=>I,m:()=>x,mi:()=>L,ob:()=>d,wo:()=>S,yx:()=>v,z:()=>k});var o=n(50576),r=n(79697),i=n(53244),s=n(2525);function a(e){const t=e.match(/^rgba?\(([^)]+)\)$/i);if(!t)return null;const[n,o,r]=t[1].split(",").slice(0,3).map((e=>parseInt(e.trim(),10)));return Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(r)?{r:n,g:o,b:r}:null}function l(e){if(!e)return null;const t=e.trim();return a(t)??function(e){if(!e.startsWith("#"))return null;const t=f(e),n=/^#([0-9a-f]{6})$/i.exec(t);if(!n)return null;const o=parseInt(n[1],16);return{r:o>>16&255,g:o>>8&255,b:255&o}}(t)??function(e){if("undefined"==typeof window||"undefined"==typeof document)return null;const t=document.createElement("div");t.style.display="none",t.style.color=e,document.body.appendChild(t);const n=getComputedStyle(t).color;return document.body.removeChild(t),a(n)}(t)}function c(e,t){const n=t<0?0:255,o=Math.abs(t);return Math.round((n-e)*o)+e}function u(e,t,n){return`rgb(${e},${t},${n})`}function d(e){const t=e.split(",");return{R:parseInt(t[0].slice(4),10),G:parseInt(t[1],10),B:parseInt(t[2],10)}}function m(e,t){const{R:n,G:o,B:r}=d(e);return u(c(n,t),c(o,t),c(r,t))}function g(e,t){const{R:n,G:o,B:r}=d(e),i=Math.abs(t),s=1-i,a=e=>{if(0===s)return e;const t=Math.round((e-255*i)/s);return Math.max(0,Math.min(255,t))};return u(a(n),a(o),a(r))}function p(e,t){const{r:n,g:o,b:r}=e;return{r:c(n,t),g:c(o,t),b:c(r,t)}}function f(e){if(4===e.length){const[t,n,o]=e.split("").slice(1);return"#"+t+t+n+n+o+o}return e}function h(e){return"string"!=typeof e?e:"rgb"===e.slice(0,3)?e.replace(/\s/g,""):f(e).replace(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i,((e,t,n,o)=>`rgb(${[t,n,o].map((e=>parseInt(e,16).toString(10))).join(",")})`))}function x(e){try{return e.map(((e,t)=>{const{R:n,G:o,B:r}=d(h(e));if(isNaN(n)||isNaN(o)||isNaN(r))throw Error;return{guid:String(t),fill:{r:n,g:o,b:r}}}))}catch{return s.DefaultColorPalette}}function b(e){return!(0,o.Z)(e,s.DefaultColorPalette)}function C(e,t,n){if(!t)return;const o=t.find((t=>t.predicate(e,{dv:n})));return o?.color}function I(e,t,n){const o=e.find((e=>e.guid===t));return o?o.fill:e[n%e.length].fill}function v(e){return`rgb(${e.r},${e.g},${e.b})`}function k(e){const t=h(e),n=/rgb\((.*)\)/.exec(t);if(null===n)return null;const o=n[1],[r,i,s]=o.split(",").map((e=>parseInt(e)));return{r,g:i,b:s}}function y(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function N(e){return.2126*y(e.r)+.7152*y(e.g)+.0722*y(e.b)}function L(e,t){const n=l(e),o=l(t);if(!n||!o)return NaN;const r=N(n),i=N(o);return(Math.max(r,i)+.05)/(Math.min(r,i)+.05)}function w(e){return t=>{if((0,i.isResultAttributeHeader)(t))return!(!e&&null!==e&&""!==e)&&e===t.attributeHeaderItem.uri;if((0,i.isAttributeDescriptor)(t))return!!e&&(e===t.attributeHeader.uri||e===t.attributeHeader.identifier);if((0,i.isColorDescriptor)(t))return!!e&&e===t.colorHeaderItem.id;const n=(0,s.getMappingHeaderLocalIdentifier)(t);return!!n&&n===e}}function T(e,t){return t&&!(0,r.Z)(t)?t:e&&!(0,r.Z)(e)?x(e):s.DefaultColorPalette}const B={getColorByGuid:I,getColorMappingPredicate:w};function S(e){return!(0,r.Z)(e)&&void 0!==e.pattern}},3956:(e,t,n)=>{n.d(t,{Z:()=>o});const o=function(e){return function(t){return null==e?void 0:e[t]}}},96446:(e,t,n)=>{n.d(t,{Z:()=>a});var o=Math.ceil,r=Math.max;var i=n(50439),s=n(29640);const a=function(e,t,n){return n&&"number"!=typeof n&&(0,i.Z)(e,t,n)&&(t=n=void 0),e=(0,s.Z)(e),void 0===t?(t=e,e=0):t=(0,s.Z)(t),function(e,t,n,i){for(var s=-1,a=r(o((t-e)/(n||1)),0),l=Array(a);a--;)l[i?a:++s]=e,e+=n;return l}(e,t,n=void 0===n?e<t?1:-1:(0,s.Z)(n),void 0)}}}]);