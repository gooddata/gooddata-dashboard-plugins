(self.webpackChunkpolar_area_chart_plugin=self.webpackChunkpolar_area_chart_plugin||[]).push([[9994],{18674:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},40098:e=>{var t=Math.ceil,n=Math.max;e.exports=function(e,r,o,i){for(var a=-1,s=n(t((r-e)/(o||1)),0),l=Array(s);s--;)l[i?s:++a]=e,e+=o;return l}},47445:(e,t,n)=>{var r=n(40098),o=n(16612),i=n(18601);e.exports=function(e){return function(t,n,a){return a&&"number"!=typeof a&&o(t,n,a)&&(n=a=void 0),t=i(t),void 0===n?(n=t,t=0):n=i(n),a=void 0===a?t<n?1:-1:i(a),r(t,n,a,e)}}},91175:e=>{e.exports=function(e){return e&&e.length?e[0]:void 0}},97398:(e,t,n)=>{var r=n(55639).isFinite;e.exports=function(e){return"number"==typeof e&&r(e)}},96026:(e,t,n)=>{var r=n(47445)();e.exports=r},4270:(e,t,n)=>{n.d(t,{$t:()=>m,Cu:()=>u,Gq:()=>M,I7:()=>s,J5:()=>b,KZ:()=>T,Mc:()=>A,N6:()=>p,Pm:()=>a,RW:()=>S,Ul:()=>i,VL:()=>B,X9:()=>g,eH:()=>l,gN:()=>d,gc:()=>h,hm:()=>O,jc:()=>z,lS:()=>f,m6:()=>E,me:()=>N,nJ:()=>c,ri:()=>R,ry:()=>x,sV:()=>w,ti:()=>C,vB:()=>P,vR:()=>D,wu:()=>v,yJ:()=>k,yv:()=>L,z2:()=>y});var r=n(2525),o=n(53244);const i={northEast:{lat:-84,lng:-180},southWest:{lat:84,lng:180}},a={continent_af:[{lat:-36,lng:-20},{lat:38,lng:54}],continent_as:[{lat:-8,lng:26},{lat:64,lng:146}],continent_au:[{lat:-50,lng:107},{lat:0,lng:180}],continent_eu:[{lat:36,lng:-24},{lat:72,lng:43}],continent_na:[{lat:11,lng:-170},{lat:72,lng:-52}],continent_sa:[{lat:-56,lng:-90},{lat:14,lng:-31}],world:[i.northEast,i.southWest]},s=["has","point_count"],l={id:"gdcClusterLabels",type:"symbol",layout:{"text-allow-overlap":!0,"text-field":"{point_count_abbreviated}","text-font":["Lato Bold"],"text-size":14},paint:{"text-color":"#fff"}},c="gdcClusters",u=14,d={"circle-stroke-color":["step",["get","point_count"],"#00D398",10,"#F38700",100,"#E84C3C"],"circle-stroke-opacity":.2,"circle-stroke-width":8},m=["step",["get","point_count"],"#00D398",10,"#F38700",100,"#E84C3C"],g=["step",["get","point_count"],15,100,25],p={min:{default:8,"0.5x":4,"0.75x":6,normal:8,"1.25x":10,"1.5x":12},max:{default:60,"0.5x":30,"0.75x":45,normal:60,"1.25x":75,"1.5x":90}},f=50,h=25e3,b="gdcPushpinsData",C="gdcPushpins",v=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],I=(0,o.colorPaletteToColors)(r.DefaultColorPalette),E=2,x={lat:34,lng:5},y="rgb(233,237,241)",L=.7,k=6,N=I[0],T={"circle-stroke-width":1},w={attributionControl:!1,dragRotate:!1,fitBoundsOptions:{padding:45,maxDuration:1},maxBounds:a.world,maxZoom:14,pitchWithRotate:!1,renderWorldCopies:!1,touchZoomRotate:!1,style:"mapbox://styles/gooddata/ck88ltry127yx1iql358df6xn"},S={closeButton:!1,closeOnClick:!1,offset:10},M="circle",B="circle-color",O="circle-radius",D="circle-stroke-color",z="empty-segment-filter",R="-label",P="-",A=100},3746:(e,t,n)=>{n.d(t,{fC:()=>b,yQ:()=>h});var r=n(96026),o=n(41609),i=n(97398),a=n(4270),s=n(47037);function l(e,t,n,r=1){return 1===r?`rgb(${e},${t},${n})`:`rgba(${e},${t},${n},${r})`}function c(e){const t=e.split(",");return{R:parseInt(t[0].slice(4),10),G:parseInt(t[1],10),B:parseInt(t[2],10)}}function u(e,t,n){return Math.trunc(e+t*n)}function d(e,t=1){const{r:n,g:o,b:i}=function(e){if(s(e)){const{R:t,G:n,B:r}=c(e);return{r:t,g:n,b:r}}return e}(e),a=[n,o,i],d=a.map((e=>(255-e)/6)),m=function(e,t,n,o=1){return r(1,6).map((e=>l(u(t[0],e,n[0]),u(t[1],e,n[1]),u(t[2],e,n[2]),o)))}(0,a,d,t);return[...m.reverse(),l(n,o,i,t)]}var m=n(53244),g=n(50038);const p="default_segment_item",f=a.yJ-1;function h(e,t=[],n){const r=function(e,t=1){const{R:n,G:r,B:o}=c(e);return l(n,r,o,t)}(n.getColorByIndex(0),a.yv);if(!e.length&&!t.length)return[{border:a.z2,background:r}];const o=[...t],s=function(e){return e.getColorAssignment().reduce(((t,n,r)=>{const o=d(e.getColorByIndex(r),a.yv);return(0,m.isAttributeDescriptor)(n.headerItem)?{[p]:o}:(t[((0,m.isResultAttributeHeader)(n.headerItem)?n.headerItem.attributeHeaderItem.name:p)??p]=o,t)}),{})}(n);if(!e.length)return o.map((e=>{const t=s[e];return{border:a.z2,background:t[f]}}));const u=e.filter((e=>null!==e&&i(e))),{min:h,max:b}=(0,g.X9)(u);return h!==b||t.length?e.map(((e,t)=>{const n=function(e,t,n){if(null===e||!i(e)||t===n||e===t)return 0;if(e===n)return f;const r=(n-t)/a.yJ;for(let n=0,o=t;n<a.yJ;n++,o+=r)if(o>=e)return n;return f}(null!==e&&i(e)?e:h,h,b),r=o[t]||p,l=s[r];return{border:l[f],background:l[n]}})):[{border:a.z2,background:r}]}function b(e,t){if(o(e))return[];const n=d(t,a.yv),i=Math.min(...e),s=Math.max(...e),l=(s-i)/a.yJ;return i===s?[]:r(0,a.yJ).map((e=>{const t=i+l*e;return{range:{from:t,to:e===a.yJ-1?s:t+l},color:n[e]}}))}},50038:(e,t,n)=>{n.d(t,{B8:()=>u,Ur:()=>l,V5:()=>m,Wl:()=>h,X9:()=>f,aL:()=>C,cT:()=>p,eC:()=>b,iP:()=>g,j3:()=>d,xm:()=>s});var r=n(2525),o=n(53244),i=n(18446),a=n(91964);function s(e,t){const{color:n,size:r}=t,o=void 0!==n||void 0!==r?1:0;return e.meta().allHeaders()[o]}function l(e,t,n){const{location:r}=t,o=s(e,t);return(void 0!==r?o[r.index]:[]).length<=n}const c=e=>void 0!==e&&!(0,o.bucketIsEmpty)(e);function u(e){const t=(0,o.bucketsFind)(e,r.BucketNames.LOCATION),n=(0,o.bucketsFind)(e,r.BucketNames.LATITUDE),i=(0,o.bucketsFind)(e,r.BucketNames.LONGITUDE);return c(t)||c(n)&&c(i)}function d(e=[]){return e.length?e.reduce(((e,t)=>e+t),0)/e.length:0}function m(e,t){return e.meta().measureDescriptors()[t].measureHeaderItem.format}function g(e,t=!0){const{color:n,location:r,segment:o,size:i}=e;return Boolean(t&&r&&!(n||o||i))}function p(e,t){return!i(e,t)}function f(e){return e.reduce(((e,t)=>isFinite(t)?{min:e.min&&isFinite(e.min)?Math.min(t,e.min):t,max:e.max&&isFinite(e.max)?Math.max(t,e.max):t}:e),{min:void 0,max:void 0})}function h(e){if(null===e)return NaN;const t="string"==typeof e?parseFloat(e):e;return isNaN(t)&&console.warn(`SDK: utils - stringToFloat: ${e} is not a number`),t}function b(e,t){return!0===(0,a.o2)(e)&&t}function C(e,t){return!i(e,t)}},34910:(e,t,n)=>{n.d(t,{Bz:()=>f,Dc:()=>h,T6:()=>g,uR:()=>c});var r=n(2525),o=n(50038),i=n(53244),a=n(30998);function s(e){if(!e)return null;const[t,n]=e.split(";").map(o.Wl);return isNaN(t)||isNaN(n)?(console.warn("UI-SDK: geoChartDataSource - getLocation: invalid location",e),null):{lat:t,lng:n}}function l(e){if(!e)return null;const t=(0,o.Wl)(e);return isNaN(t)?(console.warn("UI-SDK: geoChartDataSource - getLocation: invalid latitude/longitude coordinate",t),null):t}function c(e,t,n){const c=function(e){const t=e.def().buckets(),n=e.meta().measureDescriptors(),o=e.meta().attributeDescriptors(),s=t.reduce(((e,t)=>(e[t.localIdentifier]=function(e){if(!e)return null;if((0,i.isAttribute)(e))return{localIdentifier:(0,i.attributeLocalId)(e),...m((0,i.attributeDisplayFormRef)(e))};const t=(0,i.measureLocalId)(e),n=(0,i.measureItem)(e);return n?{localIdentifier:t,...m(n)}:{localIdentifier:t}}(t.items[0]),e)),{}),l={};return[r.BucketNames.LOCATION,r.BucketNames.LATITUDE,r.BucketNames.LONGITUDE,r.BucketNames.SEGMENT,r.BucketNames.TOOLTIP_TEXT].forEach((e=>{const t=s[e];if(!t)return;const n=a(o,(e=>e.attributeHeader.localIdentifier===t.localIdentifier&&(e.attributeHeader.uri===t.uri||e.attributeHeader.identifier===t.identifier)));if(-1!==n){const{formOf:{name:t}}=o[n].attributeHeader;l[e]={index:n,name:t}}})),[r.BucketNames.SIZE,r.BucketNames.COLOR].forEach((e=>{const t=s[e];if(!t)return;const r=a(n,(e=>e.measureHeaderItem.localIdentifier===t.localIdentifier&&(e.measureHeaderItem.uri===t.uri||e.measureHeaderItem.identifier===t.identifier)));-1!==r&&(l[e]={index:r,name:n[r].measureHeaderItem.name})})),l}(e),g=(0,o.xm)(e,c),p=c.location?.index,f=c.latitude?.index,h=c.longitude?.index,b=c?.segment?.index,C=c?.tooltipText?.index,v=c?.size?.index,I=c?.color?.index;if(void 0!==p){const e=d(g,p,t,n);c[r.BucketNames.LOCATION].data=e.map(s)}if(void 0!==f&&null!=h){const e=d(g,f,t,n),o=d(g,h,t,n);c[r.BucketNames.LOCATION]={...c[r.BucketNames.LATITUDE],data:e.map(((e,t)=>({lat:l(e),lng:l(o[t])})))}}if(void 0!==b){const{data:e,uris:t}=function(e,t,n){return e[t].reduce(((e,t)=>{if(t&&(0,i.isResultAttributeHeader)(t)){const{uri:r,name:o}=t.attributeHeaderItem;return{uris:[...e.uris,r],data:[...e.data,o??n]}}return e}),{uris:[],data:[]})}(g,b,n);c[r.BucketNames.SEGMENT].data=e,c[r.BucketNames.SEGMENT].uris=t}return void 0!==C&&(c[r.BucketNames.TOOLTIP_TEXT].data=d(g,C,t,n)),void 0!==v&&(c[r.BucketNames.SIZE].data=u(e,v),c[r.BucketNames.SIZE].format=(0,o.V5)(e,v)),void 0!==I&&(c[r.BucketNames.COLOR].data=u(e,I),c[r.BucketNames.COLOR].format=(0,o.V5)(e,I)),c}function u(e,t){return e.rawData().twoDimData()[t].map(o.Wl)}function d(e,t,n,r){return e[t].map((e=>{const t=(0,i.resultHeaderName)(e);return t||(""===t?n:r)}))}function m(e){return(0,i.isIdentifierRef)(e)?{identifier:e.identifier}:{uri:e.uri}}function g(e,t){const{color:{data:n=[]}={},size:{data:r=[]}={}}=t,{min:i,max:a}=(0,o.X9)(n),{min:s,max:l}=(0,o.X9)(r),c=Boolean(e?.length);return{hasCategoryLegend:c,hasColorLegend:Boolean(n.length)&&i!==a&&!c,hasSizeLegend:Boolean(r.length)&&s!==l}}function p(e){try{return JSON.parse(e)}catch(e){return{}}}function f(e){const{locationName:t="{}",color:n="{}",size:r="{}",segment:o="{}"}=e||{};return{locationName:p(t),size:p(r),color:p(n),segment:p(o)}}function h(e,t){const{color:n,location:r,segment:o,size:i,tooltipText:a}=t,s=r?.index??0,l=e.meta().allHeaders(),c=i||n?1:0,u=e.meta().attributeDescriptors(),d=l[c];return{locationAttribute:{...u[s].attributeHeader,items:d[s]},segmentByAttribute:o?.data.length?{...u[o.index].attributeHeader,items:d[o.index]}:void 0,tooltipTextAttribute:a?.data.length?{...u[a.index].attributeHeader,items:d[a.index]}:void 0}}},91964:(e,t,n)=>{n.d(t,{AW:()=>d,C1:()=>g,M3:()=>f,fO:()=>u,i1:()=>p,iD:()=>h,o2:()=>c,yd:()=>m});const r=260,o=330,i=410,a=410;function s(e){return!e||e>=r}function l(e){return!e||e>=o}function c(e){return u(e)?e:Boolean(e)}function u(e){return"autoPositionWithPopup"===e}function d(e,t,n){const r=u(n)&&!function(e){return!e||e>=a}(e);let o="large";return r&&(o="small"),t&&(o="medium"),o}function m(e,t,n){return u(n)&&e&&s(t)?e:void 0}function g(e,t,n){return!t&&u(n)&&!l(e)}function p(e,t,n){return!n&&s(t)?e:void 0}function f(e,t){return!l(e)&&Boolean(t)}function h(e,t){return t||l(e)&&(!e||e>=i)}},27214:(e,t,n)=>{n.r(t),n.d(t,{CoreGeoChart:()=>he,GeoPushpinChart:()=>xe,MapboxTokenProvider:()=>ue,enrichMapboxToken:()=>me,getColorMappingPredicate:()=>oe.NK,getGeoChartDimensions:()=>Ce,useMapboxToken:()=>pe,useMapboxTokenStrict:()=>ge,withMapboxToken:()=>de});var r=n(59882),o=n(39693),i=n(57557),a=n(2525),s=n(25972),l=n(18446),c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},c.apply(this,arguments)};function u(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var d=n(8679),m=n.n(d),g=n(93237),p=n(95957);(0,p.H)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.NumberFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:p.A.variadic}),(0,p.H)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.DateTimeFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:p.A.variadic}),(0,p.H)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.PluralRules).bind.apply(e,u([void 0],t,!1)))}),{strategy:p.A.variadic}),(0,p.H)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.Locale).bind.apply(e,u([void 0],t,!1)))}),{strategy:p.A.variadic}),(0,p.H)((function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new((e=Intl.ListFormat).bind.apply(e,u([void 0],t,!1)))}),{strategy:p.A.variadic}),c(c({},{formats:{},messages:{},timeZone:void 0,defaultLocale:"en",defaultFormats:{},fallbackOnEmptyString:!0,onError:function(e){},onWarn:function(e){}}),{textComponent:g.Fragment});var f="undefined"==typeof window||window.__REACT_INTL_BYPASS_GLOBAL_CONTEXT__?g.createContext(null):window.__REACT_INTL_CONTEXT__||(window.__REACT_INTL_CONTEXT__=g.createContext(null)),h=f.Consumer;f.Provider;var b=n(50038),C=n(47591),v=n(34910),I=n(94184),E=n(23493),x=n(50308),y=n(88699),L=n(44586),k=n(25356),N=n(3746),T=n(75131),w=n(17096),S=n(72666),M=n(19679);const B=161;function O(e){const{contentRect:t,hasSizeLegend:n,isFluidLegend:o,renderPopUp:i,isSizeLegendVisible:a=!0}=e;return i?r.createElement(D,{...e,isSizeLegendVisible:a}):r.createElement("div",{className:"s-geo-category-legend"},o?function(e,t){const{categoryItems:n,onItemClick:o}=e,i={series:n??[],onItemClick:o},{client:a}=t,s=a?.width?Math.floor(a.width):0;return r.createElement(T.a,{...i,containerWidth:s})}(e,t):function(e,t,n){const{categoryItems:o=[],position:i="top",height:a,format:s,locale:l,onItemClick:c,responsive:u}=e,d={format:s,locale:l,position:i,responsive:u,series:o,shouldFillAvailableSpace:"left"!==i&&"right"!==i,onItemClick:c},{client:m}=t,g=n&&(i===w.tV.LEFT||i===w.tV.RIGHT),p=m?.height?Math.floor(m.height):0,f=(a||p)-(g?B:0);return r.createElement(S.M,{...d,containerHeight:f})}(e,t,n))}function D(e){const{containerId:t,categoryItems:n=[],onItemClick:o=x,name:i,maxRows:a,customComponent:s,customComponentName:l,hasSizeLegend:c,isSizeLegendVisible:u}=e;return r.createElement(M.a,{series:n,onLegendItemClick:o,maxRows:c&&u&&a?a-1:a,name:i,containerId:t,customComponent:s,customComponentName:l})}var z=n(39430);function R(e){const{sizes:t=[],format:n,numericSymbols:o=[],measureName:i,isSmall:a,showMiddleCircle:s}=e,l=P(t);if(!l.length)return null;const c=A(l),u=_(l);if(c===u)return null;const d=u-c,m=I("pushpin-size-legend s-pushpin-size-legend",{"is-small-container":a}),g=I("pushpin-size-legend-circle-list",{"is-small-circles":a});return r.createElement("div",{className:m},i?r.createElement("div",{className:"metric-name",title:i},i,":"):null,r.createElement("div",{className:g},r.createElement("div",{className:"pushpin-size-legend-circle circle-min-value"},r.createElement("span",{className:"circle-min-icon"}),r.createElement("span",{className:"circle-value"},(0,z.N5)(c,n,d,o))),s?function(e){const{sizes:t=[],format:n,numericSymbols:o=[],measureName:i}=e,a=P(t),s=_(a)-A(a);return r.createElement(r.Fragment,null,!i&&r.createElement("div",{className:"circle-separator"}),r.createElement("div",{className:"pushpin-size-legend-circle circle-average-value"},r.createElement("span",{className:"circle-average-icon"}),r.createElement("span",{className:"circle-value"},(0,z.N5)((0,b.j3)(a),n,s,o))))}(e):null,i?null:r.createElement("div",{className:"circle-separator"}),r.createElement("div",{className:"pushpin-size-legend-circle circle-max-value"},r.createElement("span",{className:"circle-max-icon"}),r.createElement("span",{className:"circle-value"},(0,z.N5)(u,n,d,o)))))}function P(e){return e.filter((e=>null!==e&&isFinite(e)&&!isNaN(e)))}function A(e){return Math.min(...e)}function _(e){return Math.max(...e)}var F=n(85932),H=n(33805),V=n(91964);const G=210,W=(0,k.b)(y.Z);function U(e,t){const{position:n,isFluidLegend:r}=e,{hasSizeLegend:o}=t,i=r||"bottom"===n;return I("geo-legend","s-geo-legend","viz-legend",{"viz-fluid-legend-wrap":r,"viz-static-legend-wrap":!r,static:!r,"has-size-legend":o,[`position-${n}`]:!i,"position-bottom":i})}function $(e){const{categoryItems:t=[],geoData:n={},height:o,numericSymbols:i=[]}=e,a=e.position??"top",s=(0,v.T6)(t,n),{hasCategoryLegend:l,hasColorLegend:c,hasSizeLegend:u}=s;return l||c||u?l?function(e,t){const{contentRect:n,renderPopUp:o}=e,{hasSizeLegend:i}=t,a=I(U(e,t));return r.createElement(W,{client:!0},(({measureRef:t,contentRect:s})=>(0,V.M3)(n?.client?.width,o)?r.createElement("div",{className:a,ref:t},function(e,t,n){const{containerId:o}=e;return o?r.createElement(O,{...e,contentRect:t,hasSizeLegend:n,isSizeLegendVisible:!1,containerId:o,customComponent:X(e,n,!0,!0),customComponentName:e.geoData?.size?.name}):null}(e,s,i)):r.createElement("div",{className:a,ref:t},function(e,t,n){const{containerId:o}=e;return o?r.createElement(O,{...e,contentRect:t,hasSizeLegend:n,containerId:o}):null}(e,s,i),X(e,i))))}(e,s):c&&u&&function(e,t){return void 0!==e&&("left"===t||"right"===t)&&e<G+B}(o,a)?r.createElement(Z,{...e,numericSymbols:i,availableLegends:s}):function(e,t){const{hasColorLegend:n,hasSizeLegend:o}=t,i=U(e,t);return r.createElement("div",{className:i},j(e,n),X(e,o))}(e,s):null}function Z(e){const[t,n]=r.useState(1),{availableLegends:o}=e,i=U(e,o);return r.createElement("div",{className:i},r.createElement("div",{className:"geo-legend-paging"},j(e,1===t),X(e,2===t)),r.createElement(F.P,{page:t,pagesCount:2,showNextPage:()=>n(2),showPrevPage:()=>n(1)}))}function j(e,t){if(!t)return null;const{geoData:n,position:o="top",responsive:i,isFluidLegend:a,colorLegendValue:s,numericSymbols:l=[],contentRect:c}=e,u=n.color.data,d=n.color.format,m=u.filter(isFinite),g=(0,N.fC)(m,s),p=c?.client?.width,f=(0,V.AW)(p,a,i),h=(0,V.yd)(n?.color?.name,p,i);return r.createElement(H.n6,{data:g,format:d,size:f,numericSymbols:l,position:o,title:h})}function X(e,t,n=!1,o=!1){if(!t)return null;const{geoData:i,numericSymbols:a=[],responsive:s,contentRect:l}=e;if(!i?.size)return null;const{size:{data:c,format:u,name:d}}=i,m=l?.client?.width,g=(0,V.C1)(m,o,s),p=(0,V.i1)(d,m,n),f=(0,V.iD)(m,o);return r.createElement(R,{format:u,measureName:p,numericSymbols:a,sizes:c,isSmall:g,showMiddleCircle:f})}var J=n(90297);const K=(0,r.lazy)((()=>Promise.all([n.e(1037),n.e(1339)]).then(n.bind(n,1339)))),q=(0,k.b)(y.Z);function Y(e){return r.createElement(r.Suspense,{fallback:null},r.createElement(K,{...e}))}function Q(e){return r.createElement(a.IntlWrapper,{locale:e.locale},r.createElement(a.IntlTranslationsProvider,null,(t=>r.createElement($,{...e,numericSymbols:t.numericSymbols}))))}const ee={mapboxToken:""};class te extends r.PureComponent{static getDerivedStateFromProps(e,t){const{geoChartOptions:n}=e;if(!n)return null;const{categoryItems:r,colorStrategy:o}=n,i=o.getColorAssignment();return(0,b.aL)(t.colorAssignmentItem,i)?{enabledLegendItems:new Array(r.length).fill(!0),colorAssignmentItem:i}:null}throttledOnWindowResize;containerId=`geo-${(0,L.Z)()}`;constructor(e){super(e);const{documentObj:t=document}=this.props;this.state={enabledLegendItems:[],showFluidLegend:(0,z.nf)(t),colorAssignmentItem:[]},this.throttledOnWindowResize=E(this.onWindowResize,100)}componentDidMount(){this.updateConfigurationPanel(this.props.geoChartOptions),window.addEventListener("resize",this.throttledOnWindowResize)}componentDidUpdate(){this.updateConfigurationPanel(this.props.geoChartOptions)}componentWillUnmount(){this.throttledOnWindowResize.cancel(),window.removeEventListener("resize",this.throttledOnWindowResize)}render(){const{height:e,config:t}=this.props;return void 0===e||(0,V.fO)(t?.legend?.responsive)?r.createElement(q,{client:!0},(({measureRef:e,contentRect:t})=>{const{client:n}=t;return this.renderVisualizationContent(e,n?.height??0,t)})):this.renderVisualizationContent(void 0,e)}renderVisualizationContent(e,t,n){const{geoChartOptions:o}=this.props,i=this.syncWithLegendItemStates(o),a=this.getLegendDetails(this.getLegendPosition(),n),s=a?a.position:w.tV.TOP,l=this.getContainerClassName(s),c=s===w.tV.TOP||s===w.tV.LEFT&&(!this.state.showFluidLegend||!!this.props.config?.respectLegendPosition),u=this.renderLegend(t,s,i,n);return r.createElement("div",{className:l,ref:e},c?u:null,this.renderChart(i),c?null:u)}syncWithLegendItemStates(e){(0,C.kG)(e,"illegal state - trying to sync legend with no geo options");const{categoryItems:t}=e,{enabledLegendItems:n}=this.state,r=t.map(((e,t)=>({...e,isVisible:n[t]})));return{...e,categoryItems:r}}getContainerClassName(e){const t=!0===(0,V.o2)(this.props?.config?.legend?.responsive),n=this.getFlexDirection(e);return I("viz-line-family-chart-wrap","gd-geo-component","s-gd-geo-component",{"responsive-legend":t,"non-responsive-legend":!t,[`flex-direction-${n}`]:!0,"legend-position-bottom":e===w.tV.BOTTOM},this.containerId)}getFlexDirection(e){const t=this.isFluidLegend();return e===w.tV.TOP||e===w.tV.BOTTOM||t?"column":"row"}isFluidLegend(){const{showFluidLegend:e}=this.state,t=(0,V.o2)(this.props?.config?.legend?.responsive);return!(0,V.fO)(t)&&(0,b.eC)(t,e)}onLegendItemClick=e=>{const t=this.state.enabledLegendItems.map(((t,n)=>n===e.legendIndex?!t:t));this.setState({enabledLegendItems:t})};getLegendPosition(){const e=this.props.config?.legend?.position??w.tV.TOP;return w.nB.indexOf(e)>-1?e:w.tV.TOP}getLegendDetails(e,t){const{geoChartOptions:n,config:r}=this.props,o=this.syncWithLegendItemStates(n),{geoData:i}=o,a=i?.segment?.name,s={showFluidLegend:this.isFluidLegend(),contentRect:t,legendLabel:a};return(0,J.$)(e,(0,V.o2)(r?.legend?.responsive),s,r?.respectLegendPosition)}getLegendProps(e,t,n,r){const o=this.props.config?.legend?.responsive,{locale:i}=this.props,{enabledLegendItems:a}=this.state,s=this.isFluidLegend(),{geoData:l,colorStrategy:c,categoryItems:u}=n,{segment:d}=l,m=l.color?.format,g=l.size?.format,p={format:m||g,geoData:l},f=c.getColorByIndex(0),h=this.getLegendDetails(t,r);let b={height:e,locale:i,position:t,responsive:o,isFluidLegend:s,onItemClick:this.onLegendItemClick,contentRect:r,containerId:this.containerId};return h&&(b={...b,maxRows:h.maxRows,name:h.name,renderPopUp:h.renderPopUp}),d&&a.length?{...b,...p,categoryItems:u,colorLegendValue:f}:{...b,...p,colorLegendValue:f}}getChartProps(e){const{config:t=ee,dataView:n,drillableItems:r=[],afterRender:o=x,onCenterPositionChanged:i=x,onDrill:s=x,onZoomChanged:l=x,intl:c,onError:u}=this.props;(0,C.kG)(n,"invalid state - trying to render geo chart but there is no data to visualize");const{geoData:d,colorStrategy:m,categoryItems:g}=e,p=e.geoData.segment?.index,f={colorStrategy:m,config:t,dataView:n,drillableItems:(0,a.convertDrillableItemsToPredicates)(r),drillConfig:{dataView:n,onDrill:s},afterRender:o,geoData:d,onCenterPositionChanged:i,onZoomChanged:l,intl:c,...u?{onError:u}:{}};if(void 0!==p){const e=g.filter((e=>e.isVisible)).map((e=>e.uri));return{...f,config:{...t,selectedSegmentItems:e}}}return f}renderChart=e=>{const{chartRenderer:t=Y}=this.props;return t(this.getChartProps(e))};renderLegend=(e,t,n,r)=>{const o=this.props.config?.legend?.enabled??!0,{legendRenderer:i=Q}=this.props;return o?i(this.getLegendProps(e,t,n,r)):null};onWindowResize=()=>{const{documentObj:e=document}=this.props;this.setState({showFluidLegend:(0,z.nf)(e)})};updateConfigurationPanel(e){(0,C.kG)(e,"illegal state - updating config with no geo options");const{pushData:t}=this.props,{categoryItems:n,geoData:r,colorStrategy:o,colorPalette:i}=e,{hasCategoryLegend:a,hasColorLegend:s,hasSizeLegend:l}=(0,v.T6)(n,r),c=a||s||l;t?.({propertiesMeta:{legend_enabled:c},colors:{colorAssignments:o.getColorAssignment(),colorPalette:i}})}}var ne=n(4270),re=n(53244),oe=n(16576),ie=n(35967),ae=n(80961);class se extends ie.eH{createColorAssignment(e,t,n,r,o){return r?{fullColorAssignment:this.getColorStrategyForSegmentBy(e,t,r,o)}:{fullColorAssignment:[this.getColorStrategyForLocation(e,t,n,o)]}}getColorStrategyForSegmentBy(e,t,n,r){return new ae.l(e,t,null,n,r).getColorAssignment()}getColorStrategyForLocation(e,t,n,r){const o=(0,oe.gG)(n,t,r);return{headerItem:n,color:void 0!==o&&(0,ie.HY)(o,e)?o:{type:"guid",value:e[0].guid}}}}class le extends r.Component{emptyHeaderString;nullHeaderString;errorMap;constructor(e){super(e),this.emptyHeaderString=e.intl.formatMessage({id:"visualization.emptyValue"}),this.nullHeaderString=e.intl.formatMessage({id:"visualization.emptyValue"}),this.errorMap=(0,a.newErrorMapping)(e.intl)}render(){const{dataView:e,error:t,isLoading:n}=this.props,o=null===this.props.ErrorComponent?null:this.props.ErrorComponent??a.ErrorComponent,i=null===this.props.LoadingComponent?null:this.props.LoadingComponent??a.LoadingComponent;if(t){const e=this.errorMap[Object.prototype.hasOwnProperty.call(this.errorMap,t)?t:a.ErrorCodes.UNKNOWN_ERROR];return o?r.createElement(o,{code:t,...e}):null}return n||!e?i?r.createElement(i,null):null:this.renderVisualization()}renderVisualization(){const{dataView:e,onDataTooLarge:t}=this.props,n=a.DataViewFacade.for(e),o=(0,v.uR)(n,this.emptyHeaderString,this.nullHeaderString),i=this.validateData(o,this.props);if(i?.isDataTooLarge){(0,C.kG)(t,"GeoChart's onDataTooLarge callback is missing.");const{location:e}=o,r=(0,b.xm)(n,o),i=void 0!==e?r[e.index]:[];return t(void 0,`LocationData limit: ${this.props.config?.limit??ne.gc} actual: ${i.length}`),null}const s=this.buildGeoChartOptions(o,this.props);return r.createElement(te,{...this.props,geoChartOptions:s})}buildGeoChartOptions=(e,t)=>{const{segment:n}=e,{config:{colors:r=[],colorPalette:o=[],colorMapping:s=[]}={},dataView:l}=t,c=a.DataViewFacade.for(l),u=(0,oe.CW)(r,o),d=function(e,t,n,r){const{locationAttribute:o,segmentByAttribute:a}=(0,v.Dc)(r,n),s={attributeHeader:i(o,"items")};return new se(e,t,s,a,r)}(u,s,e,c);return{geoData:e,categoryItems:n?this.getCategoryLegendItems(d):[],colorStrategy:d,colorPalette:u}};getCategoryLegendItems(e){return function(e,t,n){return e.getColorAssignment().map(((r,o)=>{const{name:i,uri:a}=(0,re.isResultAttributeHeader)(r.headerItem)?r.headerItem.attributeHeaderItem:{name:t,uri:t},s=e.getColorByIndex(o);return{uri:a??n,name:i??n,color:s,legendIndex:o,isVisible:!0}}))}(e,this.emptyHeaderString,this.nullHeaderString)}validateData=(e,t)=>{if(!t.dataView)return;const{dataView:n}=t,r=t.config?.limit??ne.gc,o=a.DataViewFacade.for(n);return{isDataTooLarge:!(0,b.Ur)(o,e,r)}}}const ce=r.createContext({mapboxToken:void 0}),ue=({token:e,children:t})=>r.createElement(ce.Provider,{value:{mapboxToken:e}},t);function de(e){return class extends r.Component{static contextType=ce;render(){const{mapboxToken:t}=this.context,n=this.props;return r.createElement(r.Fragment,null,r.createElement(e,{...n,config:me(n.config,t)}))}}}function me(e,t){return t?{...e||{},mapboxToken:e?.mapboxToken||t}:e}function ge(e){const t=(0,r.useContext)(ce),n=e??t.mapboxToken;return(0,C.kG)(n,"Mapbox token was not provided. Use <MapboxTokenProvider /> to provide token."),n}function pe(e){const t=(0,r.useContext)(ce);return e??t.mapboxToken}const fe=n(47745)(s.Zz,de,(function(e){class t extends r.Component{errorMap;isLocationMissing=!1;isMapboxTokenMissing=!1;constructor(e){super(e),this.errorMap=(0,a.newErrorMapping)(e.intl),this.state={isMapboxTokenInvalid:!1}}render(){return this.initError(),this.state.isMapboxTokenInvalid||this.isMapboxTokenMissing?this.renderErrorComponent(a.ErrorCodes.GEO_MAPBOX_TOKEN_MISSING):this.isLocationMissing?this.renderErrorComponent(a.ErrorCodes.GEO_LOCATION_MISSING):r.createElement(e,{...this.props,onError:this.onError})}shouldComponentUpdate(e,t){const{config:n,execution:r,drillableItems:o}=this.props,{config:i,execution:a,drillableItems:s}=e,c=this.isSameConfig(n,i),u=this.isSameData(r,a),d=l(o,s);return!c||!u||!d||this.state.isMapboxTokenInvalid!==t.isMapboxTokenInvalid}componentDidUpdate(e){e.config?.mapboxToken!==this.props.config?.mapboxToken?this.setState({isMapboxTokenInvalid:!1}):this.handleError()}componentDidMount(){this.handleError()}initError(){const e=this.props.config?.mapboxToken??"",{execution:t}=this.props;this.isLocationMissing=!(0,b.B8)(t.definition.buckets),this.isMapboxTokenMissing=!e}handleError(){const{onError:e}=this.props;this.isLocationMissing&&e?.(new a.GeoLocationMissingSdkError),(this.state.isMapboxTokenInvalid||this.isMapboxTokenMissing)&&e?.(new a.GeoTokenMissingSdkError)}handleInvalidMapboxToken(){this.setState({isMapboxTokenInvalid:!0})}onError=e=>{(0,a.isGeoTokenMissing)(e)?this.handleInvalidMapboxToken():this.props.onError?.(e)};renderErrorComponent(e){const t=this.props.ErrorComponent??a.ErrorComponent,n=this.errorMap[e]||this.errorMap[a.ErrorCodes.UNKNOWN_ERROR];return r.createElement(t,{code:e,...n})}isSameConfig(e,t){const n=(e?.colorMapping||[]).map((e=>e.color)),r=(t?.colorMapping||[]).map((e=>e.color)),o={...e,colorMapping:n},i={...t,colorMapping:r};return l(o,i)}isSameData(e,t){return e&&t?e.equals(t):e===t}}const n=(u=(s={}).intlPropName,d=void 0===u?"intl":u,f=void 0!==(p=s.forwardRef)&&p,v=void 0===(C=s.enforceContext)||C,(I=function(e){return g.createElement(h,null,(function(t){var n;v&&function(e){!function(e,t,n){if(void 0===n&&(n=Error),!e)throw new n("[React Intl] Could not find required `intl` object. <IntlProvider> needs to exist in the component ancestry.")}(e)}(t);var r=((n={})[d]=t,n);return g.createElement(o,c({},e,r,{ref:f?e.forwardedRef:null}))}))}).displayName="injectIntl(".concat((i=o=t).displayName||i.name||"Component",")"),I.WrappedComponent=o,f?m()(g.forwardRef((function(e,t){return g.createElement(I,c({},e,{forwardedRef:t}))})),o):m()(I,o));var o,i,s,u,d,p,f,C,v,I;return class extends r.Component{render(){return r.createElement(a.IntlWrapper,{locale:this.props.locale},r.createElement(n,{...this.props}))}}}),a.withEntireDataView)(le),he=e=>r.createElement(s.ze,{theme:e.theme||{},themeIsLoading:!1},r.createElement(fe,{...e}));function be(e){return void 0!==e.location}function Ce(e){const t=e.buckets,n=(0,re.bucketsMeasures)(t),r=(0,re.bucketsAttributes)(t);return o([n.length>0&&(0,re.newDimension)([re.MeasureGroupIdentifier]),(0,re.newDimension)(r)])}const ve=(0,s.Zz)((0,a.withContexts)((function(e){const{backend:t,workspace:n,sortBy:o,filters:s,exportTitle:l,execConfig:c={}}=e,u=(e=>{const{color:t,segmentBy:n,size:r,config:o}=e,i=[(0,re.newBucket)(a.BucketNames.SIZE,...r?[(0,re.disableComputeRatio)(r)]:[]),(0,re.newBucket)(a.BucketNames.COLOR,...t?[(0,re.disableComputeRatio)(t)]:[])];if(be(e)){const{location:t}=e;i.push((0,re.newBucket)(a.BucketNames.LOCATION,...t?[t]:[]))}else{const{latitude:t,longitude:n}=e;i.push((0,re.newBucket)(a.BucketNames.LATITUDE,...t?[t]:[])),i.push((0,re.newBucket)(a.BucketNames.LONGITUDE,...n?[n]:[]))}i.push((0,re.newBucket)(a.BucketNames.SEGMENT,...n?[n]:[]));const s=o?.[a.BucketNames.TOOLTIP_TEXT];return s&&i.push((0,re.newBucket)(a.BucketNames.TOOLTIP_TEXT,s)),i})(e),d=i(e,(e=>{const t=["backend","workspace","segmentBy","filters","sortBy","color","size"];return be(e)?[...t,"location"]:[...t,"longitude","latitude"]})(e)),m=t.withTelemetry("GeoPushpinChart",e).workspace(n).execution().forBuckets(u,s).withSorting(...o||[]).withDimensions(Ce).withExecConfig(c);return r.createElement(a.IntlWrapper,{locale:e.locale},r.createElement(a.IntlTranslationsProvider,null,(t=>r.createElement(he,{intl:t.intl,execution:m,exportTitle:l||"GeoPushpinChart",enableExecutionCancelling:e.config?.enableExecutionCancelling??!1,...d}))))}))),Ie=e=>{const[t,n,o,i,s,l]=(0,a.useResolveValuesWithPlaceholders)([e.location,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return r.createElement(ve,{...e,location:t,size:n,color:o,segmentBy:i,filters:s,sortBy:l})},Ee=e=>{const[t,n,o,i,s,l,c]=(0,a.useResolveValuesWithPlaceholders)([e.longitude,e.latitude,e.size,e.color,e.segmentBy,e.filters,e.sortBy],e.placeholdersResolutionContext);return r.createElement(ve,{...e,longitude:t,latitude:n,size:o,color:i,segmentBy:s,filters:l,sortBy:c})},xe=e=>be(e)?r.createElement(Ie,{...e}):r.createElement(Ee,{...e})},16576:(e,t,n)=>{n.d(t,{CW:()=>v,D4:()=>c,EK:()=>d,NK:()=>C,Yt:()=>g,c0:()=>u,gG:()=>p,i5:()=>I,ju:()=>f,m:()=>m,ob:()=>l,yx:()=>h,z:()=>b});var r=n(53244),o=n(2525),i=n(18446),a=n(41609);function s(e,t){const n=t<0?0:255,r=Math.abs(t);return Math.round((n-e)*r)+e}function l(e){const t=e.split(",");return{R:parseInt(t[0].slice(4),10),G:parseInt(t[1],10),B:parseInt(t[2],10)}}function c(e,t){const{R:n,G:r,B:o}=l(e);return`rgb(${s(n,t)},${s(r,t)},${s(o,t)})`}function u(e,t){const{r:n,g:r,b:o}=e;return{r:s(n,t),g:s(r,t),b:s(o,t)}}function d(e){return"string"!=typeof e?e:"rgb"===e.slice(0,3)?e.replace(/\s/g,""):function(e){if(4===e.length){const[t,n,r]=e.split("").slice(1);return"#"+t+t+n+n+r+r}return e}(e).replace(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i,((e,t,n,r)=>`rgb(${[t,n,r].map((e=>parseInt(e,16).toString(10))).join(",")})`))}function m(e){try{return e.map(((e,t)=>{const{R:n,G:r,B:o}=l(d(e));if(isNaN(n)||isNaN(r)||isNaN(o))throw Error;return{guid:String(t),fill:{r:n,g:r,b:o}}}))}catch(e){return o.DefaultColorPalette}}function g(e){return!i(e,o.DefaultColorPalette)}function p(e,t,n){if(!t)return;const r=t.find((t=>t.predicate(e,{dv:n})));return r?.color}function f(e,t,n){const r=e.find((e=>e.guid===t));return r?r.fill:e[n%e.length].fill}function h(e){return`rgb(${e.r},${e.g},${e.b})`}function b(e){const t=d(e),n=/rgb\((.*)\)/.exec(t);if(null===n)return null;const r=n[1],[o,i,a]=r.split(",").map((e=>parseInt(e)));return{r:o,g:i,b:a}}function C(e){return t=>{if((0,r.isResultAttributeHeader)(t))return!(!e&&null!==e&&""!==e)&&e===t.attributeHeaderItem.uri;if((0,r.isAttributeDescriptor)(t))return!!e&&(e===t.attributeHeader.uri||e===t.attributeHeader.identifier);if((0,r.isColorDescriptor)(t))return!!e&&e===t.colorHeaderItem.id;const n=(0,o.getMappingHeaderLocalIdentifier)(t);return!!n&&n===e}}function v(e,t){return t&&!a(t)?t:e&&!a(e)?m(e):o.DefaultColorPalette}const I={getColorByGuid:f,getColorMappingPredicate:C}}}]);